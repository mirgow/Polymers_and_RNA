#atom_style bond #no stiffness
atom_style angle #with stiffness

boundary        p p p
###
# Pair interactions require lists of neighbours to be calculated
###

#neighbor 0.3 bin
neighbor 4 bin

neigh_modify every 1 delay 1 check yes
atom_modify sort 0 0
### Generate RESTART file, SPECIAL format, not a .txt file ###
### Useful if simulation crashes ###

restart 1000000 tshaped/restarts/$f.restart
restart 1000000 tshaped/restarts/bb266nuc1bl133bn3d30tot400.restart
#############################



### READ "start" data file ###

read_data tshaped/$f.dat
read_data tshaped/bb266nuc1bl133bn3d30tot400.dat
Reading data file ...
  orthogonal box = (-1000 -1000 -1000) to (1000 1000 1000)
  1 by 1 by 2 MPI processor grid
  reading atoms ...
  400 atoms
  scanning bonds ...
  2 = max bonds/atom
  scanning angles ...
  3 = max angles/atom
  reading bonds ...
  399 bonds
  reading angles ...
  399 angles
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        0        0       
  special bond factors coul:  0        0        0       
     3 = max # of 1-2 neighbors
     3 = max # of 1-3 neighbors
     6 = max # of 1-4 neighbors
     9 = max # of special neighbors
  special bonds CPU = 0.000 seconds
  read_data CPU = 0.044 seconds

######################

### READ "REstart" data file ###

######################



###
# Define groups (atom type 1 is group 'all')
###
group all type 1
400 atoms in group all


###
# Dump configs - "simple dumpings"
###

###
# Dump configs + box coords
###

dump   1   all   custom   1000  tshaped/trjs/$f.lammpstrj  id  x y z  ix iy iz
dump   1   all   custom   1000  tshaped/trjs/bb266nuc1bl133bn3d30tot400.lammpstrj  id  x y z  ix iy iz
dump_modify   1   format line "%d %.5f %.5f %.5f %d %d %d"

########################################################################


###################################################################
# Stiffness term
#
# E = K * (1+cos(theta)), K>0
#
angle_style   cosine
#change this coefficient to change stiffness (e.g. 1,5,10)
angle_coeff   1 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  Lennard-Jones 12-6 potential with cutoff:
#  potential E=4epsilon[ (sigma/r)^12 - (sigma/r)^6]  for r<r_cut
#
#  1.12246 = 2^(1/6) is the minimum of the potential


pair_style      lj/cut 1.12246152962189
#pair_style      lj/cut 3

#
#  pair_modify shift yes adds a constant to the potential such

#  that E(r_cut)=0. Forces remains unchanged.
#

pair_modify     shift yes

#
#  pair_coeff for lj/cut, specify 4:
#    * atom type interacting with
#    * atom type
#    * epsilon (energy units)
#    * sigma (distance units)
#

pair_coeff      1 1 1.0 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  soft potential, for PUSHING apart overlapping atoms
#  potential E=A*(1 + cos(pi*r/r_c))
#
#  1.12246 = 2^(1/6) is the cut-off r_c

#pair_style     soft 1.12246152962189

#
#  pair_coeff for soft, specify 3:
#    * atom type interacting with
#    * atom type
#    * A
#
#

#pair_coeff      1 1 100.0
###################################################################

###################################################################
# Pair interaction between bonded atoms
#
# Fene potential + Lennard Jones 12-6:

#
#  E= - 0.5 K R0^2 ln[ 1- (r/R0)^2]
#     + 4epsilon[ (sigma/r)^12 - (sigma/r)^6] + epsilon
#

bond_style   fene


#
# For style fene, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#   * epsilon (energy)  (LJ component)
#   * sigma (distance)  (LJ component)
#


special_bonds fene #<=== I M P O R T A N T (new command)
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        1        1       
  special bond factors coul:  0        1        1       
     3 = max # of 1-2 neighbors
     9 = max # of special neighbors
  special bonds CPU = 0.000 seconds

bond_coeff   1   30   2   1.0   1.0


###################################################

###################################################################
# Pair interaction between bonded atoms
#
# Harmonic potential:
#
#  E= K * (R-R0)^2
#

#bond_style   harmonic

#
# For style harmonic, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#

#bond_coeff   1   60.0   1.0
#bond_coeff   2   harmonic 0.1   1.0

###################################################
compute 1 all gyration
variable rog equal c_1
#compute 2 all coord/atom cutoff 1.1

#dump 2 all custom 10000 contact_number.dump id c_2


###
# Set up fixes
###
thermo_style   custom   step  temp enthalpy c_1
fix 1 all nve   ###NVE ensemble

fix 2 all   langevin   1.0 1.0 1.0  100103   ###Langevin integrator Tstart Tstop 1/friction rndseed


##### Sample thermodynamic info  (temperature, energy, pressure, etc.) #####
thermo 1000









############################################################################

###
# set timestep of integrator

timestep 0.01

###
# run integration for a number of steps
###
#run 0
#variable r equal c_1
#if "$r < 63.1" then "quit 1"

# lj potential minimum, cause molecule to explore
run 100000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 1 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 5.1224615
  ghost atom cutoff = 5.1224615
  binsize = 2.5612308, bins = 781 781 781
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut, perpetual
      attributes: half, newton on
      pair build: half/bin/newton
      stencil: half/bin/3d
      bin: standard
WARNING: Communication cutoff 5.12246152962189 is shorter than a bond length based estimate of 5.455. This may lead to errors. (src/comm.cpp:723)
Per MPI rank memory allocation (min/avg/max) = 939.4 | 940.1 | 940.7 Mbytes
   Step          Temp         Enthalpy         c_1      
         0   0              13.366823      66.692628    
      1000   0.99488665     18.954827      66.48874     
      2000   1.0256182      19.39965       65.697291    
      3000   1.0118731      19.274509      65.250195    
      4000   0.99805452     18.429968      64.231847    
      5000   0.98700247     18.268676      63.202782    
      6000   1.0028061      19.618491      62.8055      
      7000   0.96494476     19.009503      62.106843    
      8000   1.0094474      19.478679      61.606709    
      9000   1.0723108      19.751351      60.877364    
     10000   1.0184149      19.89834       60.406393    
     11000   0.98439317     19.717428      59.491003    
     12000   0.98192747     19.087453      59.439608    
     13000   0.999603       19.309052      58.971704    
     14000   0.97312457     19.90576       58.829454    
     15000   0.92017951     19.530922      58.465011    
     16000   0.98796398     19.6671        58.196558    
     17000   1.0066023      20.081156      57.913185    
     18000   0.97245687     20.233654      58.013522    
     19000   0.99328643     19.667858      57.626825    
     20000   1.0211174      21.434218      57.168357    
     21000   1.0114336      19.815269      56.699219    
     22000   1.0254141      20.917405      56.38814     
     23000   0.99614388     19.999335      56.389759    
     24000   0.97601126     19.723042      56.083724    
     25000   1.0343101      20.261217      55.483217    
     26000   0.97441118     19.234629      55.228105    
     27000   1.0647821      20.714503      55.088977    
     28000   0.98116994     20.541708      54.757888    
     29000   0.98966038     20.297782      54.471838    
     30000   1.0611856      20.399518      54.361206    
     31000   1.0273059      19.794909      53.885145    
     32000   0.98610586     19.79077       53.541979    
     33000   0.92427388     19.6395        53.097889    
     34000   1.03117        20.073312      52.454324    
     35000   0.95118357     19.700823      52.197735    
     36000   1.0547236      19.506503      52.192663    
     37000   1.0647611      20.905483      51.959072    
     38000   0.92858194     19.826215      51.22951     
     39000   0.99828421     19.975919      51.113266    
     40000   1.0100686      20.703317      50.966404    
     41000   0.96277247     19.933351      50.696208    
     42000   1.0076694      20.709394      50.365098    
     43000   0.98985327     20.189326      49.678665    
     44000   0.97737201     20.73066       49.761248    
     45000   1.067342       20.515673      49.55002     
     46000   0.97755023     19.978759      49.58632     
     47000   0.97059484     19.517287      49.416456    
     48000   1.0472121      20.401705      49.517281    
     49000   1.0193373      19.633592      49.293864    
     50000   0.99420434     20.677083      48.935225    
     51000   0.96342561     19.638142      48.936962    
     52000   0.9640467      20.661783      48.906451    
     53000   0.9695376      19.562345      48.846306    
     54000   1.025814       20.366988      48.481969    
     55000   1.0061784      20.358601      48.58496     
     56000   1.0155277      20.705816      48.298167    
     57000   0.95781701     20.201559      48.075456    
     58000   0.99078354     20.423767      47.379729    
     59000   1.0025325      19.98577       46.736909    
     60000   1.1160711      20.260302      46.519053    
     61000   0.96826898     20.886299      46.54317     
     62000   1.0320859      20.178259      46.569622    
     63000   1.0205668      20.647299      46.563034    
     64000   1.0713545      20.642674      46.461356    
     65000   1.0566822      20.677827      45.815433    
     66000   0.90844545     19.521339      45.473154    
     67000   0.95896083     20.605272      45.068051    
     68000   0.93859783     19.343958      44.999196    
     69000   1.0820338      21.137495      45.045169    
     70000   0.99398319     20.056874      44.980315    
     71000   1.0039028      20.552826      44.994286    
     72000   1.0484684      20.980533      45.077826    
     73000   1.0456512      20.027924      44.903217    
     74000   1.0307561      20.544698      44.518813    
     75000   0.96530107     21.313896      44.233955    
     76000   1.0606936      20.933981      43.913623    
     77000   0.99985472     19.706482      43.764117    
     78000   0.88663221     19.932087      43.816128    
     79000   0.97491515     20.023844      43.6241      
     80000   0.94153398     20.677983      43.583521    
     81000   0.98101652     20.059078      43.436153    
     82000   0.96650634     20.013457      43.470162    
     83000   0.93569767     20.271515      43.113345    
     84000   0.98809698     20.818134      42.944669    
     85000   0.99870796     20.938427      42.537654    
     86000   1.0123559      19.756069      42.730538    
     87000   1.0406096      20.642629      42.260166    
     88000   1.0104754      19.745696      42.376121    
     89000   0.9396904      20.23232       42.445141    
     90000   0.97964126     19.531029      42.235476    
     91000   0.99031552     20.374051      42.428384    
     92000   0.98600041     19.06671       42.432327    
     93000   0.95430561     20.33461       42.287646    
     94000   1.0529837      20.639267      42.408184    
     95000   1.0053501      19.817189      42.37765     
     96000   1.0266121      20.370931      42.018992    
     97000   0.94406647     20.134117      41.725268    
     98000   0.96717051     20.516089      41.681169    
     99000   0.96753699     20.478466      41.551811    
    100000   0.95005608     21.405827      41.350286    
Loop time of 245.297 on 2 procs for 100000 steps with 400 atoms

Performance: 352226.618 tau/day, 407.670 timesteps/s
54.7% CPU use with 2 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.0519     | 0.67184    | 1.2918     |  75.6 |  0.27
Bond    | 0.0082569  | 1.3972     | 2.7862     | 117.5 |  0.57
Neigh   | 236.57     | 236.58     | 236.58     |   0.0 | 96.44
Comm    | 0.034688   | 0.050102   | 0.065516   |   6.9 |  0.02
Output  | 0.28653    | 0.29144    | 0.29635    |   0.9 |  0.12
Modify  | 0.019742   | 1.5296     | 3.0395     | 122.1 |  0.62
Other   |            | 4.78       |            |       |  1.95

Nlocal:            200 ave         400 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 1
Nghost:              0 ave           0 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 0
Neighs:           1374 ave        2748 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 1

Total # of neighbors = 2748
Ave neighs/atom = 6.87
Ave special neighs/atom = 1.995
Neighbor list builds = 1045
Dangerous builds = 0

# Replace lj potential, now collapse
pair_style      lj/cut 3

# Cutoff simul when gyration under 5
# Variable created with equal requires v_ + 'name'
fix 3 all halt 1000 v_rog < 7

run 5000000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Per MPI rank memory allocation (min/avg/max) = 939.4 | 940.1 | 940.7 Mbytes
   Step          Temp         Enthalpy         c_1      
    100000   0.95005608     20.619427      41.350286    
    101000   0.92302401     19.913594      40.906248    
    102000   0.99064463     19.736797      40.732905    
    103000   0.93268257     19.39325       40.425751    
    104000   0.97275222     19.542591      40.14594     
    105000   1.0567341      19.725763      40.174257    
    106000   1.0386478      19.269724      39.841915    
    107000   0.97233781     19.710002      39.674069    
    108000   0.95405341     18.747431      39.825382    
    109000   0.9553927      19.69405       39.812677    
    110000   1.0446958      20.058704      39.498409    
    111000   1.0272625      19.859644      39.224245    
    112000   0.99320363     19.167193      38.548914    
    113000   0.96721259     19.101221      38.387873    
    114000   0.98311352     18.857258      38.288694    
    115000   0.97691404     18.930096      38.047358    
    116000   1.0501024      19.697666      37.368774    
    117000   0.98197949     18.356661      36.969774    
    118000   0.95245231     18.926696      36.669894    
    119000   0.96641874     19.734559      36.506846    
    120000   1.0328904      19.300616      36.221747    
    121000   0.96318016     19.744339      35.928513    
    122000   1.0056022      18.694164      35.549163    
    123000   0.99783678     19.845345      35.198646    
    124000   1.0323736      18.857432      35.111048    
    125000   1.1006721      20.296915      34.943983    
    126000   1.0491892      19.727279      34.618314    
    127000   1.0716085      19.960449      34.237878    
    128000   0.97248609     19.574184      34.293218    
    129000   1.0573347      19.218447      33.724074    
    130000   0.97533345     18.872527      33.489916    
    131000   0.94632815     18.507168      33.507201    
    132000   0.9955423      18.499604      33.140625    
    133000   0.95190687     18.361001      32.816491    
    134000   0.97526        18.491586      32.500437    
    135000   0.91449851     18.723323      32.215409    
    136000   0.99021877     18.389137      32.308322    
    137000   0.9715358      17.772227      32.222321    
    138000   0.95782785     18.166412      32.15588     
    139000   0.99573482     19.20262       32.278312    
    140000   0.97501652     18.960963      31.878719    
    141000   0.9619402      17.802904      31.519034    
    142000   1.0044445      19.022673      31.180283    
    143000   1.009187       18.090905      30.714432    
    144000   0.9838702      18.819661      30.718421    
    145000   1.0414451      19.042737      30.791144    
    146000   0.95960157     19.113194      30.329558    
    147000   1.0308672      18.669224      30.124887    
    148000   1.0095463      17.727246      30.197797    
    149000   0.93661509     18.831429      29.816303    
    150000   1.0506386      19.800243      29.429493    
    151000   1.0082574      18.183386      29.06986     
    152000   0.96110591     18.130428      29.144296    
    153000   0.94294227     18.645263      28.925296    
    154000   0.95104342     18.349964      28.648808    
    155000   1.015896       19.677901      28.545114    
    156000   1.0090159      19.253642      28.662745    
    157000   1.0120338      18.937049      28.46625     
    158000   1.0110093      18.915421      28.209345    
    159000   1.0191448      18.354081      27.832278    
    160000   0.98770451     18.659312      27.775412    
    161000   0.99124488     18.228311      27.619307    
    162000   0.92606746     18.635226      27.498114    
    163000   0.98884435     18.525635      27.39147     
    164000   0.98163257     18.266234      26.891468    
    165000   1.0007068      18.965006      26.576385    
    166000   0.98496202     19.014705      26.164741    
    167000   1.0923729      18.950054      26.266189    
    168000   1.0737847      19.160435      26.171453    
    169000   1.0564584      18.239477      25.684778    
    170000   1.0482359      18.623221      25.350111    
    171000   0.96714074     19.149695      24.690491    
    172000   0.99549402     18.20381       24.515857    
    173000   0.97033751     17.696574      24.561719    
    174000   0.9725994      18.492154      24.290301    
    175000   1.0067799      17.53047       24.323166    
    176000   1.0272243      18.872605      24.047532    
    177000   1.0450334      17.540851      23.948836    
    178000   0.91109163     17.342343      24.11914     
    179000   0.98243813     19.58063       23.68247     
    180000   0.97328264     18.424322      23.561536    
    181000   1.0390002      18.602707      23.465602    
    182000   0.91287907     19.238276      23.082284    
    183000   1.0331237      18.450879      22.979564    
    184000   1.0493839      19.053058      23.132162    
    185000   1.0501319      17.706949      22.668898    
    186000   1.0056048      19.159867      22.095065    
    187000   0.94757102     17.620704      21.495503    
    188000   0.96184343     18.40391       21.40689     
    189000   0.94756199     18.055783      21.063985    
    190000   1.0289334      18.131418      20.595485    
    191000   0.99493212     18.097356      20.55111     
    192000   0.98810111     18.467979      19.7871      
    193000   0.99568232     18.041957      19.594302    
    194000   1.0015234      17.643052      19.057703    
    195000   1.0380155      19.040566      18.448012    
    196000   0.98310219     18.085256      17.873912    
    197000   0.95589545     18.037858      17.743678    
    198000   1.0441449      17.24516       17.536728    
    199000   0.92677872     17.500097      16.612825    
    200000   1.0061109      18.91423       16.390815    
    201000   1.0325587      18.357058      16.007738    
    202000   1.0572531      19.278607      15.511412    
    203000   0.9620401      17.721617      14.955957    
    204000   1.0350765      17.939285      14.73553     
    205000   0.98759703     17.817306      14.628786    
    206000   0.98497986     17.828573      14.226331    
    207000   0.98544615     18.215028      14.185485    
    208000   0.99120423     17.779155      14.259051    
    209000   1.0249828      17.970556      13.859578    
    210000   1.0291781      18.263934      13.605732    
    211000   0.99682293     17.311622      13.48529     
    212000   1.0374557      18.495164      13.133112    
    213000   1.0021677      18.137187      13.089319    
    214000   1.0430799      16.932639      12.855917    
    215000   0.99782801     18.383276      12.587756    
    216000   1.0086569      17.897545      12.55236     
    217000   0.99782689     18.663334      12.276915    
    218000   1.0302857      18.100822      11.990418    
    219000   1.0273417      17.873595      11.622772    
    220000   1.0021928      18.028033      11.561695    
    221000   1.0570217      17.762342      11.58306     
    222000   0.97350451     18.864022      11.431167    
    223000   1.0466072      18.602997      11.081571    
    224000   1.013099       17.023637      10.565207    
    225000   0.96646939     17.607881      10.434441    
    226000   1.0170333      18.013201      10.15324     
    227000   1.0028156      18.279177      9.7822918    
    228000   1.0222748      17.793619      9.658147     
    229000   1.0223386      17.145514      9.5539765    
    230000   0.99704652     17.730191      8.8881441    
    231000   0.99514051     16.950395      8.7135547    
    232000   0.9295252      17.679689      8.7807561    
    233000   0.99159974     17.411079      8.2321232    
    234000   1.0314505      17.770711      8.0386687    
    235000   1.027069       18.214511      8.0499981    
    236000   0.96701687     18.457229      7.9289348    
    237000   1.0272543      18.042715      7.5702084    
    238000   0.96378816     16.852832      7.5323808    
    239000   1.0815028      18.431462      7.1627549    
Fix halt condition for fix-id 3 met on step 240000 with value 6.8313871382401405 (src/fix_halt.cpp:237)
    240000   0.96284168     18.107724      6.8313871    
Loop time of 161.073 on 2 procs for 140000 steps with 400 atoms

Performance: 750965.639 tau/day, 869.173 timesteps/s
56.4% CPU use with 2 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.038688   | 16.236     | 32.433     | 402.0 | 10.08
Bond    | 0.036092   | 2.1901     | 4.3441     | 145.6 |  1.36
Neigh   | 116.13     | 116.13     | 116.13     |   0.0 | 72.10
Comm    | 0.15063    | 0.19064    | 0.23065    |   9.2 |  0.12
Output  | 0.5382     | 0.54429    | 0.55038    |   0.8 |  0.34
Modify  | 0.1338     | 2.6993     | 5.2648     | 156.2 |  1.68
Other   |            | 23.08      |            |       | 14.33

Nlocal:            200 ave         400 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 1
Nghost:              0 ave           0 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 0
Neighs:          21484 ave       42968 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 1

Total # of neighbors = 42968
Ave neighs/atom = 107.42
Ave special neighs/atom = 1.995
Neighbor list builds = 1245
Dangerous builds = 0

# This simulation is done
# Move onto the next one
clear
OMP_NUM_THREADS environment is not set. Defaulting to 1 thread. (src/comm.cpp:98)
  using 1 OpenMP thread(s) per MPI task
next f
jump SELF

###
# Reference paper:
# K. Kremer and G. S. Grest
# Dynamics of entangled linear polymer melts: A molecular-dynamics simulation
# J Chem Phys 92, 5057 (1990)

##################################
# MIHIR: for branched polymers
# LJ minimum first to expand and explore, then collapse
###

###
# Looping through the various tshaped polymers to simulate,
# define variables to switch through
variable f index bb66nuc1bl33bn3d30tot100 bb133nuc1bl66bn3d30tot200 bb200nuc1bl100bn3d30tot300 bb266nuc1bl133bn3d30tot400 bb333nuc1bl166bn3d30tot500 bb400nuc1bl200bn3d30tot600 bb466nuc1bl233bn3d30tot700 bb533nuc1bl266bn3d30tot800 bb600nuc1bl300bn3d30tot900 bb666nuc1bl333bn3d30tot1000 bb733nuc1bl366bn3d30tot1100 bb800nuc1bl400bn3d30tot1200
###


###
# Box and units  (use LJ units and periodic boundaries)
###

units lj
log tshaped/logs/$f.log
log tshaped/logs/bb333nuc1bl166bn3d30tot500.log

#atom_style bond #no stiffness
atom_style angle #with stiffness

boundary        p p p
###
# Pair interactions require lists of neighbours to be calculated
###

#neighbor 0.3 bin
neighbor 4 bin

neigh_modify every 1 delay 1 check yes
atom_modify sort 0 0
### Generate RESTART file, SPECIAL format, not a .txt file ###
### Useful if simulation crashes ###

restart 1000000 tshaped/restarts2/$f.restart
restart 1000000 tshaped/restarts2/bb266nuc1bl133bn3d30tot400.restart
#############################



### READ "start" data file ###

read_data tshaped/$f.dat
read_data tshaped/bb266nuc1bl133bn3d30tot400.dat
Reading data file ...
  orthogonal box = (-1000 -1000 -1000) to (1000 1000 1000)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  400 atoms
  scanning bonds ...
  2 = max bonds/atom
  scanning angles ...
  3 = max angles/atom
  reading bonds ...
  399 bonds
  reading angles ...
  399 angles
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        0        0       
  special bond factors coul:  0        0        0       
     3 = max # of 1-2 neighbors
     3 = max # of 1-3 neighbors
     6 = max # of 1-4 neighbors
     9 = max # of special neighbors
  special bonds CPU = 0.001 seconds
  read_data CPU = 0.050 seconds

######################

### READ "REstart" data file ###

######################



###
# Define groups (atom type 1 is group 'all')
###
group all type 1
400 atoms in group all


###
# Dump configs - "simple dumpings"
###

###
# Dump configs + box coords
###

dump   1   all   custom   1000  tshaped/trjs2/$f.lammpstrj  id  x y z  ix iy iz
dump   1   all   custom   1000  tshaped/trjs2/bb266nuc1bl133bn3d30tot400.lammpstrj  id  x y z  ix iy iz
dump_modify   1   format line "%d %.5f %.5f %.5f %d %d %d"

########################################################################


###################################################################
# Stiffness term
#
# E = K * (1+cos(theta)), K>0
#
angle_style   cosine
#change this coefficient to change stiffness (e.g. 1,5,10)
angle_coeff   1 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  Lennard-Jones 12-6 potential with cutoff:
#  potential E=4epsilon[ (sigma/r)^12 - (sigma/r)^6]  for r<r_cut
#
#  1.12246 = 2^(1/6) is the minimum of the potential


pair_style      lj/cut 1.12246152962189
#pair_style      lj/cut 3

#
#  pair_modify shift yes adds a constant to the potential such

#  that E(r_cut)=0. Forces remains unchanged.
#

pair_modify     shift yes

#
#  pair_coeff for lj/cut, specify 4:
#    * atom type interacting with
#    * atom type
#    * epsilon (energy units)
#    * sigma (distance units)
#

pair_coeff      1 1 1.0 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  soft potential, for PUSHING apart overlapping atoms
#  potential E=A*(1 + cos(pi*r/r_c))
#
#  1.12246 = 2^(1/6) is the cut-off r_c

#pair_style     soft 1.12246152962189

#
#  pair_coeff for soft, specify 3:
#    * atom type interacting with
#    * atom type
#    * A
#
#

#pair_coeff      1 1 100.0
###################################################################

###################################################################
# Pair interaction between bonded atoms
#
# Fene potential + Lennard Jones 12-6:

#
#  E= - 0.5 K R0^2 ln[ 1- (r/R0)^2]
#     + 4epsilon[ (sigma/r)^12 - (sigma/r)^6] + epsilon
#

bond_style   fene


#
# For style fene, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#   * epsilon (energy)  (LJ component)
#   * sigma (distance)  (LJ component)
#


special_bonds fene #<=== I M P O R T A N T (new command)
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        1        1       
  special bond factors coul:  0        1        1       
     3 = max # of 1-2 neighbors
     9 = max # of special neighbors
  special bonds CPU = 0.000 seconds

bond_coeff   1   30   2   1.0   1.0


###################################################

###################################################################
# Pair interaction between bonded atoms
#
# Harmonic potential:
#
#  E= K * (R-R0)^2
#

#bond_style   harmonic

#
# For style harmonic, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#

#bond_coeff   1   60.0   1.0
#bond_coeff   2   harmonic 0.1   1.0

###################################################
compute 1 all gyration
variable rog equal c_1
#compute 2 all coord/atom cutoff 1.1

#dump 2 all custom 10000 contact_number.dump id c_2


###
# Set up fixes
###
thermo_style   custom   step  temp enthalpy c_1
fix 1 all nve   ###NVE ensemble

fix 2 all   langevin   1.0 1.0 1.0  778655   ###Langevin integrator Tstart Tstop 1/friction rndseed


##### Sample thermodynamic info  (temperature, energy, pressure, etc.) #####
thermo 1000









############################################################################

###
# set timestep of integrator

timestep 0.01

###
# run integration for a number of steps
###
#run 0
#variable r equal c_1
#if "$r < 63.1" then "quit 1"

# lj potential minimum, cause molecule to explore
run 100000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Neighbor list info ...
  update: every = 1 steps, delay = 1 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 5.1224615
  ghost atom cutoff = 5.1224615
  binsize = 2.5612308, bins = 781 781 781
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut/omp, perpetual
      attributes: half, newton on, omp
      pair build: half/bin/newton/omp
      stencil: half/bin/3d
      bin: standard
WARNING: Communication cutoff 5.12246152962189 is shorter than a bond length based estimate of 5.455. This may lead to errors. (src/comm.cpp:723)
Per MPI rank memory allocation (min/avg/max) = 1860 | 1860 | 1860 Mbytes
   Step          Temp         Enthalpy         c_1      
         0   0              13.366823      66.692628    
      1000   1.0314685      18.677344      66.449807    
      2000   1.0322324      19.255631      66.098992    
      3000   0.98882058     18.701752      65.555713    
      4000   1.0519026      18.432989      64.977121    
      5000   0.97789023     18.636979      63.942476    
      6000   1.0217301      19.647111      63.59439     
      7000   1.0052368      19.308281      62.923853    
      8000   1.0147821      19.665139      62.410899    
      9000   0.97232181     19.783327      61.748246    
     10000   1.0183152      19.911538      61.422279    
     11000   1.0150917      19.737644      61.30191     
     12000   0.98218685     20.6346        60.718555    
     13000   1.0172272      19.342912      60.116441    
     14000   1.0642257      20.019669      59.915866    
     15000   1.0132594      19.987675      59.583622    
     16000   1.0070711      19.995719      59.019951    
     17000   1.0373328      20.164598      58.649834    
     18000   0.95202147     19.609179      58.35587     
     19000   0.95184084     19.502159      58.219741    
     20000   1.0073994      19.357573      57.921048    
     21000   1.0352091      19.939247      57.630021    
     22000   1.0162385      20.082335      57.258529    
     23000   1.0188779      19.527271      57.038625    
     24000   1.0096235      19.669992      56.569218    
     25000   1.0544724      19.741405      56.125632    
     26000   0.97669009     20.532874      55.657134    
     27000   0.99783111     19.851553      55.521747    
     28000   1.0485855      20.572872      55.12067     
     29000   0.99538819     20.201104      54.961091    
     30000   0.91425025     20.156176      54.158847    
     31000   1.0247499      20.275971      53.980805    
     32000   1.0121293      20.113948      53.568244    
     33000   1.0059594      20.076236      53.341312    
     34000   0.97648616     19.776         53.021999    
     35000   0.95266069     19.914592      52.801634    
     36000   0.88400484     20.061286      52.378211    
     37000   0.9993948      20.806924      52.084065    
     38000   1.0502418      20.747167      52.044634    
     39000   1.0062034      20.160859      52.075258    
     40000   0.98742021     20.477285      51.772611    
     41000   0.92744179     20.008928      51.754548    
     42000   1.0305476      20.140519      51.74192     
     43000   0.98925468     19.927546      51.505902    
     44000   1.0158782      20.338715      51.44448     
     45000   0.97988688     19.539913      51.388049    
     46000   0.98401853     20.346266      51.222723    
     47000   0.94877832     19.93699       51.543248    
     48000   0.99863876     20.142517      51.395034    
     49000   0.97181103     19.567536      51.319091    
     50000   1.0257115      20.503851      51.122465    
     51000   1.0642253      20.118984      51.023333    
     52000   0.96067737     20.265592      50.638135    
     53000   0.95648663     19.890847      50.324083    
     54000   0.96540549     20.472331      50.152509    
     55000   1.014031       20.365333      50.069448    
     56000   1.0064852      20.71598       49.500845    
     57000   0.98881854     20.041286      49.580362    
     58000   0.97981681     20.485869      49.543371    
     59000   0.94242748     20.350923      49.436036    
     60000   1.007762       20.916555      49.019667    
     61000   0.99795427     20.494913      48.963155    
     62000   0.99320317     20.345517      49.015802    
     63000   1.0086192      20.760045      48.544913    
     64000   0.94819458     19.468495      48.489411    
     65000   1.0164184      20.732456      48.292795    
     66000   1.0449142      20.562889      48.041989    
     67000   1.0111416      20.566341      47.50266     
     68000   1.0500427      20.738095      47.245985    
     69000   0.97095699     18.901001      47.36089     
     70000   1.1021345      21.802844      47.078387    
     71000   0.92581998     19.722907      46.950566    
     72000   0.98878099     19.94641       46.612871    
     73000   0.99557972     20.20981       46.634724    
     74000   0.97943224     20.013626      46.66854     
     75000   0.99043997     20.42496       46.41799     
     76000   0.98978054     20.482652      46.438765    
     77000   0.9699575      20.396356      46.434706    
     78000   1.0934065      20.068563      46.237487    
     79000   1.0120757      20.423821      45.837544    
     80000   1.0640551      20.498699      45.677812    
     81000   0.98001374     21.018957      45.646226    
     82000   1.0007007      20.443433      45.556779    
     83000   1.0422274      20.688637      45.092232    
     84000   1.0125655      19.640452      44.776555    
     85000   0.99322731     21.270279      44.538904    
     86000   0.92059566     20.24723       44.459847    
     87000   1.0018793      20.551059      44.185333    
     88000   0.99090209     20.431443      44.316341    
     89000   1.0089371      20.009556      44.006234    
     90000   1.0760693      21.899344      43.735591    
     91000   1.0238273      20.997398      44.173064    
     92000   1.0178959      20.125462      44.013389    
     93000   0.99593145     20.365935      43.942245    
     94000   1.0037451      20.845175      43.853138    
     95000   1.0322797      20.488094      43.780406    
     96000   1.0059681      19.810653      43.275779    
     97000   1.0153214      20.21925       43.109336    
     98000   1.0110186      20.872972      42.896644    
     99000   1.0325065      20.57239       43.035604    
    100000   0.96338744     20.569214      42.76178     
Loop time of 552.301 on 2 procs for 100000 steps with 400 atoms

Performance: 156436.354 tau/day, 181.061 timesteps/s
101.0% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.54781    | 0.54781    | 0.54781    |   0.0 |  0.10
Bond    | 1.072      | 1.072      | 1.072      |   0.0 |  0.19
Neigh   | 548.24     | 548.24     | 548.24     |   0.0 | 99.27
Comm    | 0.025736   | 0.025736   | 0.025736   |   0.0 |  0.00
Output  | 0.20349    | 0.20349    | 0.20349    |   0.0 |  0.04
Modify  | 2.0287     | 2.0287     | 2.0287     |   0.0 |  0.37
Other   |            | 0.1802     |            |       |  0.03

Nlocal:            400 ave         400 max         400 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           2809 ave        2809 max        2809 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 2809
Ave neighs/atom = 7.0225
Ave special neighs/atom = 1.995
Neighbor list builds = 1046
Dangerous builds = 0

# Replace lj potential, now collapse
pair_style      lj/cut 3

# Cutoff simul when gyration under 5
# Variable created with equal requires v_ + 'name'
fix 3 all halt 1000 v_rog < 7

run 5000000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Per MPI rank memory allocation (min/avg/max) = 1860 | 1860 | 1860 Mbytes
   Step          Temp         Enthalpy         c_1      
    100000   0.96338744     19.88052       42.76178     
    101000   0.98992294     19.768664      42.668589    
    102000   1.0290775      19.193787      42.390033    
    103000   1.0128221      19.26689       41.857105    
    104000   0.98925315     18.198738      41.563577    
    105000   1.0031276      18.862359      41.53273     
    106000   1.0843683      19.078271      41.270856    
    107000   0.98920617     18.478036      40.811824    
    108000   1.0458696      18.90519       40.592102    
    109000   0.99139668     19.24289       40.486141    
    110000   1.0097797      19.336296      40.212477    
    111000   1.0553449      19.05423       40.518893    
    112000   1.0306809      19.680211      40.373589    
    113000   0.95155542     19.167726      40.254906    
    114000   1.0176273      18.648948      39.64901     
    115000   1.0026727      18.488706      39.235181    
    116000   0.9987595      18.982407      39.168917    
    117000   1.0748595      19.286339      38.858566    
    118000   0.97947141     19.745617      39.107704    
    119000   0.93178596     19.683369      39.218475    
    120000   0.97369761     19.42885       39.45369     
    121000   1.1101504      19.722858      39.549204    
    122000   0.92332702     19.13993       39.524738    
    123000   0.98559927     18.914519      39.043269    
    124000   1.0500751      19.279363      38.539769    
    125000   0.97804655     20.435955      38.232221    
    126000   1.0846143      19.574686      38.014542    
    127000   1.0231754      18.056124      37.91575     
    128000   0.99614185     18.569669      37.458511    
    129000   0.94694884     18.921582      37.852259    
    130000   0.97894569     19.452951      37.573163    
    131000   1.0145552      18.413213      37.219086    
    132000   1.0347837      19.369377      36.541774    
    133000   0.96559878     18.571769      35.919556    
    134000   0.97397199     18.23124       35.610479    
    135000   1.0035691      18.261824      34.994195    
    136000   0.96072236     19.140234      35.10901     
    137000   1.0190434      18.636371      34.708873    
    138000   0.96672125     18.914         34.472124    
    139000   1.0390715      19.043603      34.469278    
    140000   1.0610807      19.346657      34.135436    
    141000   0.99074134     18.900427      34.070467    
    142000   0.9967066      18.941754      34.041407    
    143000   1.0380018      19.58514       33.539915    
    144000   1.0171465      18.772911      33.350107    
    145000   1.0753465      18.603247      32.735644    
    146000   0.98618919     18.380711      32.429478    
    147000   1.0053286      18.533148      32.377464    
    148000   1.0834585      19.904779      32.017975    
    149000   1.0149153      18.105739      31.885276    
    150000   1.0049965      19.167568      31.785313    
    151000   1.0347762      18.096391      31.744618    
    152000   0.98132111     18.931204      31.503526    
    153000   1.0151673      18.404543      31.124026    
    154000   0.92696304     18.704023      30.686504    
    155000   1.0140886      18.901438      30.277227    
    156000   1.0178134      19.94791       30.205948    
    157000   1.0527107      18.651164      29.971121    
    158000   1.0086203      19.208965      29.827233    
    159000   0.95341859     18.701222      29.441507    
    160000   0.98552043     19.30582       29.082755    
    161000   1.0770802      19.131832      28.72133     
    162000   0.97729896     18.962977      28.47402     
    163000   1.0097456      18.045001      28.000048    
    164000   0.99567811     18.653353      28.206249    
    165000   1.0396836      18.533884      27.959447    
    166000   1.0540138      19.300788      28.095639    
    167000   1.0078381      17.939672      28.073733    
    168000   1.0864334      18.903306      28.171922    
    169000   0.98139657     18.872142      28.052593    
    170000   1.0203015      19.054849      27.813693    
    171000   1.06531        17.851795      27.754224    
    172000   1.0432811      18.197171      27.82908     
    173000   1.0238102      18.121541      27.21144     
    174000   0.99252158     18.154301      27.082715    
    175000   1.0111323      18.917604      27.292648    
    176000   0.98899032     18.293863      26.725533    
    177000   0.93008618     18.817253      26.293275    
    178000   0.97524999     17.757025      26.152678    
    179000   1.0163597      18.425915      25.360707    
    180000   1.0480001      19.519812      25.476514    
    181000   0.92949594     19.363844      25.533799    
    182000   1.0348448      19.235569      25.460947    
    183000   0.98436296     18.307736      25.365243    
    184000   1.078621       19.038095      25.251413    
    185000   0.98467879     19.057517      24.825183    
    186000   1.0401762      17.476293      24.623072    
    187000   1.0474994      19.039524      24.436083    
    188000   1.0239581      18.768891      23.934797    
    189000   0.92352231     18.271219      23.709659    
    190000   1.0741219      18.740456      23.736552    
    191000   1.0314714      18.240027      23.302433    
    192000   1.0292841      19.005652      22.887787    
    193000   1.0214652      18.308152      22.446514    
    194000   1.0251764      19.077331      22.307398    
    195000   0.9400708      18.012504      21.995566    
    196000   0.98975016     18.162418      21.885101    
    197000   0.93058311     18.161676      21.579498    
    198000   0.97138878     18.920594      21.162318    
    199000   0.98152839     18.881556      20.828119    
    200000   0.95305001     18.632345      20.911044    
    201000   1.0305961      18.396407      20.806453    
    202000   1.0819713      18.552102      20.255136    
    203000   1.0186927      18.065702      20.232686    
    204000   0.99139141     18.26582       19.844979    
    205000   0.87429147     18.551965      19.461508    
    206000   0.98404163     17.789098      19.119349    
    207000   1.0134243      18.602088      18.950798    
    208000   1.0264664      18.30081       18.660486    
    209000   1.0489983      18.501902      17.957332    
    210000   0.99036709     18.873525      17.648143    
    211000   1.105763       18.730832      17.363532    
    212000   0.99793634     18.104917      17.308337    
    213000   1.018823       18.024221      17.11335     
    214000   0.99981791     17.527981      17.145079    
    215000   1.054783       18.845067      16.871922    
    216000   0.96534382     17.92959       16.735531    
    217000   1.0120923      18.581353      16.376057    
    218000   0.98009095     18.640301      16.109415    
    219000   0.90429536     18.551113      15.456158    
    220000   0.98334467     17.707408      15.181628    
    221000   0.97150333     18.11801       14.626729    
    222000   0.97411854     18.837569      14.289954    
    223000   1.0260239      18.146241      14.139903    
    224000   1.0580845      18.743017      13.484152    
    225000   1.0003297      18.19708       12.842736    
    226000   1.0136575      16.794732      12.424364    
    227000   0.95059878     18.656229      12.431609    
    228000   1.0772352      18.792074      12.465934    
    229000   0.99296137     17.998298      12.066863    
    230000   0.91632704     18.914034      11.931073    
    231000   0.98342577     17.956148      12.030507    
    232000   0.99248322     17.869467      11.775919    
    233000   0.99687489     17.689064      11.707313    
    234000   0.97583476     18.350589      11.528589    
    235000   0.99767495     18.568677      11.251059    
    236000   0.99656492     18.097349      10.875948    
    237000   0.95138639     17.822735      10.71291     
    238000   0.98184989     18.11239       10.751971    
    239000   0.88246891     17.779086      10.685871    
    240000   0.93569793     18.273848      10.658073    
    241000   0.96562623     18.01342       11.042499    
    242000   0.99909614     18.108195      10.55209     
    243000   0.96241338     18.14619       10.322843    
    244000   0.99868742     17.40937       10.13994     
    245000   1.0740335      18.438012      9.642396     
    246000   1.0525801      18.22708       9.9571303    
    247000   1.0339254      18.428413      9.8636445    
    248000   1.0283942      17.983819      9.4960465    
    249000   0.98678314     17.498985      9.1227688    
    250000   0.9658769      17.52017       8.8930396    
    251000   0.95872486     17.801073      8.8011225    
    252000   1.066839       17.878885      8.3239961    
    253000   1.0127027      18.029146      7.8169468    
    254000   0.93786222     17.725807      7.6404745    
    255000   1.0833315      17.537234      7.2297018    
    256000   1.0545101      17.581764      7.3257864    
    257000   0.9134388      18.232728      7.1846145    
Fix halt condition for fix-id 3 met on step 258000 with value 6.7733294138078595 (src/fix_halt.cpp:237)
    258000   1.0273363      17.337598      6.7733294    
Loop time of 286.721 on 2 procs for 158000 steps with 400 atoms

Performance: 476114.587 tau/day, 551.059 timesteps/s
105.7% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 8.9652     | 8.9652     | 8.9652     |   0.0 |  3.13
Bond    | 1.7831     | 1.7831     | 1.7831     |   0.0 |  0.62
Neigh   | 271.94     | 271.94     | 271.94     |   0.0 | 94.84
Comm    | 0.042156   | 0.042156   | 0.042156   |   0.0 |  0.01
Output  | 0.30154    | 0.30154    | 0.30154    |   0.0 |  0.11
Modify  | 3.3668     | 3.3668     | 3.3668     |   0.0 |  1.17
Other   |            | 0.3224     |            |       |  0.11

Nlocal:            400 ave         400 max         400 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:          43174 ave       43174 max       43174 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 43174
Ave neighs/atom = 107.935
Ave special neighs/atom = 1.995
Neighbor list builds = 1391
Dangerous builds = 0

# This simulation is done
# Move onto the next one
clear
  using 2 OpenMP thread(s) per MPI task
package omp 0
using multi-threaded neighbor list subroutines
next f
jump SELF

###
# Reference paper:
# K. Kremer and G. S. Grest
# Dynamics of entangled linear polymer melts: A molecular-dynamics simulation
# J Chem Phys 92, 5057 (1990)

##################################
# MIHIR: for branched polymers
# LJ minimum first to expand and explore, then collapse
###

###
# Looping through the various tshaped polymers to simulate,
# define variables to switch through
variable f index bb66nuc1bl33bn3d30tot100 bb133nuc1bl66bn3d30tot200 bb200nuc1bl100bn3d30tot300 bb266nuc1bl133bn3d30tot400 bb333nuc1bl166bn3d30tot500 bb400nuc1bl200bn3d30tot600 bb466nuc1bl233bn3d30tot700 bb533nuc1bl266bn3d30tot800 bb600nuc1bl300bn3d30tot900 bb666nuc1bl333bn3d30tot1000 bb733nuc1bl366bn3d30tot1100 bb800nuc1bl400bn3d30tot1200
###


###
# Box and units  (use LJ units and periodic boundaries)
###

units lj
log tshaped/logs2/$f.log
log tshaped/logs2/bb333nuc1bl166bn3d30tot500.log

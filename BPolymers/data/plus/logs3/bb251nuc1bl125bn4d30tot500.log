#atom_style bond #no stiffness
atom_style angle #with stiffness

boundary        p p p
###
# Pair interactions require lists of neighbours to be calculated
###

#neighbor 0.3 bin
neighbor 4 bin

neigh_modify every 1 delay 1 check yes
atom_modify sort 0 0
### Generate RESTART file, SPECIAL format, not a .txt file ###
### Useful if simulation crashes ###

restart 1000000 plusshaped/restarts3/$f.restart
restart 1000000 plusshaped/restarts3/bb251nuc1bl125bn4d30tot500.restart
#############################



### READ "start" data file ###

read_data plusshaped/$f.dat
read_data plusshaped/bb251nuc1bl125bn4d30tot500.dat
Reading data file ...
  orthogonal box = (-1000 -1000 -1000) to (1000 1000 1000)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  501 atoms
  scanning bonds ...
  3 = max bonds/atom
  scanning angles ...
  6 = max angles/atom
  reading bonds ...
  500 bonds
  reading angles ...
  502 angles
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        0        0       
  special bond factors coul:  0        0        0       
     4 = max # of 1-2 neighbors
     4 = max # of 1-3 neighbors
     8 = max # of 1-4 neighbors
    12 = max # of special neighbors
  special bonds CPU = 0.000 seconds
  read_data CPU = 0.051 seconds

######################

### READ "REstart" data file ###

######################



###
# Define groups (atom type 1 is group 'all')
###
group all type 1
501 atoms in group all


###
# Dump configs - "simple dumpings"
###

###
# Dump configs + box coords
###

dump   1   all   custom   1000  plusshaped/trjs3/$f.lammpstrj  id  x y z  ix iy iz
dump   1   all   custom   1000  plusshaped/trjs3/bb251nuc1bl125bn4d30tot500.lammpstrj  id  x y z  ix iy iz
dump_modify   1   format line "%d %.5f %.5f %.5f %d %d %d"

########################################################################


###################################################################
# Stiffness term
#
# E = K * (1+cos(theta)), K>0
#
angle_style   cosine
#change this coefficient to change stiffness (e.g. 1,5,10)
angle_coeff   1 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  Lennard-Jones 12-6 potential with cutoff:
#  potential E=4epsilon[ (sigma/r)^12 - (sigma/r)^6]  for r<r_cut
#
#  1.12246 = 2^(1/6) is the minimum of the potential


pair_style      lj/cut 1.12246152962189
#pair_style      lj/cut 3

#
#  pair_modify shift yes adds a constant to the potential such

#  that E(r_cut)=0. Forces remains unchanged.
#

pair_modify     shift yes

#
#  pair_coeff for lj/cut, specify 4:
#    * atom type interacting with
#    * atom type
#    * epsilon (energy units)
#    * sigma (distance units)
#

pair_coeff      1 1 1.0 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  soft potential, for PUSHING apart overlapping atoms
#  potential E=A*(1 + cos(pi*r/r_c))
#
#  1.12246 = 2^(1/6) is the cut-off r_c

#pair_style     soft 1.12246152962189

#
#  pair_coeff for soft, specify 3:
#    * atom type interacting with
#    * atom type
#    * A
#
#

#pair_coeff      1 1 100.0
###################################################################

###################################################################
# Pair interaction between bonded atoms
#
# Fene potential + Lennard Jones 12-6:

#
#  E= - 0.5 K R0^2 ln[ 1- (r/R0)^2]
#     + 4epsilon[ (sigma/r)^12 - (sigma/r)^6] + epsilon
#

bond_style   fene


#
# For style fene, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#   * epsilon (energy)  (LJ component)
#   * sigma (distance)  (LJ component)
#


special_bonds fene #<=== I M P O R T A N T (new command)
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        1        1       
  special bond factors coul:  0        1        1       
     4 = max # of 1-2 neighbors
    12 = max # of special neighbors
  special bonds CPU = 0.000 seconds

bond_coeff   1   30   2   1.0   1.0


###################################################

###################################################################
# Pair interaction between bonded atoms
#
# Harmonic potential:
#
#  E= K * (R-R0)^2
#

#bond_style   harmonic

#
# For style harmonic, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#

#bond_coeff   1   60.0   1.0
#bond_coeff   2   harmonic 0.1   1.0

###################################################
compute 1 all gyration
variable rog equal c_1
#compute 2 all coord/atom cutoff 1.1

#dump 2 all custom 10000 contact_number.dump id c_2


###
# Set up fixes
###
thermo_style   custom   step  temp enthalpy c_1
fix 1 all nve   ###NVE ensemble

fix 2 all   langevin   1.0 1.0 1.0  158102   ###Langevin integrator Tstart Tstop 1/friction rndseed


##### Sample thermodynamic info  (temperature, energy, pressure, etc.) #####
thermo 1000









############################################################################

###
# set timestep of integrator

timestep 0.01

###
# run integration for a number of steps
###
#run 0
#variable r equal c_1
#if "$r < 63.1" then "quit 1"

# lj potential minimum, cause molecule to explore
run 100000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Neighbor list info ...
  update: every = 1 steps, delay = 1 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 5.1224615
  ghost atom cutoff = 5.1224615
  binsize = 2.5612308, bins = 781 781 781
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut/omp, perpetual
      attributes: half, newton on, omp
      pair build: half/bin/newton/omp
      stencil: half/bin/3d
      bin: standard
WARNING: Communication cutoff 5.12246152962189 is shorter than a bond length based estimate of 5.455. This may lead to errors. (src/comm.cpp:723)
Per MPI rank memory allocation (min/avg/max) = 1861 | 1861 | 1861 Mbytes
   Step          Temp         Enthalpy         c_1      
         0   0              13.166229      65.891059    
      1000   0.93121358     17.825364      64.765826    
      2000   1.0239593      18.405785      63.716916    
      3000   0.9852657      19.107774      62.685861    
      4000   0.9592904      18.378713      61.702526    
      5000   1.0456691      18.846164      60.822762    
      6000   0.98564189     18.488031      60.281028    
      7000   1.0135909      19.034813      59.672247    
      8000   1.0926688      20.407287      58.928008    
      9000   1.041414       20.01516       58.221525    
     10000   0.95067679     19.55005       57.950185    
     11000   0.98152249     19.407642      57.409089    
     12000   1.0244382      19.369911      57.078412    
     13000   0.95413662     18.843599      56.697412    
     14000   0.99874869     19.711337      56.111112    
     15000   1.0440537      20.251893      55.673945    
     16000   1.0019427      20.023281      54.9268      
     17000   1.0009546      20.674102      54.694291    
     18000   0.9063937      19.56451       54.511217    
     19000   0.96462089     19.96931       54.198977    
     20000   0.98553116     19.774836      53.831214    
     21000   0.95801946     19.517715      53.350874    
     22000   1.0300715      19.825513      53.197122    
     23000   0.94953278     19.859695      52.944381    
     24000   0.99468027     20.001994      52.469052    
     25000   0.98571786     18.904858      52.115509    
     26000   0.95762714     19.821012      51.770542    
     27000   1.0173167      19.899535      51.46237     
     28000   0.97326088     20.012666      51.494015    
     29000   1.0285941      19.969489      50.964084    
     30000   0.99283348     20.389933      50.607751    
     31000   0.95261125     19.83576       50.336729    
     32000   0.93966063     20.360716      50.091783    
     33000   0.99628646     20.207025      49.945071    
     34000   1.0226622      20.025415      49.749277    
     35000   0.94921148     19.724198      49.14487     
     36000   0.99385964     20.126671      48.967998    
     37000   1.0335973      20.116444      48.934748    
     38000   0.94938767     20.566503      48.826679    
     39000   0.99255607     20.218765      48.556314    
     40000   0.99158724     20.227807      48.329743    
     41000   1.0051401      19.726936      47.869857    
     42000   1.0290129      19.966369      47.67516     
     43000   1.0254524      19.860663      47.540964    
     44000   1.0288958      20.140398      47.143679    
     45000   0.99786885     19.913144      47.207477    
     46000   1.0378297      20.159922      46.951305    
     47000   0.97502939     20.244565      46.708413    
     48000   0.97830091     19.58592       46.364389    
     49000   1.0063103      20.2736        46.049251    
     50000   1.0269992      20.436339      45.831219    
     51000   0.98095623     20.066171      45.685373    
     52000   0.97531826     20.732699      45.55945     
     53000   0.93385308     19.659766      45.206029    
     54000   1.0032254      19.671124      45.140832    
     55000   1.0358567      20.859351      45.207656    
     56000   1.005604       20.755821      44.901009    
     57000   0.9779625      20.056767      44.961693    
     58000   0.96644953     20.301198      44.825626    
     59000   0.93171969     19.765103      44.546446    
     60000   1.0071796      20.354741      44.117763    
     61000   0.9403856      19.419472      43.730536    
     62000   1.0925642      21.518671      43.635582    
     63000   0.96182207     19.880699      43.646132    
     64000   0.98980332     20.632962      43.445758    
     65000   1.0007949      20.423153      43.451934    
     66000   0.96650644     20.610579      43.779112    
     67000   0.97322274     20.09624       43.732298    
     68000   1.0455716      20.22544       43.800951    
     69000   1.0619076      20.808488      44.006763    
     70000   1.000191       19.822181      44.048236    
     71000   1.0116858      20.226202      44.35209     
     72000   1.0388412      20.774588      44.479732    
     73000   1.0308379      19.689332      44.255807    
     74000   0.98437519     20.346514      44.089795    
     75000   0.97377465     20.944317      43.760252    
     76000   0.99788943     19.89003       43.622558    
     77000   0.9200076      19.606475      43.42137     
     78000   1.0622675      20.847098      43.24193     
     79000   0.95370118     19.767563      43.093887    
     80000   1.0628763      21.046396      43.130706    
     81000   0.96716812     20.527063      43.173174    
     82000   0.91866073     19.634044      43.203761    
     83000   0.97417302     19.922718      43.127137    
     84000   1.0768212      20.121514      42.760708    
     85000   0.96125129     20.77855       42.180098    
     86000   1.0490089      20.99579       41.998736    
     87000   0.97213625     20.406205      42.157828    
     88000   1.0450608      20.294647      41.991781    
     89000   0.98839006     20.34349       41.813299    
     90000   1.0331406      19.844056      41.828389    
     91000   1.0422134      20.280073      41.683405    
     92000   0.9849131      20.681776      41.243111    
     93000   1.0093524      20.649567      40.996328    
     94000   1.0078544      19.920719      40.504911    
     95000   1.0417816      20.638613      39.970071    
     96000   0.98498374     20.014929      40.186684    
     97000   1.074583       20.070241      40.105369    
     98000   0.95502739     20.51255       39.853449    
     99000   1.0018967      20.634764      39.385746    
    100000   0.97010474     20.321833      39.001502    
Loop time of 377.4 on 2 procs for 100000 steps with 501 atoms

Performance: 228934.601 tau/day, 264.971 timesteps/s
101.4% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.56828    | 0.56828    | 0.56828    |   0.0 |  0.15
Bond    | 1.0586     | 1.0586     | 1.0586     |   0.0 |  0.28
Neigh   | 373.17     | 373.17     | 373.17     |   0.0 | 98.88
Comm    | 0.023208   | 0.023208   | 0.023208   |   0.0 |  0.01
Output  | 0.17844    | 0.17844    | 0.17844    |   0.0 |  0.05
Modify  | 2.2254     | 2.2254     | 2.2254     |   0.0 |  0.59
Other   |            | 0.1761     |            |       |  0.05

Nlocal:            501 ave         501 max         501 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           3498 ave        3498 max        3498 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 3498
Ave neighs/atom = 6.9820359
Ave special neighs/atom = 1.996008
Neighbor list builds = 1081
Dangerous builds = 0

# Replace lj potential, now collapse
pair_style      lj/cut 3

# Cutoff simul when gyration under 5
# Variable created with equal requires v_ + 'name'
fix 3 all halt 1000 v_rog < 7

run 5000000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Per MPI rank memory allocation (min/avg/max) = 1861 | 1861 | 1861 Mbytes
   Step          Temp         Enthalpy         c_1      
    100000   0.97010474     19.49024       39.001502    
    101000   0.99254593     19.835023      38.999616    
    102000   1.0057395      19.756217      38.409717    
    103000   0.95918203     19.169402      38.291496    
    104000   1.0000571      19.986368      38.131355    
    105000   1.0580213      19.645126      38.169711    
    106000   0.98060645     19.069476      38.068934    
    107000   0.97189343     19.295563      37.73951     
    108000   0.92175015     20.152432      37.668072    
    109000   0.99123514     19.191051      37.641314    
    110000   0.98627924     20.076317      37.288439    
    111000   1.0058486      19.13217       37.28813     
    112000   1.0184421      19.418331      36.707615    
    113000   0.93629042     19.031941      36.470105    
    114000   1.0485418      19.400724      36.349339    
    115000   1.0070911      19.034882      35.895981    
    116000   1.0070387      18.883112      35.495767    
    117000   1.0091783      18.928688      35.086802    
    118000   1.0441181      19.390566      34.76311     
    119000   0.99969962     19.278743      34.142976    
    120000   0.96364639     19.193737      33.717727    
    121000   0.95831268     19.883314      33.481343    
    122000   1.0251928      18.653684      33.175753    
    123000   0.99665805     19.533944      32.904299    
    124000   0.98308581     18.512536      32.691146    
    125000   0.92545463     18.334985      32.10118     
    126000   0.97998316     18.595288      31.439366    
    127000   1.0053104      19.185433      31.176742    
    128000   1.0227976      19.07744       30.855749    
    129000   0.98851838     18.699706      30.481272    
    130000   1.0069695      18.373181      30.163886    
    131000   0.95329241     17.898261      29.598419    
    132000   0.99369916     19.062043      29.495758    
    133000   1.0611693      18.59988       29.297097    
    134000   0.97404877     19.053288      29.201057    
    135000   1.0389387      17.837891      28.764457    
    136000   1.0255507      18.276266      28.299207    
    137000   1.0417088      18.711325      28.301195    
    138000   0.97318475     18.521267      27.907367    
    139000   1.0325865      18.7051        27.517933    
    140000   1.0321513      19.033667      27.285439    
    141000   0.98259738     17.985202      27.201467    
    142000   1.0297525      18.933651      26.781584    
    143000   0.95454829     18.255602      26.594219    
    144000   0.99017894     19.065723      26.497091    
    145000   0.98085906     17.32672       26.083923    
    146000   1.0257951      17.849212      25.842072    
    147000   1.0120692      18.427512      25.565867    
    148000   1.0106265      18.867251      25.722689    
    149000   1.0278858      18.360814      25.539769    
    150000   0.99880829     18.032801      25.50292     
    151000   1.0428033      18.86178       25.131667    
    152000   0.98894727     18.42393       24.843914    
    153000   1.0611041      18.296007      24.902207    
    154000   0.94281702     18.314231      25.124385    
    155000   0.96692993     17.929571      24.725758    
    156000   1.0092181      19.153822      24.82503     
    157000   0.98361958     18.10659       24.821396    
    158000   0.99578433     18.450416      25.03697     
    159000   1.0232587      18.600625      24.567334    
    160000   1.0255052      18.18346       23.951138    
    161000   1.0060351      17.789264      23.703947    
    162000   1.0468217      18.124541      23.796412    
    163000   1.0637025      18.902964      23.508984    
    164000   1.0795198      18.984269      23.258874    
    165000   1.0530092      18.196101      23.029136    
    166000   0.98576496     18.322988      22.92107     
    167000   1.0107168      18.171567      22.76227     
    168000   1.020525       18.768565      22.451141    
    169000   1.0064697      18.596774      22.281764    
    170000   0.92103588     17.964094      21.781383    
    171000   0.99138786     18.129101      21.58413     
    172000   1.0332943      17.914216      21.355137    
    173000   1.009286       19.047895      21.196123    
    174000   1.0660351      18.552577      20.529477    
    175000   1.0137023      18.412992      20.502164    
    176000   0.98755084     18.080927      20.306506    
    177000   1.0090932      17.820539      20.119048    
    178000   0.95395349     17.228262      19.836973    
    179000   1.0152085      17.966603      19.85236     
    180000   1.0071279      18.140877      19.694899    
    181000   1.0450779      18.16456       19.397075    
    182000   0.98658042     18.063674      19.473859    
    183000   0.96589523     18.887958      19.091069    
    184000   1.0137884      17.719478      18.879747    
    185000   1.0013251      17.3543        18.775391    
    186000   0.98095305     17.983066      18.076601    
    187000   0.99044142     17.617546      17.820486    
    188000   0.9925687      17.267426      17.469161    
    189000   1.0162003      18.367867      17.529815    
    190000   1.0433668      17.836984      17.253727    
    191000   1.0510103      18.253535      16.89155     
    192000   1.0129948      17.747439      16.70959     
    193000   1.0017996      17.867771      16.644694    
    194000   1.0108441      18.01355       16.219571    
    195000   0.94166982     17.732014      15.914643    
    196000   0.97807473     17.901021      15.475681    
    197000   0.98036953     18.347913      15.400943    
    198000   0.97895694     17.688245      15.052161    
    199000   0.97123563     17.887258      14.811294    
    200000   1.0649244      17.606609      14.401093    
    201000   0.99943474     18.074162      14.025244    
    202000   0.96163867     17.916001      13.614138    
    203000   0.96649191     17.708521      13.153731    
    204000   1.0371206      17.735877      13.412709    
    205000   0.9713316      17.491431      13.17585     
    206000   0.99693383     18.140571      12.612555    
    207000   1.0082708      18.16146       12.730273    
    208000   1.0285887      17.292937      12.202747    
    209000   1.010213       18.040979      11.766949    
    210000   0.97575704     18.451433      11.561569    
    211000   0.97420043     17.348003      11.338349    
    212000   0.99252991     17.093785      10.950299    
    213000   0.92749609     17.682344      11.076591    
    214000   0.97691121     17.489428      10.568729    
    215000   1.0354192      17.215601      10.650155    
    216000   0.91712284     16.331428      10.356503    
    217000   1.0128961      17.526443      10.019591    
    218000   0.97802685     17.813161      9.2277643    
    219000   1.0368046      17.525935      9.2953542    
    220000   1.0067285      18.05896       9.2382255    
    221000   0.94762539     17.460663      8.9450995    
    222000   0.99657541     18.237611      8.8377813    
    223000   0.97144562     17.081239      8.6820226    
    224000   1.0401709      18.079314      8.3685342    
    225000   0.99596115     17.571039      8.1291374    
    226000   1.001815       17.733528      7.6242255    
    227000   0.99144338     17.082454      7.3645624    
    228000   0.97241217     17.653211      7.197951     
Fix halt condition for fix-id 3 met on step 229000 with value 6.858183148072532 (src/fix_halt.cpp:237)
    229000   0.98478574     17.399505      6.8581831    
Loop time of 176.424 on 2 procs for 129000 steps with 501 atoms

Performance: 631751.501 tau/day, 731.194 timesteps/s
111.2% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 12.147     | 12.147     | 12.147     |   0.0 |  6.89
Bond    | 1.7717     | 1.7717     | 1.7717     |   0.0 |  1.00
Neigh   | 158.34     | 158.34     | 158.34     |   0.0 | 89.75
Comm    | 0.03785    | 0.03785    | 0.03785    |   0.0 |  0.02
Output  | 0.23007    | 0.23007    | 0.23007    |   0.0 |  0.13
Modify  | 3.5991     | 3.5991     | 3.5991     |   0.0 |  2.04
Other   |            | 0.2994     |            |       |  0.17

Nlocal:            501 ave         501 max         501 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:          57612 ave       57612 max       57612 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 57612
Ave neighs/atom = 114.99401
Ave special neighs/atom = 1.996008
Neighbor list builds = 1146
Dangerous builds = 0

# This simulation is done
# Move onto the next one
clear
  using 2 OpenMP thread(s) per MPI task
package omp 0
using multi-threaded neighbor list subroutines
next f
jump SELF

###
# Reference paper:
# K. Kremer and G. S. Grest
# Dynamics of entangled linear polymer melts: A molecular-dynamics simulation
# J Chem Phys 92, 5057 (1990)

##################################
# MIHIR: for branched polymers
# LJ minimum first to expand and explore, then collapse
###

###
# Looping through the various plusshaped polymers to simulate,
# define variables to switch through
variable f index bb51nuc1bl25bn4d30tot100 bb101nuc1bl50bn4d30tot200 bb151nuc1bl75bn4d30tot300 bb201nuc1bl100bn4d30tot400 bb251nuc1bl125bn4d30tot500 bb301nuc1bl150bn4d30tot600 bb351nuc1bl175bn4d30tot700 bb401nuc1bl200bn4d30tot800 bb451nuc1bl225bn4d30tot900 bb501nuc1bl250bn4d30tot1000 bb551nuc1bl275bn4d30tot1100 bb601nuc1bl300bn4d30tot1200
###


###
# Box and units  (use LJ units and periodic boundaries)
###

units lj
log plusshaped/logs3/$f.log
log plusshaped/logs3/bb301nuc1bl150bn4d30tot600.log

#atom_style bond #no stiffness
atom_style angle #with stiffness

boundary        p p p
###
# Pair interactions require lists of neighbours to be calculated
###

#neighbor 0.3 bin
neighbor 4 bin

neigh_modify every 1 delay 1 check yes
atom_modify sort 0 0
### Generate RESTART file, SPECIAL format, not a .txt file ###
### Useful if simulation crashes ###

restart 1000000 tshaped/restarts2/$f.restart
restart 1000000 tshaped/restarts2/bb133nuc1bl66bn3d30tot200.restart
#############################



### READ "start" data file ###

read_data tshaped/$f.dat
read_data tshaped/bb133nuc1bl66bn3d30tot200.dat
Reading data file ...
  orthogonal box = (-1000 -1000 -1000) to (1000 1000 1000)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  199 atoms
  scanning bonds ...
  2 = max bonds/atom
  scanning angles ...
  3 = max angles/atom
  reading bonds ...
  198 bonds
  reading angles ...
  198 angles
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        0        0       
  special bond factors coul:  0        0        0       
     3 = max # of 1-2 neighbors
     3 = max # of 1-3 neighbors
     6 = max # of 1-4 neighbors
     9 = max # of special neighbors
  special bonds CPU = 0.001 seconds
  read_data CPU = 0.050 seconds

######################

### READ "REstart" data file ###

######################



###
# Define groups (atom type 1 is group 'all')
###
group all type 1
199 atoms in group all


###
# Dump configs - "simple dumpings"
###

###
# Dump configs + box coords
###

dump   1   all   custom   1000  tshaped/trjs2/$f.lammpstrj  id  x y z  ix iy iz
dump   1   all   custom   1000  tshaped/trjs2/bb133nuc1bl66bn3d30tot200.lammpstrj  id  x y z  ix iy iz
dump_modify   1   format line "%d %.5f %.5f %.5f %d %d %d"

########################################################################


###################################################################
# Stiffness term
#
# E = K * (1+cos(theta)), K>0
#
angle_style   cosine
#change this coefficient to change stiffness (e.g. 1,5,10)
angle_coeff   1 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  Lennard-Jones 12-6 potential with cutoff:
#  potential E=4epsilon[ (sigma/r)^12 - (sigma/r)^6]  for r<r_cut
#
#  1.12246 = 2^(1/6) is the minimum of the potential


pair_style      lj/cut 1.12246152962189
#pair_style      lj/cut 3

#
#  pair_modify shift yes adds a constant to the potential such

#  that E(r_cut)=0. Forces remains unchanged.
#

pair_modify     shift yes

#
#  pair_coeff for lj/cut, specify 4:
#    * atom type interacting with
#    * atom type
#    * epsilon (energy units)
#    * sigma (distance units)
#

pair_coeff      1 1 1.0 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  soft potential, for PUSHING apart overlapping atoms
#  potential E=A*(1 + cos(pi*r/r_c))
#
#  1.12246 = 2^(1/6) is the cut-off r_c

#pair_style     soft 1.12246152962189

#
#  pair_coeff for soft, specify 3:
#    * atom type interacting with
#    * atom type
#    * A
#
#

#pair_coeff      1 1 100.0
###################################################################

###################################################################
# Pair interaction between bonded atoms
#
# Fene potential + Lennard Jones 12-6:

#
#  E= - 0.5 K R0^2 ln[ 1- (r/R0)^2]
#     + 4epsilon[ (sigma/r)^12 - (sigma/r)^6] + epsilon
#

bond_style   fene


#
# For style fene, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#   * epsilon (energy)  (LJ component)
#   * sigma (distance)  (LJ component)
#


special_bonds fene #<=== I M P O R T A N T (new command)
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        1        1       
  special bond factors coul:  0        1        1       
     3 = max # of 1-2 neighbors
     9 = max # of special neighbors
  special bonds CPU = 0.000 seconds

bond_coeff   1   30   2   1.0   1.0


###################################################

###################################################################
# Pair interaction between bonded atoms
#
# Harmonic potential:
#
#  E= K * (R-R0)^2
#

#bond_style   harmonic

#
# For style harmonic, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#

#bond_coeff   1   60.0   1.0
#bond_coeff   2   harmonic 0.1   1.0

###################################################
compute 1 all gyration
variable rog equal c_1
#compute 2 all coord/atom cutoff 1.1

#dump 2 all custom 10000 contact_number.dump id c_2


###
# Set up fixes
###
thermo_style   custom   step  temp enthalpy c_1
fix 1 all nve   ###NVE ensemble

fix 2 all   langevin   1.0 1.0 1.0  778655   ###Langevin integrator Tstart Tstop 1/friction rndseed


##### Sample thermodynamic info  (temperature, energy, pressure, etc.) #####
thermo 1000









############################################################################

###
# set timestep of integrator

timestep 0.01

###
# run integration for a number of steps
###
#run 0
#variable r equal c_1
#if "$r < 63.1" then "quit 1"

# lj potential minimum, cause molecule to explore
run 100000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Neighbor list info ...
  update: every = 1 steps, delay = 1 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 5.1224615
  ghost atom cutoff = 5.1224615
  binsize = 2.5612308, bins = 781 781 781
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut/omp, perpetual
      attributes: half, newton on, omp
      pair build: half/bin/newton/omp
      stencil: half/bin/3d
      bin: standard
WARNING: Communication cutoff 5.12246152962189 is shorter than a bond length based estimate of 5.455. This may lead to errors. (src/comm.cpp:723)
Per MPI rank memory allocation (min/avg/max) = 1860 | 1860 | 1860 Mbytes
   Step          Temp         Enthalpy         c_1      
         0   0              13.144735      35.289898    
      1000   1.1252531      18.801158      33.520743    
      2000   1.0068795      18.856307      31.875534    
      3000   1.05159        18.577599      31.031333    
      4000   0.95947478     19.328473      30.461998    
      5000   0.99905658     20.191958      29.680102    
      6000   0.95244307     19.555493      28.723672    
      7000   1.0472743      20.120916      27.982846    
      8000   1.0070523      20.791347      27.283401    
      9000   1.0597539      19.865759      26.746783    
     10000   0.92709701     19.823857      26.35369     
     11000   1.03657        19.917996      26.199856    
     12000   1.0951665      20.375576      26.21083     
     13000   1.0515186      20.814388      25.265035    
     14000   0.89278454     19.34075       24.980892    
     15000   1.0758469      19.813747      24.859214    
     16000   1.0309941      20.130422      24.393815    
     17000   0.98198055     19.655094      24.118546    
     18000   0.95290027     20.487133      24.178307    
     19000   1.0178869      21.306438      24.631804    
     20000   0.98022128     21.701679      24.419518    
     21000   1.0649446      21.37326       24.257426    
     22000   0.98376637     20.798135      23.840978    
     23000   1.0020916      20.474366      23.633945    
     24000   1.1154206      20.613529      24.016733    
     25000   0.98602448     19.363895      23.801626    
     26000   0.97018653     20.682532      24.135299    
     27000   1.0280245      20.605492      23.621839    
     28000   1.0153862      20.523611      22.661726    
     29000   0.92547434     21.17265       21.882517    
     30000   0.97584425     19.395277      21.481902    
     31000   1.0670318      20.051943      20.987238    
     32000   1.0659081      19.827767      21.225837    
     33000   0.94475995     20.378333      20.968521    
     34000   1.0556459      22.676693      20.81868     
     35000   0.97085226     19.817907      20.924295    
     36000   1.0920585      19.754134      20.99894     
     37000   1.1195594      20.088385      20.438796    
     38000   1.0414959      20.680247      20.1179      
     39000   0.93124586     20.063832      19.534724    
     40000   1.0613028      21.377463      19.126545    
     41000   1.0926969      21.079997      19.186282    
     42000   1.1287734      21.027531      19.63381     
     43000   1.0804211      20.072584      19.033947    
     44000   1.0257039      20.475519      18.791015    
     45000   0.95709513     20.362064      18.242157    
     46000   1.1128254      20.377881      17.502733    
     47000   1.1566465      20.752364      17.0388      
     48000   1.0662509      19.94521       16.896505    
     49000   1.0125956      20.456249      17.3564      
     50000   0.98936006     19.862588      16.891601    
     51000   0.92198687     20.265572      16.631629    
     52000   0.95974576     20.69012       16.633783    
     53000   1.0235758      19.977579      16.207454    
     54000   1.0289916      20.507352      16.272433    
     55000   0.88397415     20.201972      16.324861    
     56000   1.0162734      21.216826      16.298361    
     57000   0.94844767     20.159342      15.868582    
     58000   0.96570466     20.222785      15.643308    
     59000   0.92229799     20.678622      16.099558    
     60000   0.98378893     20.167808      15.861211    
     61000   0.9831972      20.672838      16.095502    
     62000   1.0230422      20.039302      16.029702    
     63000   0.94931091     19.242808      15.764298    
     64000   0.83740215     18.630943      15.527469    
     65000   0.91977098     19.283626      15.765127    
     66000   1.0857208      20.549581      16.050536    
     67000   0.94581024     20.711269      15.736437    
     68000   1.0727229      21.036593      15.473023    
     69000   0.98625885     20.106351      15.685428    
     70000   0.91286728     19.659552      15.969966    
     71000   1.0704314      21.770879      16.251321    
     72000   0.97052392     20.680336      16.287059    
     73000   1.0542169      20.031621      16.324031    
     74000   1.0462953      20.699996      16.235076    
     75000   0.92939964     20.347444      16.435482    
     76000   1.0414402      20.86367       16.123079    
     77000   0.99073683     20.14886       16.165049    
     78000   1.0581837      21.303364      15.445133    
     79000   0.9491377      19.960114      16.084406    
     80000   0.98219782     21.48612       15.593102    
     81000   0.93977632     20.866239      15.976064    
     82000   0.9547171      19.362947      15.91445     
     83000   1.0470701      21.12696       15.185218    
     84000   1.066506       21.329831      15.161625    
     85000   1.0183696      19.949255      14.775392    
     86000   0.91974899     20.910012      14.318611    
     87000   0.97952613     20.403128      14.296351    
     88000   1.055508       20.028424      14.024313    
     89000   0.94520727     19.652855      14.38842     
     90000   0.95497279     21.035628      14.290651    
     91000   0.96066134     20.624333      14.51861     
     92000   0.96203856     20.524983      14.358885    
     93000   0.99658191     19.935742      13.880117    
     94000   1.1928784      20.845656      13.889821    
     95000   0.94056632     20.934217      14.264415    
     96000   1.0310578      20.052741      14.106157    
     97000   0.99125031     20.356406      13.601596    
     98000   0.98214505     19.478201      13.448604    
     99000   0.96010559     20.511687      12.797902    
    100000   1.0058029      20.138418      12.385399    
Loop time of 608.707 on 2 procs for 100000 steps with 199 atoms

Performance: 141940.105 tau/day, 164.283 timesteps/s
100.6% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.41596    | 0.41596    | 0.41596    |   0.0 |  0.07
Bond    | 0.67933    | 0.67933    | 0.67933    |   0.0 |  0.11
Neigh   | 606.05     | 606.05     | 606.05     |   0.0 | 99.56
Comm    | 0.024282   | 0.024282   | 0.024282   |   0.0 |  0.00
Output  | 0.16397    | 0.16397    | 0.16397    |   0.0 |  0.03
Modify  | 1.253      | 1.253      | 1.253      |   0.0 |  0.21
Other   |            | 0.1184     |            |       |  0.02

Nlocal:            199 ave         199 max         199 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           1954 ave        1954 max        1954 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 1954
Ave neighs/atom = 9.8190955
Ave special neighs/atom = 1.9899497
Neighbor list builds = 989
Dangerous builds = 0

# Replace lj potential, now collapse
pair_style      lj/cut 3

# Cutoff simul when gyration under 5
# Variable created with equal requires v_ + 'name'
fix 3 all halt 1000 v_rog < 7

run 5000000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Per MPI rank memory allocation (min/avg/max) = 1860 | 1860 | 1860 Mbytes
   Step          Temp         Enthalpy         c_1      
    100000   1.0058029      19.143564      12.385399    
    101000   0.90073113     19.083001      12.025933    
    102000   0.96234884     18.528874      11.149885    
    103000   1.0010607      18.265257      10.651639    
    104000   1.0381964      17.851032      10.660085    
    105000   0.98470308     19.544497      10.670405    
    106000   1.0151677      18.936166      10.042657    
    107000   1.0255906      18.909499      9.6407832    
    108000   0.97620169     18.907181      9.1422488    
    109000   1.0011566      18.879045      8.8610812    
    110000   0.94657492     18.254044      8.7196691    
    111000   0.98331412     18.552039      7.7013545    
    112000   1.0180243      18.234685      7.5035603    
    113000   1.004187       18.65767       7.0473647    
Fix halt condition for fix-id 3 met on step 114000 with value 6.452840423652443 (src/fix_halt.cpp:237)
    114000   0.99040715     17.491206      6.4528404    
Loop time of 25.7239 on 2 procs for 14000 steps with 199 atoms

Performance: 470223.852 tau/day, 544.241 timesteps/s
103.0% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.32006    | 0.32006    | 0.32006    |   0.0 |  1.24
Bond    | 0.098859   | 0.098859   | 0.098859   |   0.0 |  0.38
Neigh   | 25.078     | 25.078     | 25.078     |   0.0 | 97.49
Comm    | 0.0034254  | 0.0034254  | 0.0034254  |   0.0 |  0.01
Output  | 0.023477   | 0.023477   | 0.023477   |   0.0 |  0.09
Modify  | 0.18161    | 0.18161    | 0.18161    |   0.0 |  0.71
Other   |            | 0.01842    |            |       |  0.07

Nlocal:            199 ave         199 max         199 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           9952 ave        9952 max        9952 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 9952
Ave neighs/atom = 50.01005
Ave special neighs/atom = 1.9899497
Neighbor list builds = 113
Dangerous builds = 0

# This simulation is done
# Move onto the next one
clear
  using 2 OpenMP thread(s) per MPI task
package omp 0
using multi-threaded neighbor list subroutines
next f
jump SELF

###
# Reference paper:
# K. Kremer and G. S. Grest
# Dynamics of entangled linear polymer melts: A molecular-dynamics simulation
# J Chem Phys 92, 5057 (1990)

##################################
# MIHIR: for branched polymers
# LJ minimum first to expand and explore, then collapse
###

###
# Looping through the various tshaped polymers to simulate,
# define variables to switch through
variable f index bb66nuc1bl33bn3d30tot100 bb133nuc1bl66bn3d30tot200 bb200nuc1bl100bn3d30tot300 bb266nuc1bl133bn3d30tot400 bb333nuc1bl166bn3d30tot500 bb400nuc1bl200bn3d30tot600 bb466nuc1bl233bn3d30tot700 bb533nuc1bl266bn3d30tot800 bb600nuc1bl300bn3d30tot900 bb666nuc1bl333bn3d30tot1000 bb733nuc1bl366bn3d30tot1100 bb800nuc1bl400bn3d30tot1200
###


###
# Box and units  (use LJ units and periodic boundaries)
###

units lj
log tshaped/logs2/$f.log
log tshaped/logs2/bb200nuc1bl100bn3d30tot300.log

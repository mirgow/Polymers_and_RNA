#atom_style bond #no stiffness
atom_style angle #with stiffness

boundary        p p p
###
# Pair interactions require lists of neighbours to be calculated
###

#neighbor 0.3 bin
neighbor 4 bin

neigh_modify every 1 delay 1 check yes
atom_modify sort 0 0
### Generate RESTART file, SPECIAL format, not a .txt file ###
### Useful if simulation crashes ###

restart 1000000 nuc3branch4/restarts/$f.restart
restart 1000000 nuc3branch4/restarts/bb40nuc3bl10bn4d30tot100.restart
#############################



### READ "start" data file ###

read_data nuc3branch4/$f.dat
read_data nuc3branch4/bb40nuc3bl10bn4d30tot100.dat
Reading data file ...
  orthogonal box = (-1000 -1000 -1000) to (1000 1000 1000)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  101 atoms
  scanning bonds ...
  3 = max bonds/atom
  scanning angles ...
  6 = max angles/atom
  reading bonds ...
  100 bonds
  reading angles ...
  108 angles
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        0        0       
  special bond factors coul:  0        0        0       
     4 = max # of 1-2 neighbors
     4 = max # of 1-3 neighbors
     8 = max # of 1-4 neighbors
    12 = max # of special neighbors
  special bonds CPU = 0.001 seconds
  read_data CPU = 0.036 seconds

######################

### READ "REstart" data file ###

######################



###
# Define groups (atom type 1 is group 'all')
###
group all type 1
101 atoms in group all


###
# Dump configs - "simple dumpings"
###

###
# Dump configs + box coords
###

dump   1   all   custom   1000  nuc3branch4/trjs/$f.lammpstrj  id  x y z  ix iy iz
dump   1   all   custom   1000  nuc3branch4/trjs/bb40nuc3bl10bn4d30tot100.lammpstrj  id  x y z  ix iy iz
dump_modify   1   format line "%d %.5f %.5f %.5f %d %d %d"

########################################################################


###################################################################
# Stiffness term
#
# E = K * (1+cos(theta)), K>0
#
angle_style   cosine
#change this coefficient to change stiffness (e.g. 1,5,10)
angle_coeff   1 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  Lennard-Jones 12-6 potential with cutoff:
#  potential E=4epsilon[ (sigma/r)^12 - (sigma/r)^6]  for r<r_cut
#
#  1.12246 = 2^(1/6) is the minimum of the potential


pair_style      lj/cut 1.12246152962189
#pair_style      lj/cut 3

#
#  pair_modify shift yes adds a constant to the potential such

#  that E(r_cut)=0. Forces remains unchanged.
#

pair_modify     shift yes

#
#  pair_coeff for lj/cut, specify 4:
#    * atom type interacting with
#    * atom type
#    * epsilon (energy units)
#    * sigma (distance units)
#

pair_coeff      1 1 1.0 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  soft potential, for PUSHING apart overlapping atoms
#  potential E=A*(1 + cos(pi*r/r_c))
#
#  1.12246 = 2^(1/6) is the cut-off r_c

#pair_style     soft 1.12246152962189

#
#  pair_coeff for soft, specify 3:
#    * atom type interacting with
#    * atom type
#    * A
#
#

#pair_coeff      1 1 100.0
###################################################################

###################################################################
# Pair interaction between bonded atoms
#
# Fene potential + Lennard Jones 12-6:

#
#  E= - 0.5 K R0^2 ln[ 1- (r/R0)^2]
#     + 4epsilon[ (sigma/r)^12 - (sigma/r)^6] + epsilon
#

bond_style   fene


#
# For style fene, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#   * epsilon (energy)  (LJ component)
#   * sigma (distance)  (LJ component)
#


special_bonds fene #<=== I M P O R T A N T (new command)
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        1        1       
  special bond factors coul:  0        1        1       
     4 = max # of 1-2 neighbors
    12 = max # of special neighbors
  special bonds CPU = 0.001 seconds

bond_coeff   1   30   2   1.0   1.0


###################################################

###################################################################
# Pair interaction between bonded atoms
#
# Harmonic potential:
#
#  E= K * (R-R0)^2
#

#bond_style   harmonic

#
# For style harmonic, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#

#bond_coeff   1   60.0   1.0
#bond_coeff   2   harmonic 0.1   1.0

###################################################
compute 1 all gyration
variable rog equal c_1
#compute 2 all coord/atom cutoff 1.1

#dump 2 all custom 10000 contact_number.dump id c_2


###
# Set up fixes
###
thermo_style   custom   step  temp enthalpy c_1
fix 1 all nve   ###NVE ensemble

fix 2 all   langevin   1.0 1.0 1.0  100103   ###Langevin integrator Tstart Tstop 1/friction rndseed


##### Sample thermodynamic info  (temperature, energy, pressure, etc.) #####
thermo 1000









############################################################################

###
# set timestep of integrator

timestep 0.01

###
# run integration for a number of steps
###
#run 0
#variable r equal c_1
#if "$r < 63.1" then "quit 1"

# lj potential minimum, cause molecule to explore
run 100000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 1 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 5.1224615
  ghost atom cutoff = 5.1224615
  binsize = 2.5612308, bins = 781 781 781
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut, perpetual
      attributes: half, newton on
      pair build: half/bin/newton
      stencil: half/bin/3d
      bin: standard
WARNING: Communication cutoff 5.12246152962189 is shorter than a bond length based estimate of 5.455. This may lead to errors. (src/comm.cpp:723)
Per MPI rank memory allocation (min/avg/max) = 1861 | 1861 | 1861 Mbytes
   Step          Temp         Enthalpy         c_1      
         0   0              13.17225       9.834386     
      1000   0.93193307     22.863581      8.8515682    
      2000   0.90848924     20.128557      8.4188308    
      3000   1.1053701      21.86841       7.4090589    
      4000   1.1083338      19.43345       7.1490866    
      5000   0.91706022     19.678746      6.7320966    
      6000   0.99603988     20.739481      7.0723218    
      7000   1.0966746      20.472259      7.3699612    
      8000   1.0323072      20.082026      6.8880375    
      9000   1.0248879      19.522967      6.9107261    
     10000   1.0337084      21.184336      6.4730014    
     11000   1.0765214      20.516668      6.3124074    
     12000   1.1542225      20.753341      6.1088684    
     13000   1.0546585      21.388734      5.8876819    
     14000   1.1484901      20.409534      5.5521537    
     15000   1.0155611      19.98767       5.8208289    
     16000   0.91583148     20.88557       6.3385528    
     17000   1.1236453      20.486226      6.2650225    
     18000   0.98111678     21.28635       7.045918     
     19000   0.96715798     21.491624      6.2191971    
     20000   0.9023908      21.507168      6.4666553    
     21000   1.1228033      20.515158      6.3395795    
     22000   0.95381331     21.162525      6.0940635    
     23000   0.86385019     21.199038      5.8003284    
     24000   0.89889806     19.810579      5.2643897    
     25000   1.0205549      20.659265      5.776902     
     26000   1.0151049      19.753198      6.3540659    
     27000   1.1023173      19.255937      5.4799905    
     28000   0.90567759     20.315814      5.0225565    
     29000   0.99538819     19.793716      5.3442739    
     30000   1.0314714      20.968037      5.9696861    
     31000   1.012376       20.130844      6.067385     
     32000   1.0214306      22.032371      6.046142     
     33000   0.96420623     21.419757      5.6428278    
     34000   1.0700059      20.023614      6.4090192    
     35000   1.0317309      21.333665      6.3453271    
     36000   0.9428321      21.863145      6.3153132    
     37000   0.92561411     20.169306      6.1489466    
     38000   0.97297075     20.904722      6.4541294    
     39000   0.88661787     21.468869      6.542573     
     40000   1.0000047      20.304785      6.1844748    
     41000   1.2005122      19.714173      6.4840853    
     42000   0.82047279     19.293798      6.1910536    
     43000   1.0183987      19.787494      6.0695466    
     44000   0.85605633     20.83231       5.8761547    
     45000   1.1518783      19.838791      5.704915     
     46000   1.0123974      19.824533      5.1858422    
     47000   1.0040132      21.142535      5.3764866    
     48000   0.94162148     19.838198      4.8478791    
     49000   1.0928633      22.859854      4.4353905    
     50000   1.0292675      20.014352      4.2307268    
     51000   1.0718232      20.932373      4.2527739    
     52000   1.1077507      19.253247      4.6218572    
     53000   1.0964485      20.674158      4.5826739    
     54000   0.99635426     20.227593      4.7862438    
     55000   0.98208633     20.547197      4.4147253    
     56000   1.1432537      20.952094      4.2882156    
     57000   1.0171046      19.653505      4.5465064    
     58000   1.0706052      19.975034      4.3917192    
     59000   0.90870296     20.632633      5.1173845    
     60000   1.1221393      21.039312      5.2833693    
     61000   1.0113169      20.65948       5.648589     
     62000   0.82459411     19.57931       6.5701683    
     63000   1.0990243      18.434516      6.3794851    
     64000   0.93815174     20.956437      6.0337868    
     65000   0.95507953     20.406073      6.2970344    
     66000   1.0823389      20.009416      6.4236152    
     67000   1.0167684      21.838854      6.3211934    
     68000   0.95393888     20.105036      5.6049475    
     69000   0.91202486     21.104612      6.0086634    
     70000   0.99642303     21.973119      6.0287654    
     71000   1.12391        21.184318      5.9879476    
     72000   1.1727451      20.839212      6.3620945    
     73000   1.0124033      19.767223      5.6365418    
     74000   0.92294073     20.258013      5.712963     
     75000   0.90600028     20.711811      6.1033447    
     76000   0.92172526     20.826482      5.7711392    
     77000   0.98290864     20.285394      5.5220281    
     78000   1.2066305      22.001677      5.8546188    
     79000   1.0786588      20.347375      5.6028854    
     80000   1.0531591      21.317982      5.845069     
     81000   0.99665802     21.033087      6.4635884    
     82000   0.95482088     19.836871      6.4921356    
     83000   0.85352423     20.472047      6.4779248    
     84000   0.99536469     20.623763      6.998939     
     85000   1.1072126      21.672165      6.7125953    
     86000   1.0710194      22.690943      6.5566955    
     87000   1.0189791      20.528671      6.3957168    
     88000   1.0891584      19.696826      6.4028512    
     89000   1.0488206      20.720311      6.1200359    
     90000   0.95662592     20.440885      5.9965244    
     91000   1.059534       20.73668       5.683687     
     92000   1.1466102      20.576528      5.7561417    
     93000   1.0671113      20.279429      5.8292395    
     94000   1.1294547      21.064717      5.5805083    
     95000   0.93935212     20.835813      5.7073444    
     96000   1.1269248      21.25985       5.6527243    
     97000   0.92014414     21.18782       5.0474178    
     98000   0.95980577     19.727227      5.1202072    
     99000   0.90952418     18.710796      5.7306843    
    100000   1.0885908      20.904189      5.4763409    
Loop time of 321.063 on 1 procs for 100000 steps with 101 atoms

Performance: 269106.221 tau/day, 311.466 timesteps/s
100.0% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.48169    | 0.48169    | 0.48169    |   0.0 |  0.15
Bond    | 0.52987    | 0.52987    | 0.52987    |   0.0 |  0.17
Neigh   | 319.27     | 319.27     | 319.27     |   0.0 | 99.44
Comm    | 0.01735    | 0.01735    | 0.01735    |   0.0 |  0.01
Output  | 0.12755    | 0.12755    | 0.12755    |   0.0 |  0.04
Modify  | 0.564      | 0.564      | 0.564      |   0.0 |  0.18
Other   |            | 0.07258    |            |       |  0.02

Nlocal:            101 ave         101 max         101 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           1463 ave        1463 max        1463 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 1463
Ave neighs/atom = 14.485149
Ave special neighs/atom = 1.980198
Neighbor list builds = 940
Dangerous builds = 0

# Replace lj potential, now collapse
pair_style      lj/cut 3

# Cutoff simul when gyration under 10
# Variable created with equal requires v_ + 'name'
fix 3 all halt 1000 v_rog < 7

run 3000000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Per MPI rank memory allocation (min/avg/max) = 1861 | 1861 | 1861 Mbytes
   Step          Temp         Enthalpy         c_1      
    100000   1.0885908      19.532134      5.4763409    
Fix halt condition for fix-id 3 met on step 101000 with value 3.9608547069122744 (src/fix_halt.cpp:237)
    101000   1.2413763      20.775097      3.9608547    
Loop time of 0.837258 on 1 procs for 1000 steps with 101 atoms

Performance: 1031940.345 tau/day, 1194.375 timesteps/s
99.9% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.015858   | 0.015858   | 0.015858   |   0.0 |  1.89
Bond    | 0.0043002  | 0.0043002  | 0.0043002  |   0.0 |  0.51
Neigh   | 0.81054    | 0.81054    | 0.81054    |   0.0 | 96.81
Comm    | 0.0001417  | 0.0001417  | 0.0001417  |   0.0 |  0.02
Output  | 0.0008796  | 0.0008796  | 0.0008796  |   0.0 |  0.11
Modify  | 0.0049765  | 0.0049765  | 0.0049765  |   0.0 |  0.59
Other   |            | 0.0005597  |            |       |  0.07

Nlocal:            101 ave         101 max         101 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           3732 ave        3732 max        3732 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 3732
Ave neighs/atom = 36.950495
Ave special neighs/atom = 1.980198
Neighbor list builds = 9
Dangerous builds = 0

# This simulation is done
# Move onto the next one
clear
OMP_NUM_THREADS environment is not set. Defaulting to 1 thread. (src/comm.cpp:98)
  using 1 OpenMP thread(s) per MPI task
next f
jump SELF

###
# Reference paper:
# K. Kremer and G. S. Grest
# Dynamics of entangled linear polymer melts: A molecular-dynamics simulation
# J Chem Phys 92, 5057 (1990)

##################################
# MIHIR: for branched polymers
# LJ minimum first to expand and explore, then collapse
###

###
# Looping through the various nuc3branch4 polymers to simulate,
# define variables to switch through
variable f index bb40nuc3bl10bn4d30tot100 bb80nuc3bl20bn4d30tot200 bb120nuc3bl30bn4d30tot300 bb160nuc3bl40bn4d30tot400 bb200nuc3bl50bn4d30tot500 bb240nuc3bl60bn4d30tot600 bb280nuc3bl70bn4d30tot700 bb320nuc3bl80bn4d30tot800 bb360nuc3bl90bn4d30tot900 bb400nuc3bl100bn4d30tot1000 bb440nuc3bl110bn4d30tot1100 bb480nuc3bl120bn4d30tot1200
###


###
# Box and units  (use LJ units and periodic boundaries)
###

units lj
log nuc3branch4/logs/$f.log
log nuc3branch4/logs/bb80nuc3bl20bn4d30tot200.log

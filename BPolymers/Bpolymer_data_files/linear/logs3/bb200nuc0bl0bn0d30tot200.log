#atom_style bond #no stiffness
atom_style angle #with stiffness

boundary        p p p
###
# Pair interactions require lists of neighbours to be calculated
###

#neighbor 0.3 bin
neighbor 4 bin

neigh_modify every 1 delay 1 check yes
atom_modify sort 0 0
### Generate RESTART file, SPECIAL format, not a .txt file ###
### Useful if simulation crashes ###

restart 1000000 linear/restarts3/$f.restart
restart 1000000 linear/restarts3/bb200nuc0bl0bn0d30tot200.restart
#############################



### READ "start" data file ###

read_data linear/$f.dat
read_data linear/bb200nuc0bl0bn0d30tot200.dat
Reading data file ...
  orthogonal box = (-1000 -1000 -1000) to (1000 1000 1000)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  200 atoms
  scanning bonds ...
  1 = max bonds/atom
  scanning angles ...
  1 = max angles/atom
  reading bonds ...
  199 bonds
  reading angles ...
  198 angles
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        0        0       
  special bond factors coul:  0        0        0       
     2 = max # of 1-2 neighbors
     2 = max # of 1-3 neighbors
     4 = max # of 1-4 neighbors
     6 = max # of special neighbors
  special bonds CPU = 0.001 seconds
  read_data CPU = 0.044 seconds

######################

### READ "REstart" data file ###

######################



###
# Define groups (atom type 1 is group 'all')
###
group all type 1
200 atoms in group all


###
# Dump configs - "simple dumpings"
###

###
# Dump configs + box coords
###

dump   1   all   custom   1000  linear/trjs3/$f.lammpstrj  id  x y z  ix iy iz
dump   1   all   custom   1000  linear/trjs3/bb200nuc0bl0bn0d30tot200.lammpstrj  id  x y z  ix iy iz
dump_modify   1   format line "%d %.5f %.5f %.5f %d %d %d"

########################################################################


###################################################################
# Stiffness term
#
# E = K * (1+cos(theta)), K>0
#
angle_style   cosine
#change this coefficient to change stiffness (e.g. 1,5,10)
angle_coeff   1 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  Lennard-Jones 12-6 potential with cutoff:
#  potential E=4epsilon[ (sigma/r)^12 - (sigma/r)^6]  for r<r_cut
#
#  1.12246 = 2^(1/6) is the minimum of the potential


pair_style      lj/cut 1.12246152962189
#pair_style      lj/cut 3

#
#  pair_modify shift yes adds a constant to the potential such

#  that E(r_cut)=0. Forces remains unchanged.
#

pair_modify     shift yes

#
#  pair_coeff for lj/cut, specify 4:
#    * atom type interacting with
#    * atom type
#    * epsilon (energy units)
#    * sigma (distance units)
#

pair_coeff      1 1 1.0 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  soft potential, for PUSHING apart overlapping atoms
#  potential E=A*(1 + cos(pi*r/r_c))
#
#  1.12246 = 2^(1/6) is the cut-off r_c

#pair_style     soft 1.12246152962189

#
#  pair_coeff for soft, specify 3:
#    * atom type interacting with
#    * atom type
#    * A
#
#

#pair_coeff      1 1 100.0
###################################################################

###################################################################
# Pair interaction between bonded atoms
#
# Fene potential + Lennard Jones 12-6:

#
#  E= - 0.5 K R0^2 ln[ 1- (r/R0)^2]
#     + 4epsilon[ (sigma/r)^12 - (sigma/r)^6] + epsilon
#

bond_style   fene


#
# For style fene, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#   * epsilon (energy)  (LJ component)
#   * sigma (distance)  (LJ component)
#


special_bonds fene #<=== I M P O R T A N T (new command)
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        1        1       
  special bond factors coul:  0        1        1       
     2 = max # of 1-2 neighbors
     6 = max # of special neighbors
  special bonds CPU = 0.000 seconds

bond_coeff   1   30   2   1.0   1.0


###################################################

###################################################################
# Pair interaction between bonded atoms
#
# Harmonic potential:
#
#  E= K * (R-R0)^2
#

#bond_style   harmonic

#
# For style harmonic, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#

#bond_coeff   1   60.0   1.0
#bond_coeff   2   harmonic 0.1   1.0

###################################################
compute 1 all gyration
variable rog equal c_1
#compute 2 all coord/atom cutoff 1.1

#dump 2 all custom 10000 contact_number.dump id c_2


###
# Set up fixes
###
thermo_style   custom   step  temp enthalpy c_1
fix 1 all nve   ###NVE ensemble

fix 2 all   langevin   1.0 1.0 1.0  158102   ###Langevin integrator Tstart Tstop 1/friction rndseed


##### Sample thermodynamic info  (temperature, energy, pressure, etc.) #####
thermo 1000









############################################################################

###
# set timestep of integrator

timestep 0.01

###
# run integration for a number of steps
###
#run 0
#variable r equal c_1
#if "$r < 63.1" then "quit 1"

# lj potential minimum, cause molecule to explore
run 100000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Neighbor list info ...
  update: every = 1 steps, delay = 1 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 5.1224615
  ghost atom cutoff = 5.1224615
  binsize = 2.5612308, bins = 781 781 781
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut/omp, perpetual
      attributes: half, newton on, omp
      pair build: half/bin/newton/omp
      stencil: half/bin/3d
      bin: standard
WARNING: Communication cutoff 5.12246152962189 is shorter than a bond length based estimate of 5.455. This may lead to errors. (src/comm.cpp:723)
Per MPI rank memory allocation (min/avg/max) = 1860 | 1860 | 1860 Mbytes
   Step          Temp         Enthalpy         c_1      
         0   0              13.356123      50.001155    
      1000   0.93640574     18.872485      49.59081     
      2000   1.089923       18.939349      48.579906    
      3000   0.99695731     18.867452      47.701099    
      4000   1.0189643      19.671831      47.1274      
      5000   0.98838347     19.569158      47.001043    
      6000   1.0007214      18.991278      46.639221    
      7000   1.1051859      20.208132      46.401496    
      8000   1.0605152      19.967401      45.941218    
      9000   0.98889189     19.41274       45.324351    
     10000   0.96443354     20.613093      45.269344    
     11000   0.96805895     19.605553      45.356124    
     12000   1.1067673      20.701104      45.225277    
     13000   0.99184012     19.569156      44.500169    
     14000   1.0919572      20.947679      43.65119     
     15000   1.0026175      19.381235      43.204956    
     16000   1.0358149      20.34061       43.173704    
     17000   1.0232779      20.194834      42.612458    
     18000   0.96015375     19.19384       42.093581    
     19000   1.0213913      19.175562      41.37844     
     20000   0.9885783      20.334556      41.579243    
     21000   1.0670186      20.169819      40.915541    
     22000   0.97796924     19.888959      40.823664    
     23000   0.94860978     20.432079      40.430812    
     24000   1.0150543      20.529712      40.042279    
     25000   1.0134902      20.092731      39.430249    
     26000   0.98484737     19.567348      39.559485    
     27000   1.0106176      20.04074       39.493713    
     28000   0.94163448     20.448049      39.205165    
     29000   0.91886743     19.719436      39.004446    
     30000   1.0400451      20.178506      38.742679    
     31000   1.040578       19.893341      38.667646    
     32000   0.96771738     19.757399      38.2194      
     33000   1.0209181      20.137326      37.851431    
     34000   1.0482325      19.699269      37.918349    
     35000   1.0121488      20.225621      37.870066    
     36000   0.99838243     20.266334      37.423574    
     37000   0.9768364      20.354824      37.273721    
     38000   1.0145374      20.35556       37.011705    
     39000   1.0995761      20.377394      37.255625    
     40000   1.047302       20.125796      37.553098    
     41000   1.0053796      19.856923      37.346205    
     42000   1.0103262      19.800233      37.034278    
     43000   0.91053752     19.716469      36.695131    
     44000   1.0087132      19.336914      35.969263    
     45000   0.95157598     20.267242      35.520473    
     46000   0.86345388     19.902247      35.232808    
     47000   1.000081       18.967768      34.916986    
     48000   1.0419051      21.007337      34.231337    
     49000   0.97353984     20.048555      34.155877    
     50000   0.94295455     19.673267      34.333389    
     51000   0.96761686     19.780391      34.229731    
     52000   0.9400913      19.031953      33.98766     
     53000   1.0173323      20.948183      33.762869    
     54000   1.0522965      20.356615      33.336572    
     55000   0.93835623     20.033699      33.362169    
     56000   0.99037741     19.986334      33.002718    
     57000   1.0186204      20.765743      32.830295    
     58000   0.94763485     20.832857      32.850293    
     59000   0.96633827     18.696081      33.242067    
     60000   0.92632281     20.773429      33.272684    
     61000   1.0391463      20.392475      33.289766    
     62000   0.9697748      20.919252      33.878639    
     63000   0.90246227     20.00129       33.998795    
     64000   1.0154026      20.647559      33.856944    
     65000   0.96778218     20.35          33.43946     
     66000   1.0782927      20.109017      32.928804    
     67000   1.0919183      21.492227      32.343861    
     68000   0.97761353     19.706249      32.175735    
     69000   0.99820804     20.376525      31.686286    
     70000   1.0029363      19.495662      31.645027    
     71000   1.0436839      20.099125      32.073901    
     72000   0.98960569     19.521925      31.508087    
     73000   0.92253586     19.938887      31.003756    
     74000   0.95235884     19.376542      31.488007    
     75000   0.96257711     20.339698      31.337718    
     76000   0.90085675     19.55383       31.04267     
     77000   1.0681406      20.762163      30.688553    
     78000   0.99579031     20.896827      30.846813    
     79000   1.0423678      20.411663      30.265111    
     80000   0.86536151     19.902441      30.321548    
     81000   0.97671132     20.356309      29.959639    
     82000   1.0040177      20.530554      29.712506    
     83000   1.0007491      19.973743      29.555052    
     84000   1.0423672      20.638987      29.038183    
     85000   0.97375221     20.00882       28.650766    
     86000   1.0297607      20.354247      28.496575    
     87000   0.94200984     20.096378      28.831275    
     88000   0.99302898     19.594882      28.282589    
     89000   1.0062414      21.091432      28.045767    
     90000   0.92822421     19.393907      28.43065     
     91000   0.97909459     20.103469      29.186223    
     92000   1.0643875      19.870232      28.785395    
     93000   1.0679645      20.977685      28.505012    
     94000   1.1106291      19.996257      28.313903    
     95000   0.98817046     20.38652       28.135261    
     96000   1.0243077      20.140391      28.424023    
     97000   1.0432286      20.492448      28.227852    
     98000   0.9617822      19.662525      28.177529    
     99000   1.0236277      20.474534      27.616654    
    100000   0.96011782     18.972595      27.75818     
Loop time of 634.386 on 2 procs for 100000 steps with 200 atoms

Performance: 136194.717 tau/day, 157.633 timesteps/s
100.9% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.51611    | 0.51611    | 0.51611    |   0.0 |  0.08
Bond    | 1.0176     | 1.0176     | 1.0176     |   0.0 |  0.16
Neigh   | 630.63     | 630.63     | 630.63     |   0.0 | 99.41
Comm    | 0.034243   | 0.034243   | 0.034243   |   0.0 |  0.01
Output  | 0.20188    | 0.20188    | 0.20188    |   0.0 |  0.03
Modify  | 1.8168     | 1.8168     | 1.8168     |   0.0 |  0.29
Other   |            | 0.1738     |            |       |  0.03

Nlocal:            200 ave         200 max         200 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           1483 ave        1483 max        1483 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 1483
Ave neighs/atom = 7.415
Ave special neighs/atom = 1.99
Neighbor list builds = 965
Dangerous builds = 0

# Replace lj potential, now collapse
pair_style      lj/cut 3

# Cutoff simul when gyration under 5
# Variable created with equal requires v_ + 'name'
fix 3 all halt 1000 v_rog < 7

run 5000000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Per MPI rank memory allocation (min/avg/max) = 1860 | 1860 | 1860 Mbytes
   Step          Temp         Enthalpy         c_1      
    100000   0.96011782     18.22324       27.75818     
    101000   0.95109893     18.439119      26.729093    
    102000   1.0915856      19.877277      26.5499      
    103000   1.1175311      18.405945      26.229696    
    104000   0.99456726     20.364669      25.884811    
    105000   0.99478931     19.714649      26.102741    
    106000   0.94707403     19.422398      25.97122     
    107000   0.98171807     19.15798       25.240329    
    108000   0.97739569     19.766915      25.143063    
    109000   1.0486733      18.488591      24.948901    
    110000   1.0722946      20.085856      24.534058    
    111000   1.1020177      19.143597      23.875504    
    112000   1.005233       18.209609      23.443854    
    113000   1.0903488      18.978432      23.27285     
    114000   0.91724272     18.123085      23.090162    
    115000   1.0477812      19.574608      22.698353    
    116000   0.99133171     18.506812      22.175523    
    117000   0.9655338      21.094814      21.771665    
    118000   0.85041163     18.881775      21.364079    
    119000   1.0740891      19.179655      21.097751    
    120000   1.0353615      18.399895      20.790881    
    121000   1.0165034      18.033675      20.281618    
    122000   0.97434624     17.496187      20.254194    
    123000   1.0499406      17.502337      19.656953    
    124000   1.0768334      18.001236      19.393679    
    125000   0.84212224     16.838544      19.24209     
    126000   1.0408874      17.712141      18.488035    
    127000   0.82073605     17.290447      18.03498     
    128000   1.0741851      17.30136       18.687827    
    129000   0.92913756     19.118551      18.643244    
    130000   0.9549225      18.290035      18.386625    
    131000   0.93751623     18.329187      17.479688    
    132000   1.0030968      19.366583      16.999758    
    133000   0.92020943     17.992528      16.271757    
    134000   0.93268873     17.600956      15.444645    
    135000   0.90125679     16.34484       14.931278    
    136000   0.92816073     16.869723      14.227453    
    137000   0.97344688     18.597367      14.386169    
    138000   1.0435217      19.786125      13.833909    
    139000   0.9743638      18.828447      13.147098    
    140000   1.0269927      18.011951      12.726798    
    141000   1.0017201      17.227299      12.414797    
    142000   1.00825        17.670483      11.574163    
    143000   1.092628       18.152959      11.959777    
    144000   1.0374423      17.306674      11.496605    
    145000   1.0594674      19.290894      11.941773    
    146000   0.9815639      17.697662      11.852598    
    147000   1.0856381      17.592187      11.832513    
    148000   0.92078002     18.192127      11.778463    
    149000   0.99634437     18.187156      11.831538    
    150000   1.0088884      17.920483      11.664941    
    151000   1.0223248      18.960672      11.509086    
    152000   0.93041848     17.518422      11.048293    
    153000   0.95480764     18.212399      10.670466    
    154000   1.0560653      18.39012       10.259006    
    155000   0.98808662     18.156811      10.239317    
    156000   0.98258241     18.508113      9.6703548    
    157000   0.99394853     17.837454      9.6772347    
    158000   0.96921293     17.97965       9.7615083    
    159000   1.003007       18.022429      9.5911666    
    160000   1.0540194      18.178051      9.5978328    
    161000   0.9632393      18.027403      9.211704     
    162000   1.0459743      17.781688      9.0513011    
    163000   1.0636658      19.749818      9.0197619    
    164000   1.0407573      18.199446      8.8417877    
    165000   1.0395514      17.387611      8.3738529    
    166000   1.0024935      18.231926      8.0767916    
    167000   1.0595366      17.566212      8.1564886    
    168000   1.0549879      18.250232      8.2641239    
    169000   1.0585233      18.596907      7.7100388    
    170000   1.017933       17.949452      7.2715416    
Fix halt condition for fix-id 3 met on step 171000 with value 6.673292105325207 (src/fix_halt.cpp:237)
    171000   0.93269481     18.000094      6.6732921    
Loop time of 148.226 on 2 procs for 71000 steps with 200 atoms

Performance: 413855.672 tau/day, 479.000 timesteps/s
104.4% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 3.0596     | 3.0596     | 3.0596     |   0.0 |  2.06
Bond    | 0.78484    | 0.78484    | 0.78484    |   0.0 |  0.53
Neigh   | 142.69     | 142.69     | 142.69     |   0.0 | 96.27
Comm    | 0.026045   | 0.026045   | 0.026045   |   0.0 |  0.02
Output  | 0.1516     | 0.1516     | 0.1516     |   0.0 |  0.10
Modify  | 1.3749     | 1.3749     | 1.3749     |   0.0 |  0.93
Other   |            | 0.1349     |            |       |  0.09

Nlocal:            200 ave         200 max         200 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           9805 ave        9805 max        9805 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 9805
Ave neighs/atom = 49.025
Ave special neighs/atom = 1.99
Neighbor list builds = 558
Dangerous builds = 0

# This simulation is done
# Move onto the next one
clear
  using 2 OpenMP thread(s) per MPI task
package omp 0
using multi-threaded neighbor list subroutines
next f
jump SELF

###
# Reference paper:
# K. Kremer and G. S. Grest
# Dynamics of entangled linear polymer melts: A molecular-dynamics simulation
# J Chem Phys 92, 5057 (1990)

##################################
# MIHIR: for branched polymers
# LJ minimum first to expand and explore, then collapse
###

###
# Looping through the various linear polymers to simulate,
# define variables to switch through
variable f index bb100nuc0bl0bn0d30tot100 bb200nuc0bl0bn0d30tot200 bb300nuc0bl0bn0d30tot300 bb400nuc0bl0bn0d30tot400 bb500nuc0bl0bn0d30tot500 bb600nuc0bl0bn0d30tot600 bb700nuc0bl0bn0d30tot700 bb800nuc0bl0bn0d30tot800 bb900nuc0bl0bn0d30tot900 bb1000nuc0bl0bn0d30tot1000 bb1100nuc0bl0bn0d30tot1100 bb1200nuc0bl0bn0d30tot1200
###


###
# Box and units  (use LJ units and periodic boundaries)
###

units lj
log linear/logs3/$f.log
log linear/logs3/bb300nuc0bl0bn0d30tot300.log

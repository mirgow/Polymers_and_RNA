#atom_style bond #no stiffness
atom_style angle #with stiffness

boundary        p p p
###
# Pair interactions require lists of neighbours to be calculated
###

#neighbor 0.3 bin
neighbor 4 bin

neigh_modify every 1 delay 1 check yes
atom_modify sort 0 0
### Generate RESTART file, SPECIAL format, not a .txt file ###
### Useful if simulation crashes ###

restart 1000000 tshaped/restarts2/$f.restart
restart 1000000 tshaped/restarts2/bb66nuc1bl33bn3d30tot100.restart
#############################



### READ "start" data file ###

read_data tshaped/$f.dat
read_data tshaped/bb66nuc1bl33bn3d30tot100.dat
Reading data file ...
  orthogonal box = (-1000 -1000 -1000) to (1000 1000 1000)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  100 atoms
  scanning bonds ...
  2 = max bonds/atom
  scanning angles ...
  3 = max angles/atom
  reading bonds ...
  99 bonds
  reading angles ...
  99 angles
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        0        0       
  special bond factors coul:  0        0        0       
     3 = max # of 1-2 neighbors
     3 = max # of 1-3 neighbors
     6 = max # of 1-4 neighbors
     9 = max # of special neighbors
  special bonds CPU = 0.001 seconds
  read_data CPU = 0.023 seconds

######################

### READ "REstart" data file ###

######################



###
# Define groups (atom type 1 is group 'all')
###
group all type 1
100 atoms in group all


###
# Dump configs - "simple dumpings"
###

###
# Dump configs + box coords
###

dump   1   all   custom   1000  tshaped/trjs2/$f.lammpstrj  id  x y z  ix iy iz
dump   1   all   custom   1000  tshaped/trjs2/bb66nuc1bl33bn3d30tot100.lammpstrj  id  x y z  ix iy iz
dump_modify   1   format line "%d %.5f %.5f %.5f %d %d %d"

########################################################################


###################################################################
# Stiffness term
#
# E = K * (1+cos(theta)), K>0
#
angle_style   cosine
#change this coefficient to change stiffness (e.g. 1,5,10)
angle_coeff   1 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  Lennard-Jones 12-6 potential with cutoff:
#  potential E=4epsilon[ (sigma/r)^12 - (sigma/r)^6]  for r<r_cut
#
#  1.12246 = 2^(1/6) is the minimum of the potential


pair_style      lj/cut 1.12246152962189
#pair_style      lj/cut 3

#
#  pair_modify shift yes adds a constant to the potential such

#  that E(r_cut)=0. Forces remains unchanged.
#

pair_modify     shift yes

#
#  pair_coeff for lj/cut, specify 4:
#    * atom type interacting with
#    * atom type
#    * epsilon (energy units)
#    * sigma (distance units)
#

pair_coeff      1 1 1.0 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  soft potential, for PUSHING apart overlapping atoms
#  potential E=A*(1 + cos(pi*r/r_c))
#
#  1.12246 = 2^(1/6) is the cut-off r_c

#pair_style     soft 1.12246152962189

#
#  pair_coeff for soft, specify 3:
#    * atom type interacting with
#    * atom type
#    * A
#
#

#pair_coeff      1 1 100.0
###################################################################

###################################################################
# Pair interaction between bonded atoms
#
# Fene potential + Lennard Jones 12-6:

#
#  E= - 0.5 K R0^2 ln[ 1- (r/R0)^2]
#     + 4epsilon[ (sigma/r)^12 - (sigma/r)^6] + epsilon
#

bond_style   fene


#
# For style fene, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#   * epsilon (energy)  (LJ component)
#   * sigma (distance)  (LJ component)
#


special_bonds fene #<=== I M P O R T A N T (new command)
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        1        1       
  special bond factors coul:  0        1        1       
     3 = max # of 1-2 neighbors
     9 = max # of special neighbors
  special bonds CPU = 0.000 seconds

bond_coeff   1   30   2   1.0   1.0


###################################################

###################################################################
# Pair interaction between bonded atoms
#
# Harmonic potential:
#
#  E= K * (R-R0)^2
#

#bond_style   harmonic

#
# For style harmonic, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#

#bond_coeff   1   60.0   1.0
#bond_coeff   2   harmonic 0.1   1.0

###################################################
compute 1 all gyration
variable rog equal c_1
#compute 2 all coord/atom cutoff 1.1

#dump 2 all custom 10000 contact_number.dump id c_2


###
# Set up fixes
###
thermo_style   custom   step  temp enthalpy c_1
fix 1 all nve   ###NVE ensemble

fix 2 all   langevin   1.0 1.0 1.0  778655   ###Langevin integrator Tstart Tstop 1/friction rndseed


##### Sample thermodynamic info  (temperature, energy, pressure, etc.) #####
thermo 1000









############################################################################

###
# set timestep of integrator

timestep 0.01

###
# run integration for a number of steps
###
#run 0
#variable r equal c_1
#if "$r < 63.1" then "quit 1"

# lj potential minimum, cause molecule to explore
run 100000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Neighbor list info ...
  update: every = 1 steps, delay = 1 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 5.1224615
  ghost atom cutoff = 5.1224615
  binsize = 2.5612308, bins = 781 781 781
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut/omp, perpetual
      attributes: half, newton on, omp
      pair build: half/bin/newton/omp
      stencil: half/bin/3d
      bin: standard
WARNING: Communication cutoff 5.12246152962189 is shorter than a bond length based estimate of 5.455. This may lead to errors. (src/comm.cpp:723)
Per MPI rank memory allocation (min/avg/max) = 1860 | 1860 | 1860 Mbytes
   Step          Temp         Enthalpy         c_1      
         0   0              13.048218      17.99924     
      1000   1.000397       21.306495      15.568064    
      2000   1.0585232      20.360935      14.123989    
      3000   1.1512924      19.301787      13.659514    
      4000   0.89930093     19.04475       13.243861    
      5000   0.99061519     20.281245      12.591159    
      6000   0.94698814     19.443409      11.844691    
      7000   0.99259769     20.798447      11.070711    
      8000   1.0435053      19.244066      10.400407    
      9000   1.0253027      20.219255      9.7002591    
     10000   1.1516531      19.952334      9.2106011    
     11000   0.93925159     19.364497      8.4781892    
     12000   1.0569601      20.645666      8.1754801    
     13000   0.82101692     20.100892      7.4798555    
     14000   1.0225311      22.041247      7.682532     
     15000   0.88034787     20.531189      7.6837718    
     16000   1.0141111      20.567918      7.3964765    
     17000   1.0557178      21.142839      7.6800685    
     18000   0.97985795     19.480118      7.291039     
     19000   1.1971455      22.212524      6.9958525    
     20000   0.92360611     20.185327      7.2200896    
     21000   1.162397       19.221738      7.6041316    
     22000   0.864222       20.237853      7.2455533    
     23000   0.99783543     20.433068      7.1611985    
     24000   0.96003445     20.300155      7.9883938    
     25000   1.1680204      21.015944      8.0639581    
     26000   1.0291905      21.788929      7.4486419    
     27000   0.97221561     19.539055      7.7421346    
     28000   1.0206468      20.44867       7.7155955    
     29000   1.1678619      22.852438      6.921356     
     30000   0.93669147     19.696093      6.5237205    
     31000   1.2255715      22.177502      6.4883781    
     32000   1.0005051      21.381848      7.1124219    
     33000   0.94074933     19.094244      6.9774033    
     34000   0.94296493     19.925173      6.3512224    
     35000   1.0597907      20.324638      6.2577075    
     36000   1.1250359      20.579837      6.7160547    
     37000   1.0494258      20.166148      6.5987421    
     38000   0.8466143      20.384765      6.8028399    
     39000   1.0451346      19.877263      7.0673568    
     40000   0.95908857     21.123702      6.7282332    
     41000   1.0819154      20.784202      6.2851839    
     42000   0.84984226     18.62108       6.3908792    
     43000   1.1438821      20.287948      6.5564936    
     44000   1.1381574      19.962304      6.9094394    
     45000   1.0117843      19.255076      6.9560881    
     46000   0.94984736     19.476921      7.5133888    
     47000   0.94625883     19.522324      6.9427508    
     48000   0.95364691     18.665334      6.9157289    
     49000   0.92703787     20.35543       6.4363351    
     50000   1.0916206      22.240152      6.1157098    
     51000   1.0825543      21.15001       6.2836522    
     52000   0.9195152      19.516248      6.2724719    
     53000   1.08207        19.883448      6.1159526    
     54000   0.9333374      20.63713       6.7277477    
     55000   0.89648535     20.492888      6.5823031    
     56000   1.0198652      20.258324      6.2593234    
     57000   1.2507648      20.680127      6.1059039    
     58000   1.2176724      21.329532      7.0937475    
     59000   1.0550231      19.320324      6.5326868    
     60000   0.95976523     20.46861       6.5005207    
     61000   1.0291895      19.322671      6.5239951    
     62000   1.1165973      20.781598      5.9656883    
     63000   1.0206451      21.716585      6.2970959    
     64000   0.83972627     19.962605      6.1786354    
     65000   1.0211415      20.009237      5.7173621    
     66000   0.97465708     21.35035       5.6904502    
     67000   1.1083584      20.626787      6.3102808    
     68000   1.0532661      21.957037      6.5117181    
     69000   1.0826162      20.306311      6.4303819    
     70000   0.93186567     20.308451      6.0427904    
     71000   0.92241859     21.302387      6.1070174    
     72000   0.93041559     21.823719      6.1131314    
     73000   0.95404786     20.212599      6.072778     
     74000   0.95170334     20.955687      6.0161167    
     75000   1.1089068      20.600941      6.2633548    
     76000   0.93814546     19.680009      6.2628225    
     77000   1.0228969      20.040227      6.6804292    
     78000   1.1208502      20.925326      6.9548434    
     79000   0.89561685     20.030319      7.3783654    
     80000   1.0226083      21.644494      7.2487359    
     81000   0.93795201     19.389552      7.1190573    
     82000   1.0244838      19.319635      6.1269414    
     83000   0.98623076     20.893408      6.0546496    
     84000   1.0877062      19.108096      5.8235818    
     85000   1.0615184      21.525602      5.5496496    
     86000   1.0245837      20.451821      6.1504878    
     87000   1.1096207      20.181824      6.4518583    
     88000   1.0695189      19.178592      6.725719     
     89000   0.84113118     19.132665      6.7789342    
     90000   0.97468915     20.221322      6.4596863    
     91000   1.0119984      20.258289      6.1578122    
     92000   1.1575505      19.289632      6.0184106    
     93000   1.0047682      20.334914      6.1625357    
     94000   0.89820902     20.730241      6.0475954    
     95000   0.96690976     20.424705      5.8049621    
     96000   0.86660255     20.028577      6.1055382    
     97000   1.1188428      19.755515      5.8123065    
     98000   1.0218673      20.961834      5.7792577    
     99000   0.92031866     22.627169      5.6542734    
    100000   1.0444191      21.417811      5.2749422    
Loop time of 624.487 on 2 procs for 100000 steps with 100 atoms

Performance: 138353.507 tau/day, 160.131 timesteps/s
100.5% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.37298    | 0.37298    | 0.37298    |   0.0 |  0.06
Bond    | 0.51562    | 0.51562    | 0.51562    |   0.0 |  0.08
Neigh   | 622.47     | 622.47     | 622.47     |   0.0 | 99.68
Comm    | 0.024178   | 0.024178   | 0.024178   |   0.0 |  0.00
Output  | 0.16503    | 0.16503    | 0.16503    |   0.0 |  0.03
Modify  | 0.85568    | 0.85568    | 0.85568    |   0.0 |  0.14
Other   |            | 0.086      |            |       |  0.01

Nlocal:            100 ave         100 max         100 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           1204 ave        1204 max        1204 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 1204
Ave neighs/atom = 12.04
Ave special neighs/atom = 1.98
Neighbor list builds = 902
Dangerous builds = 0

# Replace lj potential, now collapse
pair_style      lj/cut 3

# Cutoff simul when gyration under 5
# Variable created with equal requires v_ + 'name'
fix 3 all halt 1000 v_rog < 7

run 5000000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Per MPI rank memory allocation (min/avg/max) = 1860 | 1860 | 1860 Mbytes
   Step          Temp         Enthalpy         c_1      
    100000   1.0444191      20.050501      5.2749422    
Fix halt condition for fix-id 3 met on step 101000 with value 3.8620420344651323 (src/fix_halt.cpp:237)
    101000   0.92139454     18.665305      3.862042     
Loop time of 2.2705 on 2 procs for 1000 steps with 100 atoms

Performance: 380533.526 tau/day, 440.432 timesteps/s
102.1% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.015191   | 0.015191   | 0.015191   |   0.0 |  0.67
Bond    | 0.0065387  | 0.0065387  | 0.0065387  |   0.0 |  0.29
Neigh   | 2.2339     | 2.2339     | 2.2339     |   0.0 | 98.39
Comm    | 0.0002952  | 0.0002952  | 0.0002952  |   0.0 |  0.01
Output  | 0.0012628  | 0.0012628  | 0.0012628  |   0.0 |  0.06
Modify  | 0.012128   | 0.012128   | 0.012128   |   0.0 |  0.53
Other   |            | 0.001228   |            |       |  0.05

Nlocal:            100 ave         100 max         100 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           3816 ave        3816 max        3816 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 3816
Ave neighs/atom = 38.16
Ave special neighs/atom = 1.98
Neighbor list builds = 8
Dangerous builds = 0

# This simulation is done
# Move onto the next one
clear
  using 2 OpenMP thread(s) per MPI task
package omp 0
using multi-threaded neighbor list subroutines
next f
jump SELF

###
# Reference paper:
# K. Kremer and G. S. Grest
# Dynamics of entangled linear polymer melts: A molecular-dynamics simulation
# J Chem Phys 92, 5057 (1990)

##################################
# MIHIR: for branched polymers
# LJ minimum first to expand and explore, then collapse
###

###
# Looping through the various tshaped polymers to simulate,
# define variables to switch through
variable f index bb66nuc1bl33bn3d30tot100 bb133nuc1bl66bn3d30tot200 bb200nuc1bl100bn3d30tot300 bb266nuc1bl133bn3d30tot400 bb333nuc1bl166bn3d30tot500 bb400nuc1bl200bn3d30tot600 bb466nuc1bl233bn3d30tot700 bb533nuc1bl266bn3d30tot800 bb600nuc1bl300bn3d30tot900 bb666nuc1bl333bn3d30tot1000 bb733nuc1bl366bn3d30tot1100 bb800nuc1bl400bn3d30tot1200
###


###
# Box and units  (use LJ units and periodic boundaries)
###

units lj
log tshaped/logs2/$f.log
log tshaped/logs2/bb133nuc1bl66bn3d30tot200.log

#atom_style bond #no stiffness
atom_style angle #with stiffness

boundary        p p p
###
# Pair interactions require lists of neighbours to be calculated
###

#neighbor 0.3 bin
neighbor 4 bin

neigh_modify every 1 delay 1 check yes
atom_modify sort 0 0
### Generate RESTART file, SPECIAL format, not a .txt file ###
### Useful if simulation crashes ###

restart 1000000 plusshaped/restarts3/$f.restart
restart 1000000 plusshaped/restarts3/bb151nuc1bl75bn4d30tot300.restart
#############################



### READ "start" data file ###

read_data plusshaped/$f.dat
read_data plusshaped/bb151nuc1bl75bn4d30tot300.dat
Reading data file ...
  orthogonal box = (-1000 -1000 -1000) to (1000 1000 1000)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  301 atoms
  scanning bonds ...
  3 = max bonds/atom
  scanning angles ...
  6 = max angles/atom
  reading bonds ...
  300 bonds
  reading angles ...
  302 angles
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        0        0       
  special bond factors coul:  0        0        0       
     4 = max # of 1-2 neighbors
     4 = max # of 1-3 neighbors
     8 = max # of 1-4 neighbors
    12 = max # of special neighbors
  special bonds CPU = 0.001 seconds
  read_data CPU = 0.050 seconds

######################

### READ "REstart" data file ###

######################



###
# Define groups (atom type 1 is group 'all')
###
group all type 1
301 atoms in group all


###
# Dump configs - "simple dumpings"
###

###
# Dump configs + box coords
###

dump   1   all   custom   1000  plusshaped/trjs3/$f.lammpstrj  id  x y z  ix iy iz
dump   1   all   custom   1000  plusshaped/trjs3/bb151nuc1bl75bn4d30tot300.lammpstrj  id  x y z  ix iy iz
dump_modify   1   format line "%d %.5f %.5f %.5f %d %d %d"

########################################################################


###################################################################
# Stiffness term
#
# E = K * (1+cos(theta)), K>0
#
angle_style   cosine
#change this coefficient to change stiffness (e.g. 1,5,10)
angle_coeff   1 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  Lennard-Jones 12-6 potential with cutoff:
#  potential E=4epsilon[ (sigma/r)^12 - (sigma/r)^6]  for r<r_cut
#
#  1.12246 = 2^(1/6) is the minimum of the potential


pair_style      lj/cut 1.12246152962189
#pair_style      lj/cut 3

#
#  pair_modify shift yes adds a constant to the potential such

#  that E(r_cut)=0. Forces remains unchanged.
#

pair_modify     shift yes

#
#  pair_coeff for lj/cut, specify 4:
#    * atom type interacting with
#    * atom type
#    * epsilon (energy units)
#    * sigma (distance units)
#

pair_coeff      1 1 1.0 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  soft potential, for PUSHING apart overlapping atoms
#  potential E=A*(1 + cos(pi*r/r_c))
#
#  1.12246 = 2^(1/6) is the cut-off r_c

#pair_style     soft 1.12246152962189

#
#  pair_coeff for soft, specify 3:
#    * atom type interacting with
#    * atom type
#    * A
#
#

#pair_coeff      1 1 100.0
###################################################################

###################################################################
# Pair interaction between bonded atoms
#
# Fene potential + Lennard Jones 12-6:

#
#  E= - 0.5 K R0^2 ln[ 1- (r/R0)^2]
#     + 4epsilon[ (sigma/r)^12 - (sigma/r)^6] + epsilon
#

bond_style   fene


#
# For style fene, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#   * epsilon (energy)  (LJ component)
#   * sigma (distance)  (LJ component)
#


special_bonds fene #<=== I M P O R T A N T (new command)
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        1        1       
  special bond factors coul:  0        1        1       
     4 = max # of 1-2 neighbors
    12 = max # of special neighbors
  special bonds CPU = 0.000 seconds

bond_coeff   1   30   2   1.0   1.0


###################################################

###################################################################
# Pair interaction between bonded atoms
#
# Harmonic potential:
#
#  E= K * (R-R0)^2
#

#bond_style   harmonic

#
# For style harmonic, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#

#bond_coeff   1   60.0   1.0
#bond_coeff   2   harmonic 0.1   1.0

###################################################
compute 1 all gyration
variable rog equal c_1
#compute 2 all coord/atom cutoff 1.1

#dump 2 all custom 10000 contact_number.dump id c_2


###
# Set up fixes
###
thermo_style   custom   step  temp enthalpy c_1
fix 1 all nve   ###NVE ensemble

fix 2 all   langevin   1.0 1.0 1.0  158102   ###Langevin integrator Tstart Tstop 1/friction rndseed


##### Sample thermodynamic info  (temperature, energy, pressure, etc.) #####
thermo 1000









############################################################################

###
# set timestep of integrator

timestep 0.01

###
# run integration for a number of steps
###
#run 0
#variable r equal c_1
#if "$r < 63.1" then "quit 1"

# lj potential minimum, cause molecule to explore
run 100000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Neighbor list info ...
  update: every = 1 steps, delay = 1 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 5.1224615
  ghost atom cutoff = 5.1224615
  binsize = 2.5612308, bins = 781 781 781
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut/omp, perpetual
      attributes: half, newton on, omp
      pair build: half/bin/newton/omp
      stencil: half/bin/3d
      bin: standard
WARNING: Communication cutoff 5.12246152962189 is shorter than a bond length based estimate of 5.455. This may lead to errors. (src/comm.cpp:723)
Per MPI rank memory allocation (min/avg/max) = 1861 | 1861 | 1861 Mbytes
   Step          Temp         Enthalpy         c_1      
         0   0              13.218321      39.68912     
      1000   1.0068861      18.422429      37.904604    
      2000   1.053095       18.988574      36.999235    
      3000   1.0334918      19.480815      35.838746    
      4000   1.01945        19.060404      35.116004    
      5000   0.99659576     19.012176      34.456566    
      6000   0.99582334     19.613068      34.075554    
      7000   0.97549678     19.703794      33.625145    
      8000   1.0901162      19.970005      32.811423    
      9000   0.97231001     18.987476      32.223156    
     10000   0.94387375     19.328485      31.549365    
     11000   1.0107701      20.564901      31.233635    
     12000   0.98919423     19.500568      30.82918     
     13000   1.0508234      20.375795      30.526669    
     14000   1.126876       20.567136      30.036771    
     15000   0.97880523     19.688258      29.818837    
     16000   1.0005695      20.509087      29.505499    
     17000   0.96105102     19.591007      29.526721    
     18000   1.0451856      19.973583      29.303004    
     19000   0.97604909     20.599186      28.855161    
     20000   1.0027128      19.239827      28.540717    
     21000   1.0198792      20.611441      28.188716    
     22000   1.1063152      21.226347      27.969446    
     23000   0.97301208     19.717953      27.753411    
     24000   1.0714171      19.756627      27.525675    
     25000   0.97605912     20.484025      27.197746    
     26000   0.99290208     21.183657      26.966621    
     27000   1.0331493      21.354237      26.470203    
     28000   1.0665476      20.361682      25.98579     
     29000   0.9890526      19.963252      26.189105    
     30000   1.0265801      20.750747      25.7244      
     31000   1.0555006      19.431672      25.446837    
     32000   0.95760459     20.87722       25.321401    
     33000   0.94597411     19.562403      25.100748    
     34000   1.0680959      21.200053      25.130308    
     35000   1.0958057      20.234283      25.556802    
     36000   1.018935       21.019423      25.109239    
     37000   1.0814377      19.927235      24.775702    
     38000   1.0346404      21.128797      24.823141    
     39000   0.90602847     20.028481      24.460577    
     40000   0.95795929     19.971378      24.191328    
     41000   1.0249918      21.12347       23.71901     
     42000   0.94416346     20.209432      23.704824    
     43000   0.9874217      20.852063      23.267104    
     44000   0.99253313     20.347602      23.11061     
     45000   0.9809081      19.954839      23.205313    
     46000   0.98313915     19.829805      23.076743    
     47000   0.95318131     20.536446      22.747828    
     48000   1.0719376      20.978688      22.527636    
     49000   1.1230866      20.453153      22.510423    
     50000   0.98158253     21.235852      22.661862    
     51000   1.0071695      20.329125      22.750131    
     52000   0.99033824     20.734923      22.83231     
     53000   0.9721943      19.998823      22.81116     
     54000   0.95551365     20.784952      22.597782    
     55000   1.0476656      20.819548      22.362409    
     56000   1.057398       20.633778      22.122863    
     57000   1.0364079      21.257759      21.691986    
     58000   1.0357631      20.12149       21.466667    
     59000   1.0289092      20.829744      21.330218    
     60000   0.95461913     19.766841      20.66982     
     61000   0.99216673     20.768997      20.628077    
     62000   1.0602291      20.017035      20.635496    
     63000   1.0388691      20.643619      20.642154    
     64000   1.0246084      20.347211      20.87393     
     65000   1.0698143      21.450105      20.828995    
     66000   1.0362105      20.568396      20.38215     
     67000   1.027523       20.68523       20.128371    
     68000   0.91010288     20.687568      20.329389    
     69000   0.98835983     20.718742      20.332954    
     70000   1.0551618      21.227008      20.160746    
     71000   1.0483701      20.601253      20.249963    
     72000   0.95968322     20.310897      19.927923    
     73000   0.94723356     20.527615      19.698768    
     74000   0.91651774     20.053066      19.612574    
     75000   0.97340296     19.78534       19.682689    
     76000   0.94914591     20.748947      19.399622    
     77000   1.1177653      20.403512      19.356814    
     78000   1.0101334      19.250871      19.386695    
     79000   0.9332691      20.706903      19.69231     
     80000   1.0421737      20.455399      19.557028    
     81000   0.89675699     20.237869      19.230016    
     82000   0.92670257     20.756827      18.54731     
     83000   1.0212892      19.754165      18.73267     
     84000   0.99433641     19.815163      18.806686    
     85000   0.92628547     20.057061      19.101807    
     86000   1.1318892      20.891689      18.702387    
     87000   1.0393998      21.12896       18.690793    
     88000   1.0378141      20.155893      18.047879    
     89000   0.95637604     20.751471      17.756791    
     90000   1.0432721      20.294839      17.667501    
     91000   0.94943889     20.42877       17.781535    
     92000   1.0955768      21.681643      17.510101    
     93000   0.87135066     21.508895      17.806639    
     94000   1.020879       19.953695      17.905254    
     95000   0.94981407     20.337211      17.514229    
     96000   1.0118064      19.998709      17.154901    
     97000   0.95467542     20.241526      17.438083    
     98000   0.93343082     20.477699      17.50955     
     99000   1.0134697      20.189269      17.783906    
    100000   0.99499952     20.649779      17.54414     
Loop time of 422.92 on 2 procs for 100000 steps with 301 atoms

Performance: 204293.953 tau/day, 236.451 timesteps/s
101.0% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.44217    | 0.44217    | 0.44217    |   0.0 |  0.10
Bond    | 0.73011    | 0.73011    | 0.73011    |   0.0 |  0.17
Neigh   | 420        | 420        | 420        |   0.0 | 99.31
Comm    | 0.021718   | 0.021718   | 0.021718   |   0.0 |  0.01
Output  | 0.14204    | 0.14204    | 0.14204    |   0.0 |  0.03
Modify  | 1.4622     | 1.4622     | 1.4622     |   0.0 |  0.35
Other   |            | 0.1227     |            |       |  0.03

Nlocal:            301 ave         301 max         301 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           2632 ave        2632 max        2632 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 2632
Ave neighs/atom = 8.744186
Ave special neighs/atom = 1.9933555
Neighbor list builds = 1036
Dangerous builds = 0

# Replace lj potential, now collapse
pair_style      lj/cut 3

# Cutoff simul when gyration under 5
# Variable created with equal requires v_ + 'name'
fix 3 all halt 1000 v_rog < 7

run 5000000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Per MPI rank memory allocation (min/avg/max) = 1861 | 1861 | 1861 Mbytes
   Step          Temp         Enthalpy         c_1      
    100000   0.99499952     19.693488      17.54414     
    101000   1.0168552      19.359612      17.538827    
    102000   1.0807545      20.561557      17.616396    
    103000   1.004057       19.773775      17.291949    
    104000   1.110835       19.940772      16.788329    
    105000   1.0145655      19.814089      16.287351    
    106000   0.82833277     18.393314      15.778112    
    107000   0.99603706     19.111894      15.735096    
    108000   1.0197664      19.021899      15.232908    
    109000   1.030013       18.853542      14.680488    
    110000   0.94838323     19.2992        14.594856    
    111000   1.0345649      18.867807      14.258209    
    112000   1.0308304      18.58293       13.585069    
    113000   1.1230018      18.221103      13.078601    
    114000   1.0007514      18.395171      12.682714    
    115000   0.93694144     18.915338      12.271626    
    116000   1.0085672      18.727773      12.04999     
    117000   1.0435243      18.751906      11.238158    
    118000   1.0006267      19.670664      10.986961    
    119000   0.97036507     18.256715      10.156134    
    120000   0.97290036     18.454663      9.7290996    
    121000   1.0792213      18.26256       9.4072101    
    122000   1.0245532      18.703731      9.2204766    
    123000   0.95546636     18.201453      8.8055739    
    124000   0.96685451     18.408971      8.4682539    
    125000   1.0245185      18.770502      8.1146169    
    126000   1.0640505      18.069887      7.5120706    
    127000   1.0910958      18.495857      7.0854309    
Fix halt condition for fix-id 3 met on step 128000 with value 6.645825601732855 (src/fix_halt.cpp:237)
    128000   1.0259171      17.886078      6.6458256    
Loop time of 35.4786 on 2 procs for 28000 steps with 301 atoms

Performance: 681875.005 tau/day, 789.207 timesteps/s
104.6% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.73903    | 0.73903    | 0.73903    |   0.0 |  2.08
Bond    | 0.18607    | 0.18607    | 0.18607    |   0.0 |  0.52
Neigh   | 34.102     | 34.102     | 34.102     |   0.0 | 96.12
Comm    | 0.0049822  | 0.0049822  | 0.0049822  |   0.0 |  0.01
Output  | 0.03612    | 0.03612    | 0.03612    |   0.0 |  0.10
Modify  | 0.38137    | 0.38137    | 0.38137    |   0.0 |  1.07
Other   |            | 0.02945    |            |       |  0.08

Nlocal:            301 ave         301 max         301 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:          18030 ave       18030 max       18030 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 18030
Ave neighs/atom = 59.900332
Ave special neighs/atom = 1.9933555
Neighbor list builds = 240
Dangerous builds = 0

# This simulation is done
# Move onto the next one
clear
  using 2 OpenMP thread(s) per MPI task
package omp 0
using multi-threaded neighbor list subroutines
next f
jump SELF

###
# Reference paper:
# K. Kremer and G. S. Grest
# Dynamics of entangled linear polymer melts: A molecular-dynamics simulation
# J Chem Phys 92, 5057 (1990)

##################################
# MIHIR: for branched polymers
# LJ minimum first to expand and explore, then collapse
###

###
# Looping through the various plusshaped polymers to simulate,
# define variables to switch through
variable f index bb51nuc1bl25bn4d30tot100 bb101nuc1bl50bn4d30tot200 bb151nuc1bl75bn4d30tot300 bb201nuc1bl100bn4d30tot400 bb251nuc1bl125bn4d30tot500 bb301nuc1bl150bn4d30tot600 bb351nuc1bl175bn4d30tot700 bb401nuc1bl200bn4d30tot800 bb451nuc1bl225bn4d30tot900 bb501nuc1bl250bn4d30tot1000 bb551nuc1bl275bn4d30tot1100 bb601nuc1bl300bn4d30tot1200
###


###
# Box and units  (use LJ units and periodic boundaries)
###

units lj
log plusshaped/logs3/$f.log
log plusshaped/logs3/bb201nuc1bl100bn4d30tot400.log

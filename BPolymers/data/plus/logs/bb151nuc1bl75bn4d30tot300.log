#atom_style bond #no stiffness
atom_style angle #with stiffness

boundary        p p p
###
# Pair interactions require lists of neighbours to be calculated
###

#neighbor 0.3 bin
neighbor 4 bin

neigh_modify every 1 delay 1 check yes
atom_modify sort 0 0
### Generate RESTART file, SPECIAL format, not a .txt file ###
### Useful if simulation crashes ###

restart 1000000 plusshaped/restarts/$f.restart
restart 1000000 plusshaped/restarts/bb151nuc1bl75bn4d30tot300.restart
#############################



### READ "start" data file ###

read_data plusshaped/$f.dat
read_data plusshaped/bb151nuc1bl75bn4d30tot300.dat
Reading data file ...
  orthogonal box = (-1000 -1000 -1000) to (1000 1000 1000)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  301 atoms
  scanning bonds ...
  3 = max bonds/atom
  scanning angles ...
  6 = max angles/atom
  reading bonds ...
  300 bonds
  reading angles ...
  302 angles
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        0        0       
  special bond factors coul:  0        0        0       
     4 = max # of 1-2 neighbors
     4 = max # of 1-3 neighbors
     8 = max # of 1-4 neighbors
    12 = max # of special neighbors
  special bonds CPU = 0.001 seconds
  read_data CPU = 0.047 seconds

######################

### READ "REstart" data file ###

######################



###
# Define groups (atom type 1 is group 'all')
###
group all type 1
301 atoms in group all


###
# Dump configs - "simple dumpings"
###

###
# Dump configs + box coords
###

dump   1   all   custom   1000  plusshaped/trjs/$f.lammpstrj  id  x y z  ix iy iz
dump   1   all   custom   1000  plusshaped/trjs/bb151nuc1bl75bn4d30tot300.lammpstrj  id  x y z  ix iy iz
dump_modify   1   format line "%d %.5f %.5f %.5f %d %d %d"

########################################################################


###################################################################
# Stiffness term
#
# E = K * (1+cos(theta)), K>0
#
angle_style   cosine
#change this coefficient to change stiffness (e.g. 1,5,10)
angle_coeff   1 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  Lennard-Jones 12-6 potential with cutoff:
#  potential E=4epsilon[ (sigma/r)^12 - (sigma/r)^6]  for r<r_cut
#
#  1.12246 = 2^(1/6) is the minimum of the potential


pair_style      lj/cut 1.12246152962189
#pair_style      lj/cut 3

#
#  pair_modify shift yes adds a constant to the potential such

#  that E(r_cut)=0. Forces remains unchanged.
#

pair_modify     shift yes

#
#  pair_coeff for lj/cut, specify 4:
#    * atom type interacting with
#    * atom type
#    * epsilon (energy units)
#    * sigma (distance units)
#

pair_coeff      1 1 1.0 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  soft potential, for PUSHING apart overlapping atoms
#  potential E=A*(1 + cos(pi*r/r_c))
#
#  1.12246 = 2^(1/6) is the cut-off r_c

#pair_style     soft 1.12246152962189

#
#  pair_coeff for soft, specify 3:
#    * atom type interacting with
#    * atom type
#    * A
#
#

#pair_coeff      1 1 100.0
###################################################################

###################################################################
# Pair interaction between bonded atoms
#
# Fene potential + Lennard Jones 12-6:

#
#  E= - 0.5 K R0^2 ln[ 1- (r/R0)^2]
#     + 4epsilon[ (sigma/r)^12 - (sigma/r)^6] + epsilon
#

bond_style   fene


#
# For style fene, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#   * epsilon (energy)  (LJ component)
#   * sigma (distance)  (LJ component)
#


special_bonds fene #<=== I M P O R T A N T (new command)
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        1        1       
  special bond factors coul:  0        1        1       
     4 = max # of 1-2 neighbors
    12 = max # of special neighbors
  special bonds CPU = 0.000 seconds

bond_coeff   1   30   2   1.0   1.0


###################################################

###################################################################
# Pair interaction between bonded atoms
#
# Harmonic potential:
#
#  E= K * (R-R0)^2
#

#bond_style   harmonic

#
# For style harmonic, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#

#bond_coeff   1   60.0   1.0
#bond_coeff   2   harmonic 0.1   1.0

###################################################
compute 1 all gyration
variable rog equal c_1
#compute 2 all coord/atom cutoff 1.1

#dump 2 all custom 10000 contact_number.dump id c_2


###
# Set up fixes
###
thermo_style   custom   step  temp enthalpy c_1
fix 1 all nve   ###NVE ensemble

fix 2 all   langevin   1.0 1.0 1.0  100103   ###Langevin integrator Tstart Tstop 1/friction rndseed


##### Sample thermodynamic info  (temperature, energy, pressure, etc.) #####
thermo 1000









############################################################################

###
# set timestep of integrator

timestep 0.01

###
# run integration for a number of steps
###
#run 0
#variable r equal c_1
#if "$r < 63.1" then "quit 1"

# lj potential minimum, cause molecule to explore
run 100000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 1 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 5.1224615
  ghost atom cutoff = 5.1224615
  binsize = 2.5612308, bins = 781 781 781
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut, perpetual
      attributes: half, newton on
      pair build: half/bin/newton
      stencil: half/bin/3d
      bin: standard
WARNING: Communication cutoff 5.12246152962189 is shorter than a bond length based estimate of 5.455. This may lead to errors. (src/comm.cpp:723)
Per MPI rank memory allocation (min/avg/max) = 1861 | 1861 | 1861 Mbytes
   Step          Temp         Enthalpy         c_1      
         0   0              13.218321      39.68912     
      1000   0.97552107     18.062522      38.321501    
      2000   1.0797716      20.17889       36.922302    
      3000   1.0363004      19.288878      35.427673    
      4000   0.9458959      19.164568      35.133113    
      5000   0.95318202     19.818518      34.116101    
      6000   1.0645813      20.460702      33.574527    
      7000   1.0320519      20.188672      33.173004    
      8000   0.97982509     20.396013      32.604729    
      9000   0.94646041     20.262056      32.139967    
     10000   0.99425844     20.0094        31.644262    
     11000   0.98114333     20.836778      31.20107     
     12000   0.95593715     19.915151      30.780834    
     13000   1.0605632      20.245911      30.444967    
     14000   0.95778125     20.515137      29.958609    
     15000   0.94651373     20.71962       29.837952    
     16000   0.97448296     20.400292      29.479914    
     17000   1.070414       20.640449      29.150199    
     18000   0.92624841     19.585134      29.239946    
     19000   0.99929304     20.235124      28.625026    
     20000   0.97977137     20.388698      28.05214     
     21000   1.0597432      20.530147      28.042366    
     22000   1.0512491      20.801849      28.267302    
     23000   0.97678443     20.440653      28.253214    
     24000   0.94282596     19.910297      28.509536    
     25000   0.91016308     19.66366       27.972374    
     26000   1.0123264      21.077375      27.180167    
     27000   0.95289564     20.433618      26.64273     
     28000   0.99630206     19.727414      26.470209    
     29000   0.976988       19.980058      26.498607    
     30000   0.97087135     20.721936      25.902672    
     31000   0.99865429     20.689942      25.444695    
     32000   0.99237396     20.525421      25.511157    
     33000   0.96624802     20.228758      25.153502    
     34000   0.969538       19.528776      24.673625    
     35000   1.0295169      20.293961      24.615957    
     36000   0.960803       19.796976      24.544488    
     37000   0.99512936     20.477115      24.450373    
     38000   0.98784675     19.694722      24.497895    
     39000   1.077452       20.537178      24.307798    
     40000   1.036386       20.863036      23.848577    
     41000   1.1032929      20.631014      23.528932    
     42000   0.9455503      20.329696      23.208142    
     43000   0.98497985     20.050952      23.061681    
     44000   0.96823859     19.977615      22.79374     
     45000   1.0158475      20.849608      22.890472    
     46000   1.0168748      20.744079      22.546179    
     47000   1.0537325      20.492479      21.982048    
     48000   1.0465582      21.332503      21.805178    
     49000   1.0022386      20.130293      21.898663    
     50000   0.99837118     21.31721       21.867043    
     51000   1.0138397      20.556228      22.208541    
     52000   0.97783967     21.362324      21.787379    
     53000   1.109687       21.054666      21.768168    
     54000   1.0591689      21.477484      21.844195    
     55000   1.0004772      20.415178      21.785943    
     56000   1.00267        20.969533      21.660911    
     57000   0.99111043     20.474091      21.464922    
     58000   1.0305397      20.380508      21.074254    
     59000   1.0028627      21.082688      21.264351    
     60000   1.0146127      20.32381       21.477586    
     61000   0.92011707     20.399514      21.565585    
     62000   0.95515296     20.847409      21.854208    
     63000   0.98911952     19.596828      22.090724    
     64000   0.98829862     20.233386      21.740949    
     65000   1.0381553      20.583439      21.926374    
     66000   1.0329484      19.826135      22.196029    
     67000   0.99979441     19.919203      21.618413    
     68000   0.98638268     20.62715       21.283312    
     69000   1.0207117      20.219516      20.90073     
     70000   0.99345278     20.592337      20.735466    
     71000   0.95068566     20.879085      20.744667    
     72000   1.0034104      19.777009      20.759676    
     73000   1.0812221      21.589003      21.35926     
     74000   0.97593776     20.877794      21.488712    
     75000   1.0335909      20.818474      21.203564    
     76000   1.0146453      20.288555      21.056979    
     77000   1.0012848      20.797829      20.886495    
     78000   1.0762503      19.847844      20.839164    
     79000   1.1254676      20.535062      20.768467    
     80000   0.98327361     19.64151       20.734963    
     81000   1.0462534      21.155773      20.314556    
     82000   0.98593676     20.453764      20.181375    
     83000   1.0018999      20.034099      19.780319    
     84000   1.053158       20.074765      19.558223    
     85000   1.0378398      19.801513      19.580635    
     86000   0.99744978     20.435027      20.005642    
     87000   1.1441566      21.201222      19.95121     
     88000   0.97316733     20.371263      19.957567    
     89000   1.0834542      20.300885      20.228312    
     90000   1.0038851      19.932642      19.917871    
     91000   0.9872343      20.059477      19.609415    
     92000   0.95971494     21.004697      19.157177    
     93000   1.0323921      20.295298      19.651414    
     94000   0.95296004     20.82445       19.647476    
     95000   1.017261       20.812977      19.332962    
     96000   1.0573424      21.40376       19.250893    
     97000   1.0161568      20.582026      18.970164    
     98000   1.0638756      20.3201        18.760997    
     99000   0.9584527      20.325461      18.522302    
    100000   1.0154448      19.783192      18.767301    
Loop time of 950.854 on 1 procs for 100000 steps with 301 atoms

Performance: 90865.644 tau/day, 105.169 timesteps/s
99.9% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 1.141      | 1.141      | 1.141      |   0.0 |  0.12
Bond    | 2.0232     | 2.0232     | 2.0232     |   0.0 |  0.21
Neigh   | 944.87     | 944.87     | 944.87     |   0.0 | 99.37
Comm    | 0.03867    | 0.03867    | 0.03867    |   0.0 |  0.00
Output  | 0.22846    | 0.22846    | 0.22846    |   0.0 |  0.02
Modify  | 2.3191     | 2.3191     | 2.3191     |   0.0 |  0.24
Other   |            | 0.2325     |            |       |  0.02

Nlocal:            301 ave         301 max         301 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           2889 ave        2889 max        2889 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 2889
Ave neighs/atom = 9.5980066
Ave special neighs/atom = 1.9933555
Neighbor list builds = 1039
Dangerous builds = 0

# Replace lj potential, now collapse
pair_style      lj/cut 3

# Cutoff simul when gyration under 5
# Variable created with equal requires v_ + 'name'
fix 3 all halt 1000 v_rog < 5

run 5000000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Per MPI rank memory allocation (min/avg/max) = 1861 | 1861 | 1861 Mbytes
   Step          Temp         Enthalpy         c_1      
    100000   1.0154448      18.813294      18.767301    
    101000   1.0098229      20.559254      18.49488     
    102000   1.0291995      19.582666      18.786541    
    103000   1.121867       19.371877      18.214013    
    104000   1.0324637      18.516745      17.337823    
    105000   1.0207573      18.576037      16.957962    
    106000   1.0286267      19.01061       16.533832    
    107000   1.0024299      18.666934      16.394031    
    108000   0.98843324     18.565859      15.980204    
    109000   0.94122245     17.737361      15.709892    
    110000   1.060412       18.941297      15.775552    
    111000   1.0657686      19.033727      15.720391    
    112000   0.9711753      18.613084      15.509418    
    113000   1.0591144      19.165413      15.294865    
    114000   1.0266484      18.881801      15.28755     
    115000   0.94344082     18.045087      14.918255    
    116000   1.0256702      18.336482      14.534163    
    117000   0.97865103     18.772046      13.945163    
    118000   1.0811036      17.855893      13.384663    
    119000   0.97980708     18.125988      13.096792    
    120000   1.013521       18.23612       12.925591    
    121000   1.0306858      18.688424      12.507232    
    122000   1.018849       18.566014      12.219278    
    123000   1.010832       18.550599      11.649346    
    124000   0.96071066     16.817932      11.313786    
    125000   1.0504022      18.289617      10.919363    
    126000   1.0494828      17.643817      11.054648    
    127000   1.0566289      18.482997      10.522858    
    128000   1.0044061      18.176883      10.093808    
    129000   1.0266239      18.228625      9.9094032    
    130000   1.0150662      18.623407      9.6676468    
    131000   1.0881736      17.114427      9.6832109    
    132000   1.0076143      18.210805      9.2656196    
    133000   1.0782734      18.671725      9.271441     
    134000   1.0106148      18.399017      8.8007804    
    135000   1.0271018      18.163163      8.4401862    
    136000   1.1180227      18.956664      8.2881207    
    137000   1.0859094      18.583474      8.1450766    
    138000   0.99164412     18.284056      8.1715019    
    139000   0.96818047     17.331672      7.8927702    
    140000   1.0584035      17.92973       8.2394667    
    141000   0.96507328     17.944481      8.1657801    
    142000   0.97300633     19.114097      8.0709673    
    143000   0.94019619     17.507947      8.0051242    
    144000   1.0106035      17.192488      7.8845573    
    145000   0.95162526     17.330367      7.7388554    
    146000   1.0287649      16.88482       7.4005364    
    147000   0.97947108     17.127286      7.4268332    
    148000   1.0171944      17.618571      7.3640251    
    149000   1.021092       17.326871      7.283853     
    150000   0.96889536     18.446848      7.1587626    
    151000   1.0185703      17.099567      6.9565014    
    152000   0.97924634     17.450558      6.6220647    
    153000   0.9989724      18.0004        6.6684085    
    154000   1.0173941      17.12371       6.6783588    
    155000   0.92977458     17.569201      6.537248     
    156000   1.0061598      17.805707      6.6484892    
    157000   0.94087153     17.520586      6.9247445    
    158000   0.91673616     17.75152       6.796729     
    159000   1.0189145      17.412718      6.3691364    
    160000   0.96704424     18.497257      6.2764952    
    161000   0.96586585     17.783055      6.2486645    
    162000   0.95653636     17.291435      6.2174434    
    163000   0.96850908     17.999957      6.1656752    
    164000   0.96702484     16.402505      5.8824536    
    165000   0.90994981     16.771996      5.938554     
    166000   0.99861874     17.411229      5.5877474    
    167000   1.013824       18.052989      5.1063691    
Fix halt condition for fix-id 3 met on step 168000 with value 4.893416381381769 (src/fix_halt.cpp:237)
    168000   1.1106182      16.758097      4.8934164    
Loop time of 115.057 on 1 procs for 68000 steps with 301 atoms

Performance: 510633.325 tau/day, 591.011 timesteps/s
99.9% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 12.846     | 12.846     | 12.846     |   0.0 | 11.17
Bond    | 1.351      | 1.351      | 1.351      |   0.0 |  1.17
Neigh   | 98.953     | 98.953     | 98.953     |   0.0 | 86.00
Comm    | 0.030854   | 0.030854   | 0.030854   |   0.0 |  0.03
Output  | 0.13672    | 0.13672    | 0.13672    |   0.0 |  0.12
Modify  | 1.558      | 1.558      | 1.558      |   0.0 |  1.35
Other   |            | 0.1813     |            |       |  0.16

Nlocal:            301 ave         301 max         301 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:          29818 ave       29818 max       29818 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 29818
Ave neighs/atom = 99.063123
Ave special neighs/atom = 1.9933555
Neighbor list builds = 518
Dangerous builds = 0

# This simulation is done
# Move onto the next one
clear
OMP_NUM_THREADS environment is not set. Defaulting to 1 thread. (src/comm.cpp:98)
  using 1 OpenMP thread(s) per MPI task
next f
jump SELF

###
# Reference paper:
# K. Kremer and G. S. Grest
# Dynamics of entangled linear polymer melts: A molecular-dynamics simulation
# J Chem Phys 92, 5057 (1990)

##################################
# MIHIR: for branched polymers
# LJ minimum first to expand and explore, then collapse
###

###
# Looping through the various plusshaped polymers to simulate,
# define variables to switch through
variable f index bb51nuc1bl25bn4d30tot100 bb101nuc1bl50bn4d30tot200 bb151nuc1bl75bn4d30tot300 bb201nuc1bl100bn4d30tot400 bb251nuc1bl125bn4d30tot500 bb301nuc1bl150bn4d30tot600 bb351nuc1bl175bn4d30tot700 bb401nuc1bl200bn4d30tot800 bb451nuc1bl225bn4d30tot900 bb501nuc1bl250bn4d30tot1000 bb551nuc1bl275bn4d30tot1100 bb601nuc1bl300bn4d30tot1200
###


###
# Box and units  (use LJ units and periodic boundaries)
###

units lj
log plusshaped/logs/$f.log
log plusshaped/logs/bb201nuc1bl100bn4d30tot400.log

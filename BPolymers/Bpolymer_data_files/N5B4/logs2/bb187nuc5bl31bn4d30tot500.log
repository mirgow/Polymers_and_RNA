#atom_style bond #no stiffness
atom_style angle #with stiffness

boundary        p p p
###
# Pair interactions require lists of neighbours to be calculated
###

#neighbor 0.3 bin
neighbor 4 bin

neigh_modify every 1 delay 1 check yes
atom_modify sort 0 0
### Generate RESTART file, SPECIAL format, not a .txt file ###
### Useful if simulation crashes ###

restart 1000000 nuc5branch4/restarts2/$f.restart
restart 1000000 nuc5branch4/restarts2/bb187nuc5bl31bn4d30tot500.restart
#############################



### READ "start" data file ###

read_data nuc5branch4/$f.dat
read_data nuc5branch4/bb187nuc5bl31bn4d30tot500.dat
Reading data file ...
  orthogonal box = (-1000 -1000 -1000) to (1000 1000 1000)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  497 atoms
  scanning bonds ...
  3 = max bonds/atom
  scanning angles ...
  6 = max angles/atom
  reading bonds ...
  496 bonds
  reading angles ...
  510 angles
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        0        0       
  special bond factors coul:  0        0        0       
     4 = max # of 1-2 neighbors
     4 = max # of 1-3 neighbors
     8 = max # of 1-4 neighbors
    12 = max # of special neighbors
  special bonds CPU = 0.001 seconds
  read_data CPU = 0.071 seconds

######################

### READ "REstart" data file ###

######################



###
# Define groups (atom type 1 is group 'all')
###
group all type 1
497 atoms in group all


###
# Dump configs - "simple dumpings"
###

###
# Dump configs + box coords
###

dump   1   all   custom   1000  nuc5branch4/trjs2/$f.lammpstrj  id  x y z  ix iy iz
dump   1   all   custom   1000  nuc5branch4/trjs2/bb187nuc5bl31bn4d30tot500.lammpstrj  id  x y z  ix iy iz
dump_modify   1   format line "%d %.5f %.5f %.5f %d %d %d"

########################################################################


###################################################################
# Stiffness term
#
# E = K * (1+cos(theta)), K>0
#
angle_style   cosine
#change this coefficient to change stiffness (e.g. 1,5,10)
angle_coeff   1 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  Lennard-Jones 12-6 potential with cutoff:
#  potential E=4epsilon[ (sigma/r)^12 - (sigma/r)^6]  for r<r_cut
#
#  1.12246 = 2^(1/6) is the minimum of the potential


pair_style      lj/cut 1.12246152962189
#pair_style      lj/cut 3

#
#  pair_modify shift yes adds a constant to the potential such

#  that E(r_cut)=0. Forces remains unchanged.
#

pair_modify     shift yes

#
#  pair_coeff for lj/cut, specify 4:
#    * atom type interacting with
#    * atom type
#    * epsilon (energy units)
#    * sigma (distance units)
#

pair_coeff      1 1 1.0 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  soft potential, for PUSHING apart overlapping atoms
#  potential E=A*(1 + cos(pi*r/r_c))
#
#  1.12246 = 2^(1/6) is the cut-off r_c

#pair_style     soft 1.12246152962189

#
#  pair_coeff for soft, specify 3:
#    * atom type interacting with
#    * atom type
#    * A
#
#

#pair_coeff      1 1 100.0
###################################################################

###################################################################
# Pair interaction between bonded atoms
#
# Fene potential + Lennard Jones 12-6:

#
#  E= - 0.5 K R0^2 ln[ 1- (r/R0)^2]
#     + 4epsilon[ (sigma/r)^12 - (sigma/r)^6] + epsilon
#

bond_style   fene


#
# For style fene, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#   * epsilon (energy)  (LJ component)
#   * sigma (distance)  (LJ component)
#


special_bonds fene #<=== I M P O R T A N T (new command)
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        1        1       
  special bond factors coul:  0        1        1       
     4 = max # of 1-2 neighbors
    12 = max # of special neighbors
  special bonds CPU = 0.000 seconds

bond_coeff   1   30   2   1.0   1.0


###################################################

###################################################################
# Pair interaction between bonded atoms
#
# Harmonic potential:
#
#  E= K * (R-R0)^2
#

#bond_style   harmonic

#
# For style harmonic, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#

#bond_coeff   1   60.0   1.0
#bond_coeff   2   harmonic 0.1   1.0

###################################################
compute 1 all gyration
variable rog equal c_1
#compute 2 all coord/atom cutoff 1.1

#dump 2 all custom 10000 contact_number.dump id c_2


###
# Set up fixes
###
thermo_style   custom   step  temp enthalpy c_1
fix 1 all nve   ###NVE ensemble

fix 2 all   langevin   1.0 1.0 1.0  778655   ###Langevin integrator Tstart Tstop 1/friction rndseed


##### Sample thermodynamic info  (temperature, energy, pressure, etc.) #####
thermo 1000









############################################################################

###
# set timestep of integrator

timestep 0.01

###
# run integration for a number of steps
###
#run 0
#variable r equal c_1
#if "$r < 63.1" then "quit 1"

# lj potential minimum, cause molecule to explore
run 100000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Neighbor list info ...
  update: every = 1 steps, delay = 1 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 5.1224615
  ghost atom cutoff = 5.1224615
  binsize = 2.5612308, bins = 781 781 781
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut/omp, perpetual
      attributes: half, newton on, omp
      pair build: half/bin/newton/omp
      stencil: half/bin/3d
      bin: standard
WARNING: Communication cutoff 5.12246152962189 is shorter than a bond length based estimate of 5.455. This may lead to errors. (src/comm.cpp:723)
Per MPI rank memory allocation (min/avg/max) = 1861 | 1861 | 1861 Mbytes
   Step          Temp         Enthalpy         c_1      
         0   0              13.258451      38.704835    
      1000   1.0325817      19.372729      37.497226    
      2000   1.0360591      19.260856      36.732365    
      3000   1.0098065      19.655586      35.839968    
      4000   0.97627888     20.199759      35.263831    
      5000   1.00985        19.76953       35.104397    
      6000   0.96065247     20.066104      34.619033    
      7000   1.0006282      20.497185      34.09246     
      8000   1.0208815      20.679494      33.780808    
      9000   1.0133579      20.713067      33.905137    
     10000   0.97296794     20.351568      34.025274    
     11000   1.0736225      20.311811      34.211355    
     12000   1.022372       19.907139      34.097621    
     13000   1.0305951      20.759969      34.129144    
     14000   0.99045568     20.477384      34.057817    
     15000   0.95418117     20.022648      33.755673    
     16000   0.9834033      20.498776      33.378499    
     17000   0.95299904     20.20294       33.555852    
     18000   1.060454       20.308607      33.014539    
     19000   1.0441865      20.490425      32.871501    
     20000   0.99687027     20.830398      32.670081    
     21000   0.98887104     21.01945       32.273283    
     22000   1.014429       20.16948       31.811631    
     23000   1.0308351      20.299052      31.720341    
     24000   1.0417219      20.702049      31.600955    
     25000   0.93748911     20.101546      31.179758    
     26000   1.01233        20.98222       31.268942    
     27000   0.96731329     20.673436      31.025765    
     28000   1.0094151      20.770149      30.866305    
     29000   0.97486746     20.679666      30.440429    
     30000   0.98152525     20.645259      30.281649    
     31000   0.99958737     20.380209      30.404933    
     32000   1.0126358      20.847014      30.414661    
     33000   0.97144346     20.485974      30.558236    
     34000   1.0398132      21.355722      30.203028    
     35000   1.0707712      20.608901      30.091393    
     36000   1.0652815      20.745927      29.692891    
     37000   1.056353       21.329672      29.833633    
     38000   0.99264599     19.877243      29.558415    
     39000   0.97768258     19.944557      29.503831    
     40000   1.0069508      20.888688      29.150733    
     41000   0.95761071     21.146177      29.243656    
     42000   0.97747465     20.57337       28.978712    
     43000   1.0026963      20.018657      28.859645    
     44000   1.0703812      20.384603      28.71862     
     45000   0.97798532     21.144294      28.476168    
     46000   1.0278028      20.969507      28.085415    
     47000   1.0206467      19.931442      27.875858    
     48000   1.0056429      20.973637      27.70488     
     49000   1.0372659      20.709359      27.632067    
     50000   0.97614598     21.271065      27.791594    
     51000   1.0090649      20.77633       27.558966    
     52000   0.98951288     20.578135      27.401082    
     53000   1.0143689      20.300133      27.398993    
     54000   1.0497529      20.508677      27.110223    
     55000   0.99436961     20.344688      26.897434    
     56000   1.0163993      20.617361      27.141866    
     57000   0.99921688     20.236616      27.307811    
     58000   1.057263       21.217513      27.139354    
     59000   0.95603059     20.346994      27.001347    
     60000   0.99657294     20.892277      26.80746     
     61000   1.0132201      20.7891        26.81812     
     62000   1.0436023      20.376049      26.53585     
     63000   1.0473429      21.256946      26.592215    
     64000   1.0470945      20.894387      26.512973    
     65000   1.0488628      21.061085      26.542494    
     66000   1.045361       20.55126       26.579507    
     67000   1.0405209      20.7757        26.577736    
     68000   1.0516904      20.142184      26.341523    
     69000   0.98448579     20.564104      26.479397    
     70000   0.98525058     20.31567       26.612134    
     71000   1.0104511      20.340483      26.783696    
     72000   1.0055113      20.196979      26.628291    
     73000   0.98956839     21.178102      26.420671    
     74000   1.0035691      20.226402      26.263358    
     75000   0.96824941     20.505592      26.290308    
     76000   0.99799297     20.720387      26.167244    
     77000   0.92802477     19.871513      26.320023    
     78000   1.0174843      20.491958      26.285599    
     79000   0.98192863     20.471084      26.594095    
     80000   0.96421392     20.069322      26.185878    
     81000   0.95740494     19.899886      25.930641    
     82000   1.0451803      20.230602      26.151692    
     83000   0.98048484     20.073105      26.062752    
     84000   1.0292559      19.918555      26.041367    
     85000   0.99127609     20.450991      26.222451    
     86000   1.044896       20.643035      25.863902    
     87000   1.0013264      20.985211      25.490715    
     88000   1.047442       20.554948      25.507675    
     89000   1.0320743      21.086175      25.428291    
     90000   1.002056       20.834873      25.438858    
     91000   1.0275961      20.435756      25.287342    
     92000   1.0369678      19.913226      25.198479    
     93000   0.96438884     20.444302      25.203144    
     94000   1.0147096      20.341384      25.319657    
     95000   0.9948591      20.461165      25.256073    
     96000   1.0407188      21.476388      25.386385    
     97000   0.96977203     20.811204      25.337999    
     98000   1.0572535      20.960297      25.503415    
     99000   1.0211453      20.826911      25.287111    
    100000   0.98552758     20.665702      25.34615     
Loop time of 481.145 on 2 procs for 100000 steps with 497 atoms

Performance: 179571.488 tau/day, 207.837 timesteps/s
101.9% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 1.4153     | 1.4153     | 1.4153     |   0.0 |  0.29
Bond    | 1.804      | 1.804      | 1.804      |   0.0 |  0.37
Neigh   | 473.95     | 473.95     | 473.95     |   0.0 | 98.51
Comm    | 0.036961   | 0.036961   | 0.036961   |   0.0 |  0.01
Output  | 0.23075    | 0.23075    | 0.23075    |   0.0 |  0.05
Modify  | 3.4356     | 3.4356     | 3.4356     |   0.0 |  0.71
Other   |            | 0.2691     |            |       |  0.06

Nlocal:            497 ave         497 max         497 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           5733 ave        5733 max        5733 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 5733
Ave neighs/atom = 11.535211
Ave special neighs/atom = 1.9959759
Neighbor list builds = 1127
Dangerous builds = 0

# Replace lj potential, now collapse
pair_style      lj/cut 3

# Cutoff simul when gyration under 10
# Variable created with equal requires v_ + 'name'
fix 3 all halt 1000 v_rog < 7

run 3000000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Per MPI rank memory allocation (min/avg/max) = 1861 | 1861 | 1861 Mbytes
   Step          Temp         Enthalpy         c_1      
    100000   0.98552758     19.599106      25.34615     
    101000   1.0406924      20.219238      24.954227    
    102000   1.0092036      19.736966      24.634158    
    103000   0.99911867     19.065831      24.64027     
    104000   1.0029657      18.749378      24.832631    
    105000   0.99432898     19.328602      25.001809    
    106000   0.9686998      18.261673      24.650627    
    107000   0.9749506      18.77907       24.671292    
    108000   1.0440921      19.367439      24.141363    
    109000   1.0142064      18.935234      23.430982    
    110000   0.96041559     17.973003      22.878448    
    111000   0.97984449     17.837731      22.633998    
    112000   1.0083236      18.590164      22.296821    
    113000   1.04719        18.429897      21.985895    
    114000   1.0646339      19.185741      21.629277    
    115000   1.0557307      18.521829      21.366263    
    116000   0.98520282     18.660485      20.983938    
    117000   0.95377992     18.029511      20.706284    
    118000   1.0260396      17.457418      20.382375    
    119000   1.0126165      19.336711      20.228721    
    120000   0.99439337     18.224038      20.063882    
    121000   1.020347       18.525914      19.718243    
    122000   0.99796531     17.710158      19.510689    
    123000   1.0464129      18.490936      19.439235    
    124000   1.0067736      18.720915      19.355646    
    125000   1.0225691      18.945422      19.222444    
    126000   1.0199524      18.315348      19.021012    
    127000   1.0157726      18.436906      18.620568    
    128000   1.0032368      18.347589      18.660362    
    129000   0.99798269     18.439571      18.524522    
    130000   1.0001385      18.089667      18.576418    
    131000   0.97761523     17.858213      18.441238    
    132000   0.95217078     18.132681      18.348613    
    133000   1.0301527      18.010195      18.149843    
    134000   0.94905514     18.249844      18.189902    
    135000   0.96567763     17.85238       18.214121    
    136000   1.0115893      17.822327      18.055903    
    137000   1.0124405      17.559549      18.09051     
    138000   0.98154408     17.834182      17.981914    
    139000   0.98269311     17.634566      17.947364    
    140000   1.0378505      17.68657       18.064107    
    141000   1.0159971      17.441941      17.836455    
    142000   0.95555559     18.489417      17.681848    
    143000   1.0396922      18.014735      17.926693    
    144000   0.9854793      18.327506      17.620851    
    145000   0.97321607     17.463802      17.531562    
    146000   0.97924415     18.252201      17.362535    
    147000   1.0113529      18.27685       17.343891    
    148000   0.99396084     17.250296      17.177445    
    149000   0.98637391     16.64967       17.174809    
    150000   0.99067016     17.995507      17.233855    
    151000   1.0749049      17.694416      16.96526     
    152000   1.0474704      17.807827      17.037754    
    153000   0.96636652     17.177994      17.521715    
    154000   0.97707685     17.691389      17.290952    
    155000   1.0301242      18.02699       16.77763     
    156000   1.0235135      17.233744      16.325843    
    157000   1.012785       17.756165      16.243281    
    158000   1.0052653      17.074942      15.989954    
    159000   0.99162698     17.309159      16.193006    
    160000   0.96467856     17.530877      16.391442    
    161000   1.0128947      17.574821      16.432016    
    162000   0.99548726     18.615308      16.373081    
    163000   1.0078495      18.156682      15.638022    
    164000   1.033229       17.804713      15.739694    
    165000   0.97767496     17.784599      15.558285    
    166000   1.0001943      17.37187       15.468119    
    167000   0.97400516     18.158067      14.976292    
    168000   0.95072924     18.415806      15.285031    
    169000   0.99259738     17.391857      15.280352    
    170000   0.95397739     17.139869      14.950721    
    171000   0.98199446     17.232862      14.840272    
    172000   0.94345527     17.217206      14.558514    
    173000   0.99767059     17.262256      14.399507    
    174000   0.9471792      16.988125      14.324794    
    175000   1.0177886      18.426816      14.015736    
    176000   0.97119625     18.349487      13.756483    
    177000   1.0757307      16.961677      13.754625    
    178000   0.98305887     17.694845      13.432363    
    179000   1.0496934      17.930891      12.971577    
    180000   1.0555939      17.573488      12.86837     
    181000   1.0352883      17.386131      12.769156    
    182000   0.97227677     18.374723      12.827904    
    183000   1.0239044      17.179797      12.562298    
    184000   0.98374645     18.003575      12.362177    
    185000   1.076709       17.49367       12.294494    
    186000   0.97053517     17.443142      12.366296    
    187000   1.0119978      17.697081      12.085337    
    188000   0.96723727     17.157099      11.90648     
    189000   0.95179526     18.454241      11.728608    
    190000   0.99215839     17.344036      11.983047    
    191000   0.92205656     17.216922      11.978567    
    192000   0.95116578     18.106398      11.881983    
    193000   1.0297747      17.693441      11.979367    
    194000   1.0595554      17.646892      11.923394    
    195000   1.0230127      18.131779      11.894502    
    196000   1.0295603      17.72966       11.812442    
    197000   1.0019255      17.495468      11.563959    
    198000   0.99029959     17.44728       11.367819    
    199000   1.0075576      17.763782      11.233003    
    200000   1.0857574      17.858793      10.863627    
    201000   0.97725041     17.473795      10.561966    
    202000   1.0004935      17.877359      10.235976    
    203000   0.94733643     17.193128      10.267807    
    204000   0.97380066     17.540949      10.333095    
    205000   1.0367287      17.223558      10.268282    
    206000   0.93180005     17.316347      10.216795    
    207000   0.99272255     17.198497      10.220993    
    208000   1.0628086      17.376369      10.255362    
    209000   0.98089499     17.281375      10.13022     
    210000   1.0644234      17.844799      10.067536    
    211000   1.0123666      16.742059      10.198208    
    212000   0.97902889     17.247593      10.118999    
    213000   1.0111591      18.511093      9.9554582    
    214000   0.98440798     17.332777      9.7604487    
    215000   1.0089036      17.088983      9.7477331    
    216000   1.0441154      17.411959      9.7606601    
    217000   1.002795       16.925237      9.7620802    
    218000   0.98293624     17.557868      9.6244514    
    219000   0.99575772     17.046892      9.6566281    
    220000   1.0380481      17.376377      9.219458     
    221000   1.0362267      18.427041      8.7652111    
    222000   1.0401385      16.872548      9.0009681    
    223000   0.96668054     17.651488      9.0703058    
    224000   0.98167405     17.16987       8.8178385    
    225000   1.0200724      17.864599      8.7247768    
    226000   0.97827022     16.50234       8.9043058    
    227000   0.93612142     18.268225      8.9578895    
    228000   0.97556505     17.08094       8.995604     
    229000   0.99276868     17.281517      8.928681     
    230000   1.007575       17.175372      8.857985     
    231000   1.0098991      16.922182      8.6557179    
    232000   1.053652       18.432772      8.5476611    
    233000   0.98174391     17.494842      8.5318511    
    234000   1.0478828      17.415495      8.412377     
    235000   0.93878612     17.188434      8.4527139    
    236000   0.96792428     17.095113      8.3786286    
    237000   1.0431113      17.499469      8.4405901    
    238000   1.0369038      17.843132      8.2896027    
    239000   0.97432493     17.646856      8.1088014    
    240000   1.0153636      17.608611      8.2647067    
    241000   0.95200264     17.705166      8.0551362    
    242000   1.0628137      17.720799      8.1222258    
    243000   0.96670702     17.759026      8.1956989    
    244000   1.0058943      17.552908      8.1193676    
    245000   1.0289542      17.679739      8.0116344    
    246000   0.98922415     16.78684       7.9985372    
    247000   1.0018107      16.95555       7.9061843    
    248000   1.0321028      17.78709       7.7958912    
    249000   0.99727588     17.526794      7.7570151    
    250000   1.0147128      16.766521      7.6014203    
    251000   1.01487        17.520473      7.4853808    
    252000   0.96186314     17.367516      7.2772613    
    253000   1.026876       18.276806      7.4391084    
    254000   0.99249713     18.248108      7.6276738    
    255000   1.037711       18.039319      7.7788944    
    256000   1.0572631      17.616608      7.647826     
    257000   1.0047739      17.953951      7.58265      
    258000   1.0219406      16.840059      7.6823965    
    259000   0.95765108     18.115013      7.4474838    
    260000   1.033391       17.366375      7.4712188    
    261000   0.97104149     16.712689      7.2538447    
Fix halt condition for fix-id 3 met on step 262000 with value 6.996464676626917 (src/fix_halt.cpp:237)
    262000   0.99634312     18.143341      6.9964647    
Loop time of 217.856 on 2 procs for 162000 steps with 497 atoms

Performance: 642480.180 tau/day, 743.611 timesteps/s
118.5% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 29.711     | 29.711     | 29.711     |   0.0 | 13.64
Bond    | 2.7469     | 2.7469     | 2.7469     |   0.0 |  1.26
Neigh   | 179.33     | 179.33     | 179.33     |   0.0 | 82.32
Comm    | 0.055134   | 0.055134   | 0.055134   |   0.0 |  0.03
Output  | 0.41541    | 0.41541    | 0.41541    |   0.0 |  0.19
Modify  | 5.1649     | 5.1649     | 5.1649     |   0.0 |  2.37
Other   |            | 0.4274     |            |       |  0.20

Nlocal:            497 ave         497 max         497 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:          60568 ave       60568 max       60568 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 60568
Ave neighs/atom = 121.8672
Ave special neighs/atom = 1.9959759
Neighbor list builds = 1248
Dangerous builds = 0

# This simulation is done
# Move onto the next one
clear
  using 2 OpenMP thread(s) per MPI task
package omp 0
using multi-threaded neighbor list subroutines
next f
jump SELF

###
# Reference paper:
# K. Kremer and G. S. Grest
# Dynamics of entangled linear polymer melts: A molecular-dynamics simulation
# J Chem Phys 92, 5057 (1990)

##################################
# MIHIR: for branched polymers
# LJ minimum first to expand and explore, then collapse
###

###
# Looping through the various nuc5branch4 polymers to simulate,
# define variables to switch through
variable f index bb37nuc5bl6bn4d30tot100 bb75nuc5bl12bn4d30tot200 bb112nuc5bl18bn4d30tot300 bb150nuc5bl25bn4d30tot400 bb187nuc5bl31bn4d30tot500 bb225nuc5bl37bn4d30tot600 bb262nuc5bl43bn4d30tot700 bb300nuc5bl50bn4d30tot800 bb337nuc5bl56bn4d30tot900 bb375nuc5bl62bn4d30tot1000 bb412nuc5bl68bn4d30tot1100 bb450nuc5bl75bn4d30tot1200
# variable f index bb75nuc5bl12bn4d30tot200
# variable f index bb337nuc5bl56bn4d30tot900
###


###
# Box and units  (use LJ units and periodic boundaries)
###

units lj
log nuc5branch4/logs2/$f.log
log nuc5branch4/logs2/bb225nuc5bl37bn4d30tot600.log

#atom_style bond #no stiffness
atom_style angle #with stiffness

boundary        p p p
###
# Pair interactions require lists of neighbours to be calculated
###

#neighbor 0.3 bin
neighbor 4 bin

neigh_modify every 1 delay 1 check yes
atom_modify sort 0 0
### Generate RESTART file, SPECIAL format, not a .txt file ###
### Useful if simulation crashes ###

restart 1000000 nuc5branch4/restarts3/$f.restart
restart 1000000 nuc5branch4/restarts3/bb37nuc5bl6bn4d30tot100.restart
#############################



### READ "start" data file ###

read_data nuc5branch4/$f.dat
read_data nuc5branch4/bb37nuc5bl6bn4d30tot100.dat
Reading data file ...
  orthogonal box = (-1000 -1000 -1000) to (1000 1000 1000)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  97 atoms
  scanning bonds ...
  3 = max bonds/atom
  scanning angles ...
  6 = max angles/atom
  reading bonds ...
  96 bonds
  reading angles ...
  110 angles
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        0        0       
  special bond factors coul:  0        0        0       
     4 = max # of 1-2 neighbors
     4 = max # of 1-3 neighbors
     8 = max # of 1-4 neighbors
    12 = max # of special neighbors
  special bonds CPU = 0.001 seconds
  read_data CPU = 0.027 seconds

######################

### READ "REstart" data file ###

######################



###
# Define groups (atom type 1 is group 'all')
###
group all type 1
97 atoms in group all


###
# Dump configs - "simple dumpings"
###

###
# Dump configs + box coords
###

dump   1   all   custom   1000  nuc5branch4/trjs3/$f.lammpstrj  id  x y z  ix iy iz
dump   1   all   custom   1000  nuc5branch4/trjs3/bb37nuc5bl6bn4d30tot100.lammpstrj  id  x y z  ix iy iz
dump_modify   1   format line "%d %.5f %.5f %.5f %d %d %d"

########################################################################


###################################################################
# Stiffness term
#
# E = K * (1+cos(theta)), K>0
#
angle_style   cosine
#change this coefficient to change stiffness (e.g. 1,5,10)
angle_coeff   1 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  Lennard-Jones 12-6 potential with cutoff:
#  potential E=4epsilon[ (sigma/r)^12 - (sigma/r)^6]  for r<r_cut
#
#  1.12246 = 2^(1/6) is the minimum of the potential


pair_style      lj/cut 1.12246152962189
#pair_style      lj/cut 3

#
#  pair_modify shift yes adds a constant to the potential such

#  that E(r_cut)=0. Forces remains unchanged.
#

pair_modify     shift yes

#
#  pair_coeff for lj/cut, specify 4:
#    * atom type interacting with
#    * atom type
#    * epsilon (energy units)
#    * sigma (distance units)
#

pair_coeff      1 1 1.0 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  soft potential, for PUSHING apart overlapping atoms
#  potential E=A*(1 + cos(pi*r/r_c))
#
#  1.12246 = 2^(1/6) is the cut-off r_c

#pair_style     soft 1.12246152962189

#
#  pair_coeff for soft, specify 3:
#    * atom type interacting with
#    * atom type
#    * A
#
#

#pair_coeff      1 1 100.0
###################################################################

###################################################################
# Pair interaction between bonded atoms
#
# Fene potential + Lennard Jones 12-6:

#
#  E= - 0.5 K R0^2 ln[ 1- (r/R0)^2]
#     + 4epsilon[ (sigma/r)^12 - (sigma/r)^6] + epsilon
#

bond_style   fene


#
# For style fene, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#   * epsilon (energy)  (LJ component)
#   * sigma (distance)  (LJ component)
#


special_bonds fene #<=== I M P O R T A N T (new command)
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        1        1       
  special bond factors coul:  0        1        1       
     4 = max # of 1-2 neighbors
    12 = max # of special neighbors
  special bonds CPU = 0.001 seconds

bond_coeff   1   30   2   1.0   1.0


###################################################

###################################################################
# Pair interaction between bonded atoms
#
# Harmonic potential:
#
#  E= K * (R-R0)^2
#

#bond_style   harmonic

#
# For style harmonic, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#

#bond_coeff   1   60.0   1.0
#bond_coeff   2   harmonic 0.1   1.0

###################################################
compute 1 all gyration
variable rog equal c_1
#compute 2 all coord/atom cutoff 1.1

#dump 2 all custom 10000 contact_number.dump id c_2


###
# Set up fixes
###
thermo_style   custom   step  temp enthalpy c_1
fix 1 all nve   ###NVE ensemble

fix 2 all   langevin   1.0 1.0 1.0  158102   ###Langevin integrator Tstart Tstop 1/friction rndseed


##### Sample thermodynamic info  (temperature, energy, pressure, etc.) #####
thermo 1000









############################################################################

###
# set timestep of integrator

timestep 0.01

###
# run integration for a number of steps
###
#run 0
#variable r equal c_1
#if "$r < 63.1" then "quit 1"

# lj potential minimum, cause molecule to explore
run 100000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Neighbor list info ...
  update: every = 1 steps, delay = 1 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 5.1224615
  ghost atom cutoff = 5.1224615
  binsize = 2.5612308, bins = 781 781 781
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut/omp, perpetual
      attributes: half, newton on, omp
      pair build: half/bin/newton/omp
      stencil: half/bin/3d
      bin: standard
WARNING: Communication cutoff 5.12246152962189 is shorter than a bond length based estimate of 5.455. This may lead to errors. (src/comm.cpp:723)
Per MPI rank memory allocation (min/avg/max) = 1861 | 1861 | 1861 Mbytes
   Step          Temp         Enthalpy         c_1      
         0   0              13.237871      6.5537782    
      1000   0.94114786     19.447854      5.9757558    
      2000   0.90308847     20.102468      6.1606907    
      3000   0.93088129     19.215257      6.2995905    
      4000   1.0353425      20.344059      5.6669417    
      5000   0.96556535     19.60789       6.2956767    
      6000   1.0343654      20.899091      7.1606511    
      7000   0.97380702     21.159475      6.3634438    
      8000   1.0130074      20.304809      6.1629577    
      9000   0.95338133     22.252918      5.6482131    
     10000   0.97710791     20.365661      6.2055269    
     11000   1.0479794      19.958731      6.0696582    
     12000   1.1185536      21.195237      6.3363188    
     13000   0.93064777     19.569563      5.8132617    
     14000   0.99297511     20.591301      6.1299852    
     15000   0.91554381     21.095786      5.8375586    
     16000   0.88655123     20.458666      5.4856508    
     17000   1.0312103      20.136785      5.5435468    
     18000   1.0365754      20.619195      4.9945735    
     19000   1.1116173      19.293128      5.0184203    
     20000   1.0689424      19.900065      4.294488     
     21000   0.95188428     20.240533      4.4574933    
     22000   0.95536454     19.740258      4.4105012    
     23000   0.9631399      19.533095      4.4961363    
     24000   0.84571082     19.790053      4.6195792    
     25000   1.0765086      18.751565      4.5531433    
     26000   1.1438772      20.459567      4.6370547    
     27000   0.97836001     19.520748      4.7472301    
     28000   0.95121127     19.951225      4.8130326    
     29000   1.0742451      20.11786       4.5077479    
     30000   0.89559552     20.369716      4.4444381    
     31000   0.94568938     20.950204      4.4454973    
     32000   1.1421352      20.706354      4.560742     
     33000   0.94620938     21.469177      4.5449555    
     34000   0.99442572     21.582891      4.2390615    
     35000   1.1020146      20.935358      4.2209262    
     36000   0.90443494     19.56403       4.6528276    
     37000   0.98502426     21.26493       4.4585359    
     38000   1.009701       20.192464      4.5745621    
     39000   1.1614984      20.600163      4.7272017    
     40000   1.0774086      19.283696      4.858877     
     41000   1.138498       19.758284      5.1365208    
     42000   0.98544434     19.736916      5.1444493    
     43000   0.90250947     19.844756      5.1691465    
     44000   1.1091199      19.868259      5.3724487    
     45000   0.9624585      19.030686      5.7066852    
     46000   1.0482021      21.255616      5.5354377    
     47000   1.0502218      19.966511      5.2508467    
     48000   1.0272538      20.849248      5.5145756    
     49000   0.99393609     19.711857      5.3428991    
     50000   1.0674024      20.196743      4.8859866    
     51000   0.93823169     19.137632      4.9435305    
     52000   1.0081607      18.537771      4.7373913    
     53000   1.0139317      19.797494      5.083774     
     54000   1.1056812      21.276399      4.9901027    
     55000   0.94337803     20.869548      4.401024     
     56000   0.96602701     22.435012      4.3597398    
     57000   0.99961374     20.412855      4.2076769    
     58000   1.0116659      19.99495       4.3089213    
     59000   0.99319866     19.772062      4.3222228    
     60000   1.0364574      21.689262      4.3543761    
     61000   1.0174125      20.565213      4.6094565    
     62000   0.99746913     22.52707       4.5823232    
     63000   0.85346077     21.167606      5.1096616    
     64000   0.95053276     20.938586      4.6608276    
     65000   1.0453369      19.747563      4.3468013    
     66000   1.0278426      19.968953      4.6059914    
     67000   1.0460056      21.52218       4.7587774    
     68000   0.97538718     21.22078       5.3102356    
     69000   0.91700297     19.720635      4.9863114    
     70000   1.0383207      20.292922      5.3450421    
     71000   0.96362888     20.166195      5.711185     
     72000   1.0401227      21.265529      5.8857707    
     73000   0.94431291     19.741556      6.0607423    
     74000   1.053599       20.763323      5.8859168    
     75000   1.0820044      20.311422      6.2789933    
     76000   1.0195633      21.347778      6.1309225    
     77000   0.90949156     18.823822      6.0106588    
     78000   1.0256312      19.289723      6.2720528    
     79000   1.0852479      22.088754      5.7446293    
     80000   0.87107118     19.260814      5.8887535    
     81000   0.95138604     20.13764       6.0403532    
     82000   0.99593881     19.812366      6.1503114    
     83000   0.82051762     21.126155      5.280713     
     84000   0.90060712     19.808397      5.1698238    
     85000   0.91476765     20.184558      4.2903627    
     86000   1.1645985      21.509831      4.5803247    
     87000   1.0143383      19.947374      4.369332     
     88000   0.92428576     20.731238      4.3683138    
     89000   1.1760159      20.341595      5.0234173    
     90000   1.0955352      21.124287      4.7431572    
     91000   0.89544671     18.903742      4.7558711    
     92000   0.90968527     20.829613      4.9102728    
     93000   0.85920053     21.912284      5.2624544    
     94000   1.0435467      20.16866       5.3824269    
     95000   0.8913319      19.664513      5.2081118    
     96000   1.132217       20.095934      5.1148337    
     97000   0.96857393     19.769621      5.0576453    
     98000   1.0128909      19.545778      5.892347     
     99000   0.98495067     21.88511       5.5820078    
    100000   0.92286999     20.211481      5.6207613    
Loop time of 412.999 on 2 procs for 100000 steps with 97 atoms

Performance: 209201.386 tau/day, 242.131 timesteps/s
100.6% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.33454    | 0.33454    | 0.33454    |   0.0 |  0.08
Bond    | 0.37384    | 0.37384    | 0.37384    |   0.0 |  0.09
Neigh   | 411.44     | 411.44     | 411.44     |   0.0 | 99.62
Comm    | 0.01701    | 0.01701    | 0.01701    |   0.0 |  0.00
Output  | 0.1399     | 0.1399     | 0.1399     |   0.0 |  0.03
Modify  | 0.64281    | 0.64281    | 0.64281    |   0.0 |  0.16
Other   |            | 0.05588    |            |       |  0.01

Nlocal:             97 ave          97 max          97 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           1229 ave        1229 max        1229 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 1229
Ave neighs/atom = 12.670103
Ave special neighs/atom = 1.9793814
Neighbor list builds = 957
Dangerous builds = 0

# Replace lj potential, now collapse
pair_style      lj/cut 3

# Cutoff simul when gyration under 10
# Variable created with equal requires v_ + 'name'
fix 3 all halt 1000 v_rog < 7

run 3000000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Per MPI rank memory allocation (min/avg/max) = 1861 | 1861 | 1861 Mbytes
   Step          Temp         Enthalpy         c_1      
    100000   0.92286999     19.067377      5.6207613    
Fix halt condition for fix-id 3 met on step 101000 with value 4.801078693628727 (src/fix_halt.cpp:237)
    101000   1.0524162      19.777481      4.8010787    
Loop time of 1.45202 on 2 procs for 1000 steps with 97 atoms

Performance: 595032.594 tau/day, 688.695 timesteps/s
102.1% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.0069323  | 0.0069323  | 0.0069323  |   0.0 |  0.48
Bond    | 0.0037138  | 0.0037138  | 0.0037138  |   0.0 |  0.26
Neigh   | 1.4323     | 1.4323     | 1.4323     |   0.0 | 98.64
Comm    | 0.0001521  | 0.0001521  | 0.0001521  |   0.0 |  0.01
Output  | 0.0012037  | 0.0012037  | 0.0012037  |   0.0 |  0.08
Modify  | 0.0071706  | 0.0071706  | 0.0071706  |   0.0 |  0.49
Other   |            | 0.0005345  |            |       |  0.04

Nlocal:             97 ave          97 max          97 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           2847 ave        2847 max        2847 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 2847
Ave neighs/atom = 29.350515
Ave special neighs/atom = 1.9793814
Neighbor list builds = 9
Dangerous builds = 0

# This simulation is done
# Move onto the next one
clear
  using 2 OpenMP thread(s) per MPI task
package omp 0
using multi-threaded neighbor list subroutines
next f
jump SELF

###
# Reference paper:
# K. Kremer and G. S. Grest
# Dynamics of entangled linear polymer melts: A molecular-dynamics simulation
# J Chem Phys 92, 5057 (1990)

##################################
# MIHIR: for branched polymers
# LJ minimum first to expand and explore, then collapse
###

###
# Looping through the various nuc5branch4 polymers to simulate,
# define variables to switch through
variable f index bb37nuc5bl6bn4d30tot100 bb75nuc5bl12bn4d30tot200 bb112nuc5bl18bn4d30tot300 bb150nuc5bl25bn4d30tot400 bb187nuc5bl31bn4d30tot500 bb225nuc5bl37bn4d30tot600 bb262nuc5bl43bn4d30tot700 bb300nuc5bl50bn4d30tot800 bb337nuc5bl56bn4d30tot900 bb375nuc5bl62bn4d30tot1000 bb412nuc5bl68bn4d30tot1100 bb450nuc5bl75bn4d30tot1200
# variable f index bb75nuc5bl12bn4d30tot200
# variable f index bb337nuc5bl56bn4d30tot900
###


###
# Box and units  (use LJ units and periodic boundaries)
###

units lj
log nuc5branch4/logs3/$f.log
log nuc5branch4/logs3/bb75nuc5bl12bn4d30tot200.log

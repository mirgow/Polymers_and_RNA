#atom_style bond #no stiffness
atom_style angle #with stiffness

boundary        p p p
###
# Pair interactions require lists of neighbours to be calculated
###

#neighbor 0.3 bin
neighbor 4 bin

neigh_modify every 1 delay 1 check yes
atom_modify sort 0 0
### Generate RESTART file, SPECIAL format, not a .txt file ###
### Useful if simulation crashes ###

restart 1000000 tshaped/restarts2/$f.restart
restart 1000000 tshaped/restarts2/bb200nuc1bl100bn3d30tot300.restart
#############################



### READ "start" data file ###

read_data tshaped/$f.dat
read_data tshaped/bb200nuc1bl100bn3d30tot300.dat
Reading data file ...
  orthogonal box = (-1000 -1000 -1000) to (1000 1000 1000)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  301 atoms
  scanning bonds ...
  2 = max bonds/atom
  scanning angles ...
  3 = max angles/atom
  reading bonds ...
  300 bonds
  reading angles ...
  300 angles
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        0        0       
  special bond factors coul:  0        0        0       
     3 = max # of 1-2 neighbors
     3 = max # of 1-3 neighbors
     6 = max # of 1-4 neighbors
     9 = max # of special neighbors
  special bonds CPU = 0.001 seconds
  read_data CPU = 0.039 seconds

######################

### READ "REstart" data file ###

######################



###
# Define groups (atom type 1 is group 'all')
###
group all type 1
301 atoms in group all


###
# Dump configs - "simple dumpings"
###

###
# Dump configs + box coords
###

dump   1   all   custom   1000  tshaped/trjs2/$f.lammpstrj  id  x y z  ix iy iz
dump   1   all   custom   1000  tshaped/trjs2/bb200nuc1bl100bn3d30tot300.lammpstrj  id  x y z  ix iy iz
dump_modify   1   format line "%d %.5f %.5f %.5f %d %d %d"

########################################################################


###################################################################
# Stiffness term
#
# E = K * (1+cos(theta)), K>0
#
angle_style   cosine
#change this coefficient to change stiffness (e.g. 1,5,10)
angle_coeff   1 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  Lennard-Jones 12-6 potential with cutoff:
#  potential E=4epsilon[ (sigma/r)^12 - (sigma/r)^6]  for r<r_cut
#
#  1.12246 = 2^(1/6) is the minimum of the potential


pair_style      lj/cut 1.12246152962189
#pair_style      lj/cut 3

#
#  pair_modify shift yes adds a constant to the potential such

#  that E(r_cut)=0. Forces remains unchanged.
#

pair_modify     shift yes

#
#  pair_coeff for lj/cut, specify 4:
#    * atom type interacting with
#    * atom type
#    * epsilon (energy units)
#    * sigma (distance units)
#

pair_coeff      1 1 1.0 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  soft potential, for PUSHING apart overlapping atoms
#  potential E=A*(1 + cos(pi*r/r_c))
#
#  1.12246 = 2^(1/6) is the cut-off r_c

#pair_style     soft 1.12246152962189

#
#  pair_coeff for soft, specify 3:
#    * atom type interacting with
#    * atom type
#    * A
#
#

#pair_coeff      1 1 100.0
###################################################################

###################################################################
# Pair interaction between bonded atoms
#
# Fene potential + Lennard Jones 12-6:

#
#  E= - 0.5 K R0^2 ln[ 1- (r/R0)^2]
#     + 4epsilon[ (sigma/r)^12 - (sigma/r)^6] + epsilon
#

bond_style   fene


#
# For style fene, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#   * epsilon (energy)  (LJ component)
#   * sigma (distance)  (LJ component)
#


special_bonds fene #<=== I M P O R T A N T (new command)
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        1        1       
  special bond factors coul:  0        1        1       
     3 = max # of 1-2 neighbors
     9 = max # of special neighbors
  special bonds CPU = 0.000 seconds

bond_coeff   1   30   2   1.0   1.0


###################################################

###################################################################
# Pair interaction between bonded atoms
#
# Harmonic potential:
#
#  E= K * (R-R0)^2
#

#bond_style   harmonic

#
# For style harmonic, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#

#bond_coeff   1   60.0   1.0
#bond_coeff   2   harmonic 0.1   1.0

###################################################
compute 1 all gyration
variable rog equal c_1
#compute 2 all coord/atom cutoff 1.1

#dump 2 all custom 10000 contact_number.dump id c_2


###
# Set up fixes
###
thermo_style   custom   step  temp enthalpy c_1
fix 1 all nve   ###NVE ensemble

fix 2 all   langevin   1.0 1.0 1.0  778655   ###Langevin integrator Tstart Tstop 1/friction rndseed


##### Sample thermodynamic info  (temperature, energy, pressure, etc.) #####
thermo 1000









############################################################################

###
# set timestep of integrator

timestep 0.01

###
# run integration for a number of steps
###
#run 0
#variable r equal c_1
#if "$r < 63.1" then "quit 1"

# lj potential minimum, cause molecule to explore
run 100000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Neighbor list info ...
  update: every = 1 steps, delay = 1 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 5.1224615
  ghost atom cutoff = 5.1224615
  binsize = 2.5612308, bins = 781 781 781
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut/omp, perpetual
      attributes: half, newton on, omp
      pair build: half/bin/newton/omp
      stencil: half/bin/3d
      bin: standard
WARNING: Communication cutoff 5.12246152962189 is shorter than a bond length based estimate of 5.455. This may lead to errors. (src/comm.cpp:723)
Per MPI rank memory allocation (min/avg/max) = 1860 | 1860 | 1860 Mbytes
   Step          Temp         Enthalpy         c_1      
         0   0              13.298621      51.16131     
      1000   1.0144334      18.72128       50.192353    
      2000   0.97274495     19.360163      49.092731    
      3000   1.0615314      19.417354      48.505628    
      4000   1.047112       19.735023      47.67922     
      5000   0.96837969     20.054341      46.706523    
      6000   1.0471607      19.488365      46.391864    
      7000   1.0283913      19.556738      46.061256    
      8000   1.014542       19.311904      45.75385     
      9000   0.93780711     19.586764      44.935432    
     10000   0.98757684     19.39199       45.062632    
     11000   1.0052675      19.470142      44.878435    
     12000   1.0538204      20.316998      44.53563     
     13000   0.96791968     20.466193      43.869483    
     14000   0.96734418     19.960572      43.425476    
     15000   1.0075509      20.113416      42.762309    
     16000   0.97822576     19.248678      43.026983    
     17000   1.0082556      19.851392      42.307776    
     18000   1.0053964      20.378667      41.772454    
     19000   1.027613       20.489611      41.05548     
     20000   0.992203       19.964647      40.719492    
     21000   0.94426032     18.751262      40.531952    
     22000   1.0135791      20.40497       39.854985    
     23000   0.97871742     20.269357      39.477479    
     24000   0.96114908     21.085887      39.038607    
     25000   0.98685054     20.497943      38.685985    
     26000   0.99280354     20.43772       38.227012    
     27000   1.0942819      19.606734      38.0074      
     28000   1.067095       20.460926      37.663218    
     29000   1.1605877      20.379531      37.786809    
     30000   1.000035       20.067919      37.7574      
     31000   0.99156769     20.169837      37.85926     
     32000   0.94724412     20.113263      37.952194    
     33000   0.99494226     20.028455      37.290801    
     34000   0.99698637     19.410528      37.179129    
     35000   0.94611035     20.586376      37.093577    
     36000   0.95823342     20.462145      36.754971    
     37000   1.0317257      20.635743      36.875147    
     38000   0.96355035     20.579109      36.527094    
     39000   0.97736912     20.2637        36.401284    
     40000   0.95468909     19.919306      36.342239    
     41000   1.0184628      20.613907      36.02742     
     42000   1.0334905      21.22359       35.841027    
     43000   1.0345799      21.184272      35.68178     
     44000   0.93190915     19.840989      35.525558    
     45000   1.0072119      21.526678      35.260642    
     46000   1.0384055      21.624128      34.85542     
     47000   1.0396294      20.637029      34.743587    
     48000   0.92360223     20.63938       34.784199    
     49000   0.95908624     20.164385      34.91724     
     50000   0.95465869     19.351012      34.70111     
     51000   0.97077126     19.490838      34.784226    
     52000   1.0083747      20.238994      34.023177    
     53000   1.0318596      21.141454      33.95492     
     54000   1.0166652      20.999796      33.968344    
     55000   1.0022395      20.363222      33.728408    
     56000   1.0188133      19.964822      33.533439    
     57000   1.0527727      20.26801       33.679892    
     58000   1.0275181      20.667254      33.522247    
     59000   0.95163507     19.999733      33.001266    
     60000   0.97569149     20.317516      32.901835    
     61000   0.95190458     20.103514      32.337734    
     62000   0.98198141     21.508949      32.652697    
     63000   1.04725        20.386001      32.855262    
     64000   1.1182584      21.237749      33.19122     
     65000   1.0369508      20.706265      32.889867    
     66000   1.0176804      20.388561      33.111418    
     67000   0.93725306     19.768758      32.75091     
     68000   0.97333051     19.346875      32.358112    
     69000   0.99868598     20.518435      31.833284    
     70000   0.93784809     20.161692      31.85983     
     71000   1.0185878      20.059869      32.031498    
     72000   1.0555914      21.019764      31.695236    
     73000   0.957076       20.325484      31.135741    
     74000   1.0730033      20.368945      31.059577    
     75000   0.96255404     20.013406      30.724984    
     76000   0.96768577     19.815209      30.715018    
     77000   1.0529366      20.238373      30.679911    
     78000   1.0377733      20.394975      30.691287    
     79000   1.0192188      20.588799      30.879118    
     80000   1.0403472      20.344702      30.486399    
     81000   1.0557568      19.689289      30.128305    
     82000   0.97874045     19.476002      30.055632    
     83000   1.0351337      20.085817      30.391559    
     84000   0.99510122     20.199826      30.543051    
     85000   1.032655       20.930653      30.548183    
     86000   0.98502125     20.161464      30.497923    
     87000   1.0304293      20.738295      30.150853    
     88000   1.0644911      20.949746      29.5259      
     89000   0.9716612      20.075646      29.546378    
     90000   0.96619605     19.940351      29.489734    
     91000   1.0566112      21.002616      29.644316    
     92000   1.0968771      21.007906      29.164545    
     93000   0.9876334      20.389426      28.891806    
     94000   1.0382093      20.354004      28.453098    
     95000   0.96475844     21.198102      28.528598    
     96000   0.95123973     19.352257      28.668176    
     97000   0.98973735     20.177186      28.483884    
     98000   1.0038773      20.691689      28.320656    
     99000   1.0455172      20.315516      28.354756    
    100000   0.9348743      19.518271      28.200225    
Loop time of 623.741 on 2 procs for 100000 steps with 301 atoms

Performance: 138519.042 tau/day, 160.323 timesteps/s
100.8% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.52208    | 0.52208    | 0.52208    |   0.0 |  0.08
Bond    | 0.96617    | 0.96617    | 0.96617    |   0.0 |  0.15
Neigh   | 620.09     | 620.09     | 620.09     |   0.0 | 99.41
Comm    | 0.028921   | 0.028921   | 0.028921   |   0.0 |  0.00
Output  | 0.1931     | 0.1931     | 0.1931     |   0.0 |  0.03
Modify  | 1.7612     | 1.7612     | 1.7612     |   0.0 |  0.28
Other   |            | 0.1843     |            |       |  0.03

Nlocal:            301 ave         301 max         301 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           2376 ave        2376 max        2376 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 2376
Ave neighs/atom = 7.8936877
Ave special neighs/atom = 1.9933555
Neighbor list builds = 1018
Dangerous builds = 0

# Replace lj potential, now collapse
pair_style      lj/cut 3

# Cutoff simul when gyration under 5
# Variable created with equal requires v_ + 'name'
fix 3 all halt 1000 v_rog < 7

run 5000000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Per MPI rank memory allocation (min/avg/max) = 1860 | 1860 | 1860 Mbytes
   Step          Temp         Enthalpy         c_1      
    100000   0.9348743      18.701879      28.200225    
    101000   0.9523679      19.154289      27.508384    
    102000   0.97291385     19.400836      27.209413    
    103000   1.0266777      19.62382       26.49245     
    104000   1.0443109      19.794947      26.357847    
    105000   0.97737128     19.677125      25.876114    
    106000   1.0446391      19.603424      25.728892    
    107000   0.97302179     19.006461      25.312368    
    108000   1.0123113      19.45657       25.1025      
    109000   0.93965161     19.428692      24.77797     
    110000   1.0125629      19.855159      24.62576     
    111000   0.99568594     18.584252      24.389417    
    112000   1.03288        18.777992      24.068719    
    113000   0.97466975     19.807511      23.940021    
    114000   1.0437543      19.261625      23.327898    
    115000   1.0015529      18.070212      22.65757     
    116000   1.0425181      18.674218      22.297365    
    117000   0.9325624      18.229229      22.151905    
    118000   1.0199978      18.534299      21.899165    
    119000   1.0201248      19.253102      22.022761    
    120000   0.90799175     19.617         21.837134    
    121000   1.0685254      19.361663      21.068039    
    122000   0.95596276     18.839948      21.365905    
    123000   0.95850153     18.436079      20.746535    
    124000   1.0022074      18.216185      20.166412    
    125000   0.97003207     17.668254      20.102126    
    126000   1.0342541      18.549876      19.859401    
    127000   0.98603556     19.06381       19.743238    
    128000   0.99947766     17.664685      19.552188    
    129000   1.0396317      19.120106      19.387411    
    130000   0.9516893      19.413163      19.168325    
    131000   0.95066836     18.377882      18.843842    
    132000   1.0281569      18.584245      18.602836    
    133000   0.95925376     18.296293      18.548967    
    134000   0.95218908     18.328874      18.41976     
    135000   1.0294413      18.611408      17.240723    
    136000   0.99657645     18.423293      17.264899    
    137000   0.97733716     18.820444      16.950928    
    138000   1.0223012      18.478441      16.997358    
    139000   1.0754359      19.452801      16.734118    
    140000   0.94892645     18.27592       16.685761    
    141000   1.0430267      18.519665      16.339233    
    142000   1.0118963      19.23912       16.179094    
    143000   1.1008929      17.784109      15.861       
    144000   1.043307       18.804223      15.357151    
    145000   1.015073       17.443628      14.830868    
    146000   1.02609        18.614246      14.352479    
    147000   1.0199997      18.020851      14.36843     
    148000   1.053091       18.007315      14.262745    
    149000   0.97344254     18.213058      14.150089    
    150000   1.0298413      18.105834      13.982333    
    151000   0.86192979     17.657738      13.680464    
    152000   0.94844916     17.420198      13.364787    
    153000   0.9694435      18.336294      12.932798    
    154000   0.99419033     18.27779       12.478577    
    155000   0.99928189     18.09251       12.368762    
    156000   0.95899329     19.157773      12.071602    
    157000   0.98240531     18.732551      11.671854    
    158000   0.94316466     18.437617      11.449211    
    159000   1.0273627      18.300119      11.19088     
    160000   0.88922139     18.204013      11.207391    
    161000   1.0029223      18.034087      10.887455    
    162000   0.96957191     18.023081      10.479835    
    163000   0.96087223     17.802648      10.434139    
    164000   0.98287716     17.343906      10.079239    
    165000   0.96758809     18.207719      9.7901696    
    166000   0.95694826     18.480451      10.024362    
    167000   1.0409076      17.929446      9.6195778    
    168000   0.98111734     18.444286      9.2883223    
    169000   1.0294404      17.364266      9.1847508    
    170000   0.99638084     17.59215       8.5974044    
    171000   0.98297916     18.525808      8.2916153    
    172000   1.0131657      18.22222       7.3079886    
Fix halt condition for fix-id 3 met on step 173000 with value 6.841277597022576 (src/fix_halt.cpp:237)
    173000   0.9873636      16.99697       6.8412776    
Loop time of 148.397 on 2 procs for 73000 steps with 301 atoms

Performance: 425021.312 tau/day, 491.923 timesteps/s
104.0% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 2.9588     | 2.9588     | 2.9588     |   0.0 |  1.99
Bond    | 0.70431    | 0.70431    | 0.70431    |   0.0 |  0.47
Neigh   | 143.16     | 143.16     | 143.16     |   0.0 | 96.47
Comm    | 0.019697   | 0.019697   | 0.019697   |   0.0 |  0.01
Output  | 0.13883    | 0.13883    | 0.13883    |   0.0 |  0.09
Modify  | 1.2847     | 1.2847     | 1.2847     |   0.0 |  0.87
Other   |            | 0.1323     |            |       |  0.09

Nlocal:            301 ave         301 max         301 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:          22853 ave       22853 max       22853 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 22853
Ave neighs/atom = 75.923588
Ave special neighs/atom = 1.9933555
Neighbor list builds = 615
Dangerous builds = 0

# This simulation is done
# Move onto the next one
clear
  using 2 OpenMP thread(s) per MPI task
package omp 0
using multi-threaded neighbor list subroutines
next f
jump SELF

###
# Reference paper:
# K. Kremer and G. S. Grest
# Dynamics of entangled linear polymer melts: A molecular-dynamics simulation
# J Chem Phys 92, 5057 (1990)

##################################
# MIHIR: for branched polymers
# LJ minimum first to expand and explore, then collapse
###

###
# Looping through the various tshaped polymers to simulate,
# define variables to switch through
variable f index bb66nuc1bl33bn3d30tot100 bb133nuc1bl66bn3d30tot200 bb200nuc1bl100bn3d30tot300 bb266nuc1bl133bn3d30tot400 bb333nuc1bl166bn3d30tot500 bb400nuc1bl200bn3d30tot600 bb466nuc1bl233bn3d30tot700 bb533nuc1bl266bn3d30tot800 bb600nuc1bl300bn3d30tot900 bb666nuc1bl333bn3d30tot1000 bb733nuc1bl366bn3d30tot1100 bb800nuc1bl400bn3d30tot1200
###


###
# Box and units  (use LJ units and periodic boundaries)
###

units lj
log tshaped/logs2/$f.log
log tshaped/logs2/bb266nuc1bl133bn3d30tot400.log

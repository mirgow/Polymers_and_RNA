#atom_style bond #no stiffness
atom_style angle #with stiffness

boundary        p p p
###
# Pair interactions require lists of neighbours to be calculated
###

#neighbor 0.3 bin
neighbor 4 bin

neigh_modify every 1 delay 1 check yes
atom_modify sort 0 0
### Generate RESTART file, SPECIAL format, not a .txt file ###
### Useful if simulation crashes ###

restart 1000000 nuc5branch4/restarts2/$f.restart
restart 1000000 nuc5branch4/restarts2/bb75nuc5bl12bn4d30tot200.restart
#############################



### READ "start" data file ###

read_data nuc5branch4/$f.dat
read_data nuc5branch4/bb75nuc5bl12bn4d30tot200.dat
Reading data file ...
  orthogonal box = (-1000 -1000 -1000) to (1000 1000 1000)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  193 atoms
  scanning bonds ...
  3 = max bonds/atom
  scanning angles ...
  6 = max angles/atom
  reading bonds ...
  192 bonds
  reading angles ...
  206 angles
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        0        0       
  special bond factors coul:  0        0        0       
     4 = max # of 1-2 neighbors
     4 = max # of 1-3 neighbors
     8 = max # of 1-4 neighbors
    12 = max # of special neighbors
  special bonds CPU = 0.002 seconds
  read_data CPU = 0.028 seconds

######################

### READ "REstart" data file ###

######################



###
# Define groups (atom type 1 is group 'all')
###
group all type 1
193 atoms in group all


###
# Dump configs - "simple dumpings"
###

###
# Dump configs + box coords
###

dump   1   all   custom   1000  nuc5branch4/trjs2/$f.lammpstrj  id  x y z  ix iy iz
dump   1   all   custom   1000  nuc5branch4/trjs2/bb75nuc5bl12bn4d30tot200.lammpstrj  id  x y z  ix iy iz
dump_modify   1   format line "%d %.5f %.5f %.5f %d %d %d"

########################################################################


###################################################################
# Stiffness term
#
# E = K * (1+cos(theta)), K>0
#
angle_style   cosine
#change this coefficient to change stiffness (e.g. 1,5,10)
angle_coeff   1 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  Lennard-Jones 12-6 potential with cutoff:
#  potential E=4epsilon[ (sigma/r)^12 - (sigma/r)^6]  for r<r_cut
#
#  1.12246 = 2^(1/6) is the minimum of the potential


pair_style      lj/cut 1.12246152962189
#pair_style      lj/cut 3

#
#  pair_modify shift yes adds a constant to the potential such

#  that E(r_cut)=0. Forces remains unchanged.
#

pair_modify     shift yes

#
#  pair_coeff for lj/cut, specify 4:
#    * atom type interacting with
#    * atom type
#    * epsilon (energy units)
#    * sigma (distance units)
#

pair_coeff      1 1 1.0 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  soft potential, for PUSHING apart overlapping atoms
#  potential E=A*(1 + cos(pi*r/r_c))
#
#  1.12246 = 2^(1/6) is the cut-off r_c

#pair_style     soft 1.12246152962189

#
#  pair_coeff for soft, specify 3:
#    * atom type interacting with
#    * atom type
#    * A
#
#

#pair_coeff      1 1 100.0
###################################################################

###################################################################
# Pair interaction between bonded atoms
#
# Fene potential + Lennard Jones 12-6:

#
#  E= - 0.5 K R0^2 ln[ 1- (r/R0)^2]
#     + 4epsilon[ (sigma/r)^12 - (sigma/r)^6] + epsilon
#

bond_style   fene


#
# For style fene, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#   * epsilon (energy)  (LJ component)
#   * sigma (distance)  (LJ component)
#


special_bonds fene #<=== I M P O R T A N T (new command)
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        1        1       
  special bond factors coul:  0        1        1       
     4 = max # of 1-2 neighbors
    12 = max # of special neighbors
  special bonds CPU = 0.000 seconds

bond_coeff   1   30   2   1.0   1.0


###################################################

###################################################################
# Pair interaction between bonded atoms
#
# Harmonic potential:
#
#  E= K * (R-R0)^2
#

#bond_style   harmonic

#
# For style harmonic, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#

#bond_coeff   1   60.0   1.0
#bond_coeff   2   harmonic 0.1   1.0

###################################################
compute 1 all gyration
variable rog equal c_1
#compute 2 all coord/atom cutoff 1.1

#dump 2 all custom 10000 contact_number.dump id c_2


###
# Set up fixes
###
thermo_style   custom   step  temp enthalpy c_1
fix 1 all nve   ###NVE ensemble

fix 2 all   langevin   1.0 1.0 1.0  778655   ###Langevin integrator Tstart Tstop 1/friction rndseed


##### Sample thermodynamic info  (temperature, energy, pressure, etc.) #####
thermo 1000









############################################################################

###
# set timestep of integrator

timestep 0.01

###
# run integration for a number of steps
###
#run 0
#variable r equal c_1
#if "$r < 63.1" then "quit 1"

# lj potential minimum, cause molecule to explore
run 100000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Neighbor list info ...
  update: every = 1 steps, delay = 1 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 5.1224615
  ghost atom cutoff = 5.1224615
  binsize = 2.5612308, bins = 781 781 781
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut/omp, perpetual
      attributes: half, newton on, omp
      pair build: half/bin/newton/omp
      stencil: half/bin/3d
      bin: standard
WARNING: Communication cutoff 5.12246152962189 is shorter than a bond length based estimate of 5.455. This may lead to errors. (src/comm.cpp:723)
Per MPI rank memory allocation (min/avg/max) = 1861 | 1861 | 1861 Mbytes
   Step          Temp         Enthalpy         c_1      
         0   0              13.249102      12.724259    
      1000   0.98155926     20.41534       11.011857    
      2000   1.1097898      20.937523      10.211871    
      3000   0.97736205     20.262187      9.6649402    
      4000   0.99866851     19.470843      8.9430391    
      5000   1.0799052      20.383624      9.080389     
      6000   0.95699475     20.705518      8.7745176    
      7000   0.96323167     20.675276      8.4154763    
      8000   0.95992219     20.219447      8.5029796    
      9000   1.0916881      21.208625      8.296196     
     10000   0.97969416     19.919354      8.2208219    
     11000   1.0267178      19.463002      7.8837932    
     12000   1.0470173      21.593171      7.7001711    
     13000   1.0665303      20.537079      8.0924043    
     14000   0.92922578     20.251465      7.8163625    
     15000   1.0041837      20.83596       7.4813085    
     16000   1.066888       20.136447      7.5474221    
     17000   1.0994093      21.425985      7.4889727    
     18000   0.84327722     19.463379      7.7454999    
     19000   0.99099745     20.27764       8.0005766    
     20000   0.9206518      20.744781      7.9825925    
     21000   1.005416       20.360622      8.0295116    
     22000   1.1017282      20.02579       7.8403667    
     23000   0.92400327     20.348992      8.1701682    
     24000   1.0018145      20.284622      7.840406     
     25000   1.0138024      20.585183      7.6997593    
     26000   0.98369351     20.740922      7.6714618    
     27000   0.9437732      20.353885      7.1942373    
     28000   1.1407811      19.919753      7.0175198    
     29000   1.0109834      19.4766        7.0999821    
     30000   0.9888205      19.924772      7.5190679    
     31000   0.97927725     20.069636      7.9200907    
     32000   0.99058319     21.21223       7.6648114    
     33000   1.0511033      20.631138      7.7357136    
     34000   1.0861606      20.833201      7.7932353    
     35000   0.99549116     19.685588      7.5142523    
     36000   0.91600159     20.069732      7.3996683    
     37000   1.0886928      21.318574      7.3328348    
     38000   0.9449053      21.738967      7.6932959    
     39000   1.0037117      21.071554      7.5037103    
     40000   1.103033       20.882884      7.9555778    
     41000   0.88962902     19.663743      7.6206434    
     42000   1.0181694      20.143737      7.1318545    
     43000   0.93117491     21.177202      6.8712556    
     44000   1.078729       20.722706      6.9934687    
     45000   0.95190595     20.999937      6.4520576    
     46000   1.0789842      20.949547      6.7681807    
     47000   1.0256879      21.428214      6.7044708    
     48000   0.95713941     20.441666      6.7075511    
     49000   0.98152569     20.051009      6.7857567    
     50000   1.0295359      20.401885      6.8687533    
     51000   1.0133723      19.390406      7.1639988    
     52000   0.98344133     20.621772      7.1174709    
     53000   1.0432872      20.564849      7.3512994    
     54000   1.0923508      20.093262      7.5662815    
     55000   0.97376801     20.717764      7.3990458    
     56000   1.0083078      20.06814       7.2044719    
     57000   0.92281051     20.677221      7.4337692    
     58000   1.0266841      19.360431      7.5479615    
     59000   1.0783446      20.410385      7.4667188    
     60000   1.023136       19.685891      7.3138462    
     61000   1.0307881      19.235089      7.4833529    
     62000   0.8859804      20.672011      7.4296922    
     63000   1.0535343      20.626475      7.6757865    
     64000   0.96534316     20.192999      7.4361875    
     65000   1.0093724      20.606618      7.0003306    
     66000   1.0777415      21.078146      6.8894442    
     67000   0.99915897     20.713148      6.8763187    
     68000   1.0200357      21.019526      6.9671132    
     69000   1.0430976      21.351475      7.0333889    
     70000   1.0840351      20.495006      7.0345917    
     71000   0.99705606     20.95808       7.1891395    
     72000   1.0496228      20.466708      7.3095884    
     73000   1.006701       19.29543       7.2533884    
     74000   1.0037873      20.308026      7.1767188    
     75000   0.91356992     20.316857      6.7819552    
     76000   1.0765573      20.637157      6.8724744    
     77000   1.0246507      19.826547      6.4105413    
     78000   1.040457       20.484496      6.4576386    
     79000   0.94197575     21.049515      6.4312623    
     80000   1.0647262      21.74911       6.8100527    
     81000   1.0130592      20.775449      7.0278244    
     82000   0.97845545     20.317715      7.1553101    
     83000   0.99860497     20.727429      6.6090008    
     84000   1.0717394      19.956418      6.8934782    
     85000   0.99911136     19.190432      7.000517     
     86000   0.91600381     20.078675      6.923749     
     87000   1.0216437      19.368586      7.1827205    
     88000   0.96602825     19.761913      7.0586842    
     89000   0.95626264     21.238177      6.7845133    
     90000   0.90750534     21.328506      7.0202431    
     91000   0.90900012     19.623165      7.389029     
     92000   0.99222301     20.312807      6.7241556    
     93000   0.99413426     20.201733      6.6741511    
     94000   1.0802653      21.375506      7.1712895    
     95000   0.97833562     20.573884      7.5355169    
     96000   1.0433881      20.739084      7.0573766    
     97000   1.0238312      20.834034      7.1660896    
     98000   1.0675223      20.793058      7.3460993    
     99000   0.94368988     20.598383      7.3500756    
    100000   0.99955404     19.998426      7.3197883    
Loop time of 408.742 on 2 procs for 100000 steps with 193 atoms

Performance: 211380.238 tau/day, 244.653 timesteps/s
100.9% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.61244    | 0.61244    | 0.61244    |   0.0 |  0.15
Bond    | 0.59341    | 0.59341    | 0.59341    |   0.0 |  0.15
Neigh   | 406.19     | 406.19     | 406.19     |   0.0 | 99.38
Comm    | 0.018996   | 0.018996   | 0.018996   |   0.0 |  0.00
Output  | 0.1231     | 0.1231     | 0.1231     |   0.0 |  0.03
Modify  | 1.1116     | 1.1116     | 1.1116     |   0.0 |  0.27
Other   |            | 0.08895    |            |       |  0.02

Nlocal:            193 ave         193 max         193 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           3041 ave        3041 max        3041 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 3041
Ave neighs/atom = 15.756477
Ave special neighs/atom = 1.9896373
Neighbor list builds = 1031
Dangerous builds = 0

# Replace lj potential, now collapse
pair_style      lj/cut 3

# Cutoff simul when gyration under 10
# Variable created with equal requires v_ + 'name'
fix 3 all halt 1000 v_rog < 7

run 3000000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Per MPI rank memory allocation (min/avg/max) = 1861 | 1861 | 1861 Mbytes
   Step          Temp         Enthalpy         c_1      
    100000   0.99955404     18.841821      7.3197883    
Fix halt condition for fix-id 3 met on step 101000 with value 6.963670313521332 (src/fix_halt.cpp:237)
    101000   1.0106072      17.796124      6.9636703    
Loop time of 1.71324 on 2 procs for 1000 steps with 193 atoms

Performance: 504306.215 tau/day, 583.688 timesteps/s
103.3% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.023762   | 0.023762   | 0.023762   |   0.0 |  1.39
Bond    | 0.0073224  | 0.0073224  | 0.0073224  |   0.0 |  0.43
Neigh   | 1.6659     | 1.6659     | 1.6659     |   0.0 | 97.24
Comm    | 0.0002605  | 0.0002605  | 0.0002605  |   0.0 |  0.02
Output  | 0.0009524  | 0.0009524  | 0.0009524  |   0.0 |  0.06
Modify  | 0.013913   | 0.013913   | 0.013913   |   0.0 |  0.81
Other   |            | 0.001105   |            |       |  0.06

Nlocal:            193 ave         193 max         193 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           6804 ave        6804 max        6804 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 6804
Ave neighs/atom = 35.253886
Ave special neighs/atom = 1.9896373
Neighbor list builds = 9
Dangerous builds = 0

# This simulation is done
# Move onto the next one
clear
  using 2 OpenMP thread(s) per MPI task
package omp 0
using multi-threaded neighbor list subroutines
next f
jump SELF

###
# Reference paper:
# K. Kremer and G. S. Grest
# Dynamics of entangled linear polymer melts: A molecular-dynamics simulation
# J Chem Phys 92, 5057 (1990)

##################################
# MIHIR: for branched polymers
# LJ minimum first to expand and explore, then collapse
###

###
# Looping through the various nuc5branch4 polymers to simulate,
# define variables to switch through
variable f index bb37nuc5bl6bn4d30tot100 bb75nuc5bl12bn4d30tot200 bb112nuc5bl18bn4d30tot300 bb150nuc5bl25bn4d30tot400 bb187nuc5bl31bn4d30tot500 bb225nuc5bl37bn4d30tot600 bb262nuc5bl43bn4d30tot700 bb300nuc5bl50bn4d30tot800 bb337nuc5bl56bn4d30tot900 bb375nuc5bl62bn4d30tot1000 bb412nuc5bl68bn4d30tot1100 bb450nuc5bl75bn4d30tot1200
# variable f index bb75nuc5bl12bn4d30tot200
# variable f index bb337nuc5bl56bn4d30tot900
###


###
# Box and units  (use LJ units and periodic boundaries)
###

units lj
log nuc5branch4/logs2/$f.log
log nuc5branch4/logs2/bb112nuc5bl18bn4d30tot300.log

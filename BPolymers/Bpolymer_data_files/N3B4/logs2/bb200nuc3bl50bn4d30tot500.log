#atom_style bond #no stiffness
atom_style angle #with stiffness

boundary        p p p
###
# Pair interactions require lists of neighbours to be calculated
###

#neighbor 0.3 bin
neighbor 4 bin

neigh_modify every 1 delay 1 check yes
atom_modify sort 0 0
### Generate RESTART file, SPECIAL format, not a .txt file ###
### Useful if simulation crashes ###

restart 1000000 nuc3branch4/restarts2/$f.restart
restart 1000000 nuc3branch4/restarts2/bb200nuc3bl50bn4d30tot500.restart
#############################



### READ "start" data file ###

read_data nuc3branch4/$f.dat
read_data nuc3branch4/bb200nuc3bl50bn4d30tot500.dat
Reading data file ...
  orthogonal box = (-1000 -1000 -1000) to (1000 1000 1000)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  501 atoms
  scanning bonds ...
  3 = max bonds/atom
  scanning angles ...
  6 = max angles/atom
  reading bonds ...
  500 bonds
  reading angles ...
  508 angles
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        0        0       
  special bond factors coul:  0        0        0       
     4 = max # of 1-2 neighbors
     4 = max # of 1-3 neighbors
     8 = max # of 1-4 neighbors
    12 = max # of special neighbors
  special bonds CPU = 0.000 seconds
  read_data CPU = 0.042 seconds

######################

### READ "REstart" data file ###

######################



###
# Define groups (atom type 1 is group 'all')
###
group all type 1
501 atoms in group all


###
# Dump configs - "simple dumpings"
###

###
# Dump configs + box coords
###

dump   1   all   custom   1000  nuc3branch4/trjs2/$f.lammpstrj  id  x y z  ix iy iz
dump   1   all   custom   1000  nuc3branch4/trjs2/bb200nuc3bl50bn4d30tot500.lammpstrj  id  x y z  ix iy iz
dump_modify   1   format line "%d %.5f %.5f %.5f %d %d %d"

########################################################################


###################################################################
# Stiffness term
#
# E = K * (1+cos(theta)), K>0
#
angle_style   cosine
#change this coefficient to change stiffness (e.g. 1,5,10)
angle_coeff   1 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  Lennard-Jones 12-6 potential with cutoff:
#  potential E=4epsilon[ (sigma/r)^12 - (sigma/r)^6]  for r<r_cut
#
#  1.12246 = 2^(1/6) is the minimum of the potential


pair_style      lj/cut 1.12246152962189
#pair_style      lj/cut 3

#
#  pair_modify shift yes adds a constant to the potential such

#  that E(r_cut)=0. Forces remains unchanged.
#

pair_modify     shift yes

#
#  pair_coeff for lj/cut, specify 4:
#    * atom type interacting with
#    * atom type
#    * epsilon (energy units)
#    * sigma (distance units)
#

pair_coeff      1 1 1.0 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  soft potential, for PUSHING apart overlapping atoms
#  potential E=A*(1 + cos(pi*r/r_c))
#
#  1.12246 = 2^(1/6) is the cut-off r_c

#pair_style     soft 1.12246152962189

#
#  pair_coeff for soft, specify 3:
#    * atom type interacting with
#    * atom type
#    * A
#
#

#pair_coeff      1 1 100.0
###################################################################

###################################################################
# Pair interaction between bonded atoms
#
# Fene potential + Lennard Jones 12-6:

#
#  E= - 0.5 K R0^2 ln[ 1- (r/R0)^2]
#     + 4epsilon[ (sigma/r)^12 - (sigma/r)^6] + epsilon
#

bond_style   fene


#
# For style fene, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#   * epsilon (energy)  (LJ component)
#   * sigma (distance)  (LJ component)
#


special_bonds fene #<=== I M P O R T A N T (new command)
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        1        1       
  special bond factors coul:  0        1        1       
     4 = max # of 1-2 neighbors
    12 = max # of special neighbors
  special bonds CPU = 0.000 seconds

bond_coeff   1   30   2   1.0   1.0


###################################################

###################################################################
# Pair interaction between bonded atoms
#
# Harmonic potential:
#
#  E= K * (R-R0)^2
#

#bond_style   harmonic

#
# For style harmonic, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#

#bond_coeff   1   60.0   1.0
#bond_coeff   2   harmonic 0.1   1.0

###################################################
compute 1 all gyration
variable rog equal c_1
#compute 2 all coord/atom cutoff 1.1

#dump 2 all custom 10000 contact_number.dump id c_2


###
# Set up fixes
###
thermo_style   custom   step  temp enthalpy c_1
fix 1 all nve   ###NVE ensemble

fix 2 all   langevin   1.0 1.0 1.0  778655   ###Langevin integrator Tstart Tstop 1/friction rndseed


##### Sample thermodynamic info  (temperature, energy, pressure, etc.) #####
thermo 1000









############################################################################

###
# set timestep of integrator

timestep 0.01

###
# run integration for a number of steps
###
#run 0
#variable r equal c_1
#if "$r < 63.1" then "quit 1"

# lj potential minimum, cause molecule to explore
run 100000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Neighbor list info ...
  update: every = 1 steps, delay = 1 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 5.1224615
  ghost atom cutoff = 5.1224615
  binsize = 2.5612308, bins = 781 781 781
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut/omp, perpetual
      attributes: half, newton on, omp
      pair build: half/bin/newton/omp
      stencil: half/bin/3d
      bin: standard
WARNING: Communication cutoff 5.12246152962189 is shorter than a bond length based estimate of 5.455. This may lead to errors. (src/comm.cpp:723)
Per MPI rank memory allocation (min/avg/max) = 1861 | 1861 | 1861 Mbytes
   Step          Temp         Enthalpy         c_1      
         0   0              13.257425      44.841509    
      1000   1.0303926      19.23871       43.883828    
      2000   0.98683958     18.911159      43.217097    
      3000   1.017915       19.238862      42.076187    
      4000   0.96461753     18.898571      41.52866     
      5000   1.0032189      19.876312      40.84562     
      6000   0.99669603     20.376476      40.212013    
      7000   0.94578606     19.80813       39.932172    
      8000   0.91137809     20.656045      39.673649    
      9000   1.0425003      20.432424      39.343881    
     10000   1.0806622      20.856126      39.481904    
     11000   0.98738907     20.121004      39.006549    
     12000   1.0359915      20.550478      38.622513    
     13000   0.94703675     19.943197      38.293454    
     14000   1.0044724      20.608239      38.045812    
     15000   0.97549403     19.774845      37.797578    
     16000   1.0324673      20.587011      37.233026    
     17000   0.98105827     20.672081      37.274508    
     18000   1.0161855      20.245801      37.144448    
     19000   0.9997571      20.5882        36.94386     
     20000   0.96122763     19.757879      36.696628    
     21000   1.0177008      20.173392      36.501623    
     22000   0.97464284     20.162382      36.461496    
     23000   0.9844602      19.85371       36.139972    
     24000   0.9807624      20.301933      36.316474    
     25000   1.0034906      19.920733      36.183906    
     26000   0.97525186     19.933973      35.995787    
     27000   1.0033779      19.873812      35.593976    
     28000   1.0165551      19.502753      35.087476    
     29000   0.9528471      20.285883      34.560426    
     30000   0.99442645     20.483974      34.596746    
     31000   1.0180107      20.062781      34.373009    
     32000   0.9841189      19.908981      34.160924    
     33000   1.0854889      21.16419       33.909079    
     34000   0.9342197      19.595194      34.046654    
     35000   1.0045597      20.557829      34.062233    
     36000   1.036201       20.182098      33.956267    
     37000   0.97572492     19.843241      34.038374    
     38000   1.0829971      20.685917      34.121919    
     39000   1.0504317      20.219432      34.080815    
     40000   1.0294757      21.021577      34.282283    
     41000   1.0099635      20.598553      34.073554    
     42000   1.02685        20.613876      33.793033    
     43000   0.96923326     20.146843      33.646413    
     44000   1.0171574      20.789681      33.835321    
     45000   0.97504722     20.491169      33.803151    
     46000   1.0208393      20.073637      33.64534     
     47000   0.98495792     20.640134      33.481868    
     48000   1.0078634      20.354459      33.585163    
     49000   1.0048894      19.610741      33.865751    
     50000   0.92861329     19.872879      33.948654    
     51000   1.0203923      20.60283       33.798368    
     52000   1.0380894      20.536641      33.660671    
     53000   1.0004891      20.779955      33.433041    
     54000   1.0190316      20.358895      33.595601    
     55000   1.0162108      20.578138      33.458225    
     56000   0.96463838     20.219422      33.232589    
     57000   0.98736506     19.631382      33.301139    
     58000   1.0653169      20.470546      33.342512    
     59000   0.98774976     20.111367      33.319213    
     60000   1.0181744      20.844021      33.021894    
     61000   1.032927       20.672531      32.734011    
     62000   0.94318479     19.844559      32.215201    
     63000   1.0040668      20.863221      31.876029    
     64000   0.98729843     20.598504      31.810032    
     65000   0.984535       20.255621      31.583302    
     66000   1.0644291      20.634396      31.447284    
     67000   0.96727297     20.428653      31.357448    
     68000   1.0154418      20.50841       31.354338    
     69000   0.9760146      20.618957      31.404493    
     70000   0.96835788     20.279437      31.355672    
     71000   0.94206088     20.099552      31.389594    
     72000   0.91726484     20.269946      31.324836    
     73000   1.0232989      20.227037      31.08677     
     74000   0.97167269     20.148833      30.711192    
     75000   1.007939       20.59366       30.300993    
     76000   1.007088       20.055123      30.348518    
     77000   1.0095724      20.113124      30.361194    
     78000   0.98869834     20.441643      30.014212    
     79000   0.98829088     20.743837      29.75089     
     80000   0.94629368     20.186728      29.543132    
     81000   1.018863       19.909521      29.241422    
     82000   0.99725599     20.767501      29.23112     
     83000   0.98873043     20.25591       29.279372    
     84000   0.93302023     20.827999      29.524824    
     85000   1.010216       20.269952      29.597541    
     86000   1.0097752      20.308116      29.710024    
     87000   1.0193332      20.167914      29.691047    
     88000   0.99630744     20.321597      29.500656    
     89000   0.97431889     20.135407      29.198134    
     90000   1.0053436      20.711717      28.860367    
     91000   1.0602593      20.383423      28.767478    
     92000   0.99070487     20.724221      29.036053    
     93000   1.0360449      21.233276      29.009818    
     94000   0.94616888     20.247683      28.728391    
     95000   1.0724913      20.860031      28.71308     
     96000   0.99948069     20.729599      28.564335    
     97000   1.0061743      20.357238      28.484309    
     98000   0.97808614     21.150189      28.226165    
     99000   1.0227509      21.051578      28.326052    
    100000   1.0774925      20.661619      28.551606    
Loop time of 509.142 on 2 procs for 100000 steps with 501 atoms

Performance: 169697.236 tau/day, 196.409 timesteps/s
101.1% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.77637    | 0.77637    | 0.77637    |   0.0 |  0.15
Bond    | 1.1083     | 1.1083     | 1.1083     |   0.0 |  0.22
Neigh   | 504.57     | 504.57     | 504.57     |   0.0 | 99.10
Comm    | 0.027326   | 0.027326   | 0.027326   |   0.0 |  0.01
Output  | 0.21486    | 0.21486    | 0.21486    |   0.0 |  0.04
Modify  | 2.2461     | 2.2461     | 2.2461     |   0.0 |  0.44
Other   |            | 0.2005     |            |       |  0.04

Nlocal:            501 ave         501 max         501 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           5887 ave        5887 max        5887 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 5887
Ave neighs/atom = 11.750499
Ave special neighs/atom = 1.996008
Neighbor list builds = 1108
Dangerous builds = 0

# Replace lj potential, now collapse
pair_style      lj/cut 3

# Cutoff simul when gyration under 10
# Variable created with equal requires v_ + 'name'
fix 3 all halt 1000 v_rog < 7

run 3000000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Per MPI rank memory allocation (min/avg/max) = 1861 | 1861 | 1861 Mbytes
   Step          Temp         Enthalpy         c_1      
    100000   1.0774925      19.626603      28.551606    
    101000   1.0496111      19.858619      28.038985    
    102000   1.0359516      18.927459      28.086385    
    103000   0.99538254     19.424131      27.676072    
    104000   0.96381024     18.833471      27.597086    
    105000   1.0699011      18.708553      27.467655    
    106000   1.0247646      19.596812      27.421232    
    107000   0.96274283     18.095761      27.155252    
    108000   0.96052433     18.006152      26.937799    
    109000   1.0074558      17.75564       26.913285    
    110000   0.98649207     17.37374       26.585621    
    111000   1.0405041      17.236772      26.729045    
    112000   0.99526488     17.924397      26.788471    
    113000   0.94157286     17.507535      26.549474    
    114000   1.0227397      17.922633      26.535749    
    115000   1.0135437      17.619296      26.192799    
    116000   0.99870739     17.75887       25.774269    
    117000   1.0081121      17.247245      25.579821    
    118000   0.96514794     17.811066      25.48002     
    119000   0.95752272     18.059394      25.214486    
    120000   1.0076594      17.993508      24.521465    
    121000   1.0093833      18.764696      24.331422    
    122000   0.9914129      18.222101      24.486837    
    123000   1.072259       18.769678      24.601266    
    124000   0.96557739     17.230108      24.56521     
    125000   1.0033063      17.802577      24.396393    
    126000   0.9807992      17.847         24.252409    
    127000   0.99197623     18.010473      24.075038    
    128000   0.99647253     18.252643      23.569387    
    129000   0.98593365     18.078726      23.524712    
    130000   0.98988479     18.109045      23.542048    
    131000   1.0129215      18.479783      23.546376    
    132000   1.0071565      17.678372      23.530388    
    133000   1.0436714      17.531874      23.452266    
    134000   0.92525753     16.973882      23.084341    
    135000   0.96910412     17.394324      22.827463    
    136000   1.0196094      17.707716      22.603558    
    137000   0.99145666     17.54354       22.776126    
    138000   1.0290889      17.486525      22.549713    
    139000   1.0003541      17.137773      22.221595    
    140000   1.0227698      18.018577      21.741599    
    141000   0.99790418     17.714304      21.601106    
    142000   1.0557201      17.513324      21.731839    
    143000   0.98627893     18.355058      21.596098    
    144000   1.0502343      17.206295      21.456744    
    145000   0.98799224     17.396399      21.336403    
    146000   1.0407082      17.332574      21.447075    
    147000   1.0181302      18.576131      21.806042    
    148000   1.074367       17.08254       21.68577     
    149000   1.0501367      18.403852      21.184579    
    150000   1.0070296      18.19273       21.033122    
    151000   1.0152107      17.437965      20.866942    
    152000   0.98468863     17.286048      20.786755    
    153000   0.99724903     17.970589      20.630869    
    154000   1.0116717      17.739457      20.287027    
    155000   0.98328977     17.975854      20.170631    
    156000   1.0216162      17.25191       20.157172    
    157000   0.95916115     18.139149      19.910556    
    158000   1.0116073      17.381644      20.014083    
    159000   0.96354889     18.381772      19.963964    
    160000   0.98908859     17.155631      20.066386    
    161000   0.97196274     18.054277      19.989885    
    162000   0.98726441     18.259208      20.016647    
    163000   0.96541812     17.757014      19.69952     
    164000   0.93765194     17.840466      19.742084    
    165000   1.1004355      17.999286      19.837853    
    166000   1.0121974      18.551194      19.469853    
    167000   1.0121445      18.076941      19.494817    
    168000   1.0678327      17.523791      19.22014     
    169000   0.94985325     17.84876       19.135219    
    170000   0.97084198     17.848255      18.990145    
    171000   0.97487545     16.940027      18.928826    
    172000   1.009829       17.646151      18.739671    
    173000   1.0174337      18.187987      18.468852    
    174000   0.99439269     17.122711      18.367315    
    175000   0.9703513      17.38315       18.312735    
    176000   0.99016684     18.477512      18.280508    
    177000   1.0728639      18.281496      18.617341    
    178000   0.94989462     17.329053      18.626193    
    179000   0.97585231     17.811993      18.688943    
    180000   1.0383347      17.991552      18.634365    
    181000   0.97461642     18.222921      18.661554    
    182000   1.0094037      16.816708      18.620249    
    183000   1.0405381      18.5155        18.675945    
    184000   0.9531867      17.684334      18.710239    
    185000   0.98863103     17.741923      18.589017    
    186000   1.0519376      17.93767       18.389384    
    187000   1.0232797      17.86337       18.206351    
    188000   1.0170667      17.74538       17.965989    
    189000   1.0485417      17.678149      17.57039     
    190000   0.99165757     17.767744      17.492648    
    191000   1.0469645      18.048251      17.258988    
    192000   0.99088964     17.489038      17.043759    
    193000   0.99756023     17.783981      16.618538    
    194000   1.0168272      18.245895      16.65074     
    195000   0.9562666      17.780843      16.75968     
    196000   1.0034055      17.275651      16.914978    
    197000   0.97888156     17.279532      16.842785    
    198000   0.99078504     18.983174      16.72824     
    199000   1.0232092      18.187698      16.560049    
    200000   1.0293999      18.320095      16.757928    
    201000   1.0371182      17.877035      16.545393    
    202000   0.96811342     17.918167      16.375065    
    203000   0.99991517     17.557269      16.100473    
    204000   0.99053374     17.767885      16.069078    
    205000   1.0616355      18.18285       16.09547     
    206000   0.99832189     16.796615      15.816506    
    207000   0.98248964     17.331905      15.503391    
    208000   1.0491863      17.733381      15.225439    
    209000   0.96157281     18.135461      15.150222    
    210000   1.0328484      17.086585      14.881906    
    211000   0.95538632     18.385717      14.691639    
    212000   1.007584       17.762307      14.262438    
    213000   1.0227403      17.214332      14.108969    
    214000   1.0794146      17.510327      13.729922    
    215000   1.0394892      18.803949      13.636711    
    216000   1.0223049      17.427386      13.543787    
    217000   1.0562442      17.149394      13.531728    
    218000   1.023214       17.992024      13.431755    
    219000   1.0182896      17.191106      13.078131    
    220000   0.95571458     18.054802      12.859822    
    221000   1.0557027      18.00014       12.580858    
    222000   1.0057407      17.537088      12.618722    
    223000   0.96662606     18.175819      12.291804    
    224000   0.94426521     17.543491      12.081962    
    225000   1.0222627      17.074784      11.735049    
    226000   0.9564522      17.42325       11.776972    
    227000   0.95165827     17.657327      11.726962    
    228000   1.000842       18.444861      11.657863    
    229000   0.97417476     17.443482      11.817583    
    230000   0.96916539     17.597855      11.613623    
    231000   1.0160783      17.264871      11.614262    
    232000   1.0116705      17.120697      11.189454    
    233000   0.99997459     18.314408      11.057657    
    234000   1.0086532      17.530815      10.661277    
    235000   0.98130655     17.922222      10.428597    
    236000   0.99824124     17.382854      10.66855     
    237000   1.0468507      18.332287      10.621825    
    238000   1.014807       17.968031      10.637117    
    239000   0.98994266     17.634252      10.42799     
    240000   1.0242334      18.274192      10.363218    
    241000   1.0078629      17.811545      10.148042    
    242000   1.0452997      18.698867      10.070364    
    243000   0.97506466     17.006396      9.9919318    
    244000   1.0137103      17.243067      9.8787569    
    245000   1.0236527      16.726035      9.7888202    
    246000   0.99457443     17.81415       9.4950974    
    247000   0.99576204     18.281171      9.5562243    
    248000   0.94374908     17.317615      9.3987647    
    249000   0.98646433     17.682442      9.4009449    
    250000   1.0114423      17.946704      9.1950595    
    251000   0.93163036     17.139065      9.0059615    
    252000   1.0015902      18.133275      8.9073483    
    253000   1.0270508      17.84827       9.1828472    
    254000   0.91609349     16.876731      8.7715293    
    255000   1.0751406      17.851893      8.6402708    
    256000   0.96530735     17.70615       8.2754133    
    257000   1.0587774      17.678813      8.170531     
    258000   0.99546851     18.08524       8.2047342    
    259000   1.0548225      18.540765      8.0640874    
    260000   1.0020921      16.713188      7.8660564    
    261000   1.0097025      17.381368      7.7599876    
    262000   1.0570418      18.067869      7.5819898    
    263000   1.0045625      18.831323      7.2835433    
    264000   1.031497       17.102066      7.2563114    
Fix halt condition for fix-id 3 met on step 265000 with value 6.9924891554955275 (src/fix_halt.cpp:237)
    265000   0.99160794     17.082532      6.9924892    
Loop time of 247.888 on 2 procs for 165000 steps with 501 atoms

Performance: 575099.129 tau/day, 665.624 timesteps/s
110.7% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 18.613     | 18.613     | 18.613     |   0.0 |  7.51
Bond    | 1.9566     | 1.9566     | 1.9566     |   0.0 |  0.79
Neigh   | 222.7      | 222.7      | 222.7      |   0.0 | 89.84
Comm    | 0.044126   | 0.044126   | 0.044126   |   0.0 |  0.02
Output  | 0.34526    | 0.34526    | 0.34526    |   0.0 |  0.14
Modify  | 3.8624     | 3.8624     | 3.8624     |   0.0 |  1.56
Other   |            | 0.3615     |            |       |  0.15

Nlocal:            501 ave         501 max         501 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:          60638 ave       60638 max       60638 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 60638
Ave neighs/atom = 121.03393
Ave special neighs/atom = 1.996008
Neighbor list builds = 1303
Dangerous builds = 0

# This simulation is done
# Move onto the next one
clear
  using 2 OpenMP thread(s) per MPI task
package omp 0
using multi-threaded neighbor list subroutines
next f
jump SELF

###
# Reference paper:
# K. Kremer and G. S. Grest
# Dynamics of entangled linear polymer melts: A molecular-dynamics simulation
# J Chem Phys 92, 5057 (1990)

##################################
# MIHIR: for branched polymers
# LJ minimum first to expand and explore, then collapse
###

###
# Looping through the various nuc3branch4 polymers to simulate,
# define variables to switch through
variable f index bb40nuc3bl10bn4d30tot100 bb80nuc3bl20bn4d30tot200 bb120nuc3bl30bn4d30tot300 bb160nuc3bl40bn4d30tot400 bb200nuc3bl50bn4d30tot500 bb240nuc3bl60bn4d30tot600 bb280nuc3bl70bn4d30tot700 bb320nuc3bl80bn4d30tot800 bb360nuc3bl90bn4d30tot900 bb400nuc3bl100bn4d30tot1000 bb440nuc3bl110bn4d30tot1100 bb480nuc3bl120bn4d30tot1200
###


###
# Box and units  (use LJ units and periodic boundaries)
###

units lj
log nuc3branch4/logs2/$f.log
log nuc3branch4/logs2/bb240nuc3bl60bn4d30tot600.log

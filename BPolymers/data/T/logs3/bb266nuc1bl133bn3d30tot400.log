#atom_style bond #no stiffness
atom_style angle #with stiffness

boundary        p p p
###
# Pair interactions require lists of neighbours to be calculated
###

#neighbor 0.3 bin
neighbor 4 bin

neigh_modify every 1 delay 1 check yes
atom_modify sort 0 0
### Generate RESTART file, SPECIAL format, not a .txt file ###
### Useful if simulation crashes ###

restart 1000000 tshaped/restarts3/$f.restart
restart 1000000 tshaped/restarts3/bb266nuc1bl133bn3d30tot400.restart
#############################



### READ "start" data file ###

read_data tshaped/$f.dat
read_data tshaped/bb266nuc1bl133bn3d30tot400.dat
Reading data file ...
  orthogonal box = (-1000 -1000 -1000) to (1000 1000 1000)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  400 atoms
  scanning bonds ...
  2 = max bonds/atom
  scanning angles ...
  3 = max angles/atom
  reading bonds ...
  399 bonds
  reading angles ...
  399 angles
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        0        0       
  special bond factors coul:  0        0        0       
     3 = max # of 1-2 neighbors
     3 = max # of 1-3 neighbors
     6 = max # of 1-4 neighbors
     9 = max # of special neighbors
  special bonds CPU = 0.001 seconds
  read_data CPU = 0.065 seconds

######################

### READ "REstart" data file ###

######################



###
# Define groups (atom type 1 is group 'all')
###
group all type 1
400 atoms in group all


###
# Dump configs - "simple dumpings"
###

###
# Dump configs + box coords
###

dump   1   all   custom   1000  tshaped/trjs3/$f.lammpstrj  id  x y z  ix iy iz
dump   1   all   custom   1000  tshaped/trjs3/bb266nuc1bl133bn3d30tot400.lammpstrj  id  x y z  ix iy iz
dump_modify   1   format line "%d %.5f %.5f %.5f %d %d %d"

########################################################################


###################################################################
# Stiffness term
#
# E = K * (1+cos(theta)), K>0
#
angle_style   cosine
#change this coefficient to change stiffness (e.g. 1,5,10)
angle_coeff   1 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  Lennard-Jones 12-6 potential with cutoff:
#  potential E=4epsilon[ (sigma/r)^12 - (sigma/r)^6]  for r<r_cut
#
#  1.12246 = 2^(1/6) is the minimum of the potential


pair_style      lj/cut 1.12246152962189
#pair_style      lj/cut 3

#
#  pair_modify shift yes adds a constant to the potential such

#  that E(r_cut)=0. Forces remains unchanged.
#

pair_modify     shift yes

#
#  pair_coeff for lj/cut, specify 4:
#    * atom type interacting with
#    * atom type
#    * epsilon (energy units)
#    * sigma (distance units)
#

pair_coeff      1 1 1.0 1.0
###################################################################

###################################################################
# Pair interaction between non-bonded atoms
#
#  soft potential, for PUSHING apart overlapping atoms
#  potential E=A*(1 + cos(pi*r/r_c))
#
#  1.12246 = 2^(1/6) is the cut-off r_c

#pair_style     soft 1.12246152962189

#
#  pair_coeff for soft, specify 3:
#    * atom type interacting with
#    * atom type
#    * A
#
#

#pair_coeff      1 1 100.0
###################################################################

###################################################################
# Pair interaction between bonded atoms
#
# Fene potential + Lennard Jones 12-6:

#
#  E= - 0.5 K R0^2 ln[ 1- (r/R0)^2]
#     + 4epsilon[ (sigma/r)^12 - (sigma/r)^6] + epsilon
#

bond_style   fene


#
# For style fene, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#   * epsilon (energy)  (LJ component)
#   * sigma (distance)  (LJ component)
#


special_bonds fene #<=== I M P O R T A N T (new command)
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0        1        1       
  special bond factors coul:  0        1        1       
     3 = max # of 1-2 neighbors
     9 = max # of special neighbors
  special bonds CPU = 0.000 seconds

bond_coeff   1   30   2   1.0   1.0


###################################################

###################################################################
# Pair interaction between bonded atoms
#
# Harmonic potential:
#
#  E= K * (R-R0)^2
#

#bond_style   harmonic

#
# For style harmonic, specify:
#   * bond type
#   * K (energy/distance^2)
#   * R0 (distance)
#

#bond_coeff   1   60.0   1.0
#bond_coeff   2   harmonic 0.1   1.0

###################################################
compute 1 all gyration
variable rog equal c_1
#compute 2 all coord/atom cutoff 1.1

#dump 2 all custom 10000 contact_number.dump id c_2


###
# Set up fixes
###
thermo_style   custom   step  temp enthalpy c_1
fix 1 all nve   ###NVE ensemble

fix 2 all   langevin   1.0 1.0 1.0  158102   ###Langevin integrator Tstart Tstop 1/friction rndseed


##### Sample thermodynamic info  (temperature, energy, pressure, etc.) #####
thermo 1000









############################################################################

###
# set timestep of integrator

timestep 0.01

###
# run integration for a number of steps
###
#run 0
#variable r equal c_1
#if "$r < 63.1" then "quit 1"

# lj potential minimum, cause molecule to explore
run 100000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Neighbor list info ...
  update: every = 1 steps, delay = 1 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 5.1224615
  ghost atom cutoff = 5.1224615
  binsize = 2.5612308, bins = 781 781 781
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut/omp, perpetual
      attributes: half, newton on, omp
      pair build: half/bin/newton/omp
      stencil: half/bin/3d
      bin: standard
WARNING: Communication cutoff 5.12246152962189 is shorter than a bond length based estimate of 5.455. This may lead to errors. (src/comm.cpp:723)
Per MPI rank memory allocation (min/avg/max) = 1860 | 1860 | 1860 Mbytes
   Step          Temp         Enthalpy         c_1      
         0   0              13.366823      66.692628    
      1000   1.0268364      17.470353      65.802612    
      2000   0.92977108     18.862491      65.317006    
      3000   1.0255034      18.952866      65.055232    
      4000   0.97259265     18.572471      64.695101    
      5000   1.061458       19.446305      64.367928    
      6000   0.99701432     18.41043       64.055766    
      7000   1.0888756      18.795787      63.25452     
      8000   1.0691105      19.864496      62.524541    
      9000   0.97520455     18.828875      62.048278    
     10000   0.98081599     19.37999       61.718835    
     11000   0.96825909     19.572672      61.546112    
     12000   0.93613264     19.265372      61.090549    
     13000   0.98395311     19.421125      60.775382    
     14000   1.046687       20.125032      60.543769    
     15000   1.0530817      19.977526      60.186944    
     16000   0.98490469     19.310852      59.752146    
     17000   0.97737181     20.302832      59.492454    
     18000   1.0092721      19.561913      59.108596    
     19000   0.9956321      19.732827      58.302987    
     20000   0.96956281     19.786263      58.409548    
     21000   0.99235686     19.909852      57.858926    
     22000   1.0869494      19.968582      57.55576     
     23000   0.9438354      18.666838      57.017646    
     24000   1.0537153      19.746331      56.58643     
     25000   0.93069908     19.994875      56.413293    
     26000   1.0180798      19.401049      56.052949    
     27000   0.97630738     19.832045      55.697413    
     28000   1.0143966      19.911816      55.400084    
     29000   0.98677958     19.902463      55.315926    
     30000   0.97022759     19.567657      55.109888    
     31000   1.0067538      19.906204      55.376708    
     32000   1.0008848      20.387318      55.06395     
     33000   0.97011663     19.272005      54.568966    
     34000   0.95448076     20.200052      54.442791    
     35000   1.0056666      20.087491      54.125953    
     36000   1.0340818      19.734499      54.044301    
     37000   0.95239881     20.210592      54.30528     
     38000   1.0347019      19.203182      53.835421    
     39000   0.94402261     20.216055      53.464141    
     40000   0.91633676     20.314436      53.167526    
     41000   1.0205856      20.578619      52.963939    
     42000   1.0176461      19.429424      52.654922    
     43000   0.96466198     19.012428      52.690515    
     44000   1.0675299      20.365669      52.365262    
     45000   0.98192114     19.686994      52.067265    
     46000   1.0208499      19.947086      51.735298    
     47000   1.0304782      20.731779      51.381614    
     48000   1.0088439      18.989771      50.984548    
     49000   0.98367821     19.390528      50.535612    
     50000   0.90320691     20.392021      50.460818    
     51000   0.98595924     20.317329      49.9124      
     52000   0.98195869     20.221514      49.763838    
     53000   1.0821242      19.781037      50.062913    
     54000   0.9752114      19.870093      49.736435    
     55000   1.0173228      19.302314      49.386623    
     56000   1.005024       20.310828      49.195058    
     57000   0.98575497     19.999975      49.249569    
     58000   1.0082476      20.427522      49.022754    
     59000   1.0077448      20.593652      49.168471    
     60000   1.021528       20.939107      48.920531    
     61000   0.99106622     20.143656      48.845118    
     62000   1.0290335      20.459519      48.55319     
     63000   1.0075141      19.715025      48.523156    
     64000   1.0373933      19.723874      48.329336    
     65000   1.0903214      20.778937      48.14791     
     66000   1.0628195      20.362333      47.661531    
     67000   0.94921337     19.952198      47.043658    
     68000   0.91149125     20.297925      47.00341     
     69000   0.97251926     20.303944      46.808816    
     70000   0.98406103     19.888771      46.37802     
     71000   1.04949        20.190762      45.851883    
     72000   1.0322107      19.697058      45.579375    
     73000   1.005389       19.668274      45.542684    
     74000   0.9166161      20.646078      45.446163    
     75000   1.0112799      20.308719      45.357807    
     76000   0.95808372     19.777946      45.281832    
     77000   0.98817994     20.631397      44.910345    
     78000   0.97565764     20.341616      44.613752    
     79000   1.058492       20.279429      44.663009    
     80000   1.0444418      20.637873      44.399026    
     81000   0.99428999     19.999495      43.710228    
     82000   1.0543596      20.79182       43.596596    
     83000   1.0310131      21.23118       43.310584    
     84000   1.0665145      20.705362      43.387635    
     85000   0.98054895     20.947624      43.221897    
     86000   0.95496765     20.325198      43.314354    
     87000   1.0345524      20.147971      43.767861    
     88000   1.0158519      20.539605      43.709755    
     89000   1.0495172      20.114337      43.433089    
     90000   1.035201       20.441583      43.116619    
     91000   1.0369365      19.919621      42.991448    
     92000   0.990125       20.380457      43.065959    
     93000   1.0093627      20.748182      42.63509     
     94000   0.96307221     20.20826       42.789303    
     95000   1.0473009      21.012353      42.394819    
     96000   1.1463944      20.798496      42.33143     
     97000   1.0018574      20.530867      42.60217     
     98000   1.0388888      20.509259      42.55004     
     99000   0.961471       20.48473       42.097395    
    100000   1.002985       20.678461      42.145592    
Loop time of 626.741 on 2 procs for 100000 steps with 400 atoms

Performance: 137855.930 tau/day, 159.555 timesteps/s
101.3% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.84041    | 0.84041    | 0.84041    |   0.0 |  0.13
Bond    | 1.6199     | 1.6199     | 1.6199     |   0.0 |  0.26
Neigh   | 620.63     | 620.63     | 620.63     |   0.0 | 99.02
Comm    | 0.039316   | 0.039316   | 0.039316   |   0.0 |  0.01
Output  | 0.23733    | 0.23733    | 0.23733    |   0.0 |  0.04
Modify  | 3.1058     | 3.1058     | 3.1058     |   0.0 |  0.50
Other   |            | 0.2716     |            |       |  0.04

Nlocal:            400 ave         400 max         400 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:           2760 ave        2760 max        2760 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 2760
Ave neighs/atom = 6.9
Ave special neighs/atom = 1.995
Neighbor list builds = 1042
Dangerous builds = 0

# Replace lj potential, now collapse
pair_style      lj/cut 3

# Cutoff simul when gyration under 5
# Variable created with equal requires v_ + 'name'
fix 3 all halt 1000 v_rog < 7

run 5000000
Generated 0 of 0 mixed pair_coeff terms from geometric mixing rule
Last active /omp style is angle_style cosine/omp
Per MPI rank memory allocation (min/avg/max) = 1860 | 1860 | 1860 Mbytes
   Step          Temp         Enthalpy         c_1      
    100000   1.002985       19.932376      42.145592    
    101000   1.036948       20.082716      42.116686    
    102000   1.0015415      18.827164      41.860032    
    103000   1.0362782      19.722699      41.696342    
    104000   0.98235113     20.056259      41.394371    
    105000   1.028114       19.834385      41.175875    
    106000   0.97721029     19.150218      40.895137    
    107000   1.0905785      19.886961      40.622285    
    108000   1.0144823      19.711186      40.505357    
    109000   1.0571764      20.152035      39.907478    
    110000   1.0327041      19.134654      39.869646    
    111000   1.0135728      19.704049      39.405301    
    112000   0.96010229     19.468015      38.938144    
    113000   1.0294901      19.35038       38.666694    
    114000   0.98656833     19.013236      38.39305     
    115000   1.0880965      19.698022      37.847061    
    116000   1.01936        19.00035       37.505636    
    117000   0.98163545     18.595895      37.493014    
    118000   1.0518804      18.840858      36.935624    
    119000   1.0692331      18.729817      36.68347     
    120000   0.94559372     19.335342      36.49398     
    121000   1.0473481      19.686226      36.700227    
    122000   0.98425104     18.653935      36.158771    
    123000   0.9339006      18.034302      35.523093    
    124000   0.95996653     19.046165      35.241549    
    125000   0.99069073     18.999809      34.884109    
    126000   0.96830817     18.974683      34.764166    
    127000   0.99558095     19.433286      34.433318    
    128000   0.92132571     18.074405      34.288637    
    129000   0.94950285     18.604569      33.910207    
    130000   0.93116356     18.868575      33.609229    
    131000   1.0054105      19.500731      33.572691    
    132000   0.91494653     18.49435       33.497569    
    133000   0.95116847     19.085927      32.991449    
    134000   1.0196866      18.848971      32.653806    
    135000   1.0021598      18.806375      32.304967    
    136000   0.96792622     18.278489      31.955912    
    137000   0.92942621     18.041228      31.824415    
    138000   0.93747104     18.060409      31.950386    
    139000   1.0084598      18.930802      32.010235    
    140000   1.0354204      17.930208      31.712014    
    141000   1.0199168      18.200184      31.95159     
    142000   0.89356677     19.064548      31.811662    
    143000   0.97365099     17.946024      31.284846    
    144000   1.0278648      18.128119      31.376168    
    145000   1.0136055      17.998232      30.765616    
    146000   1.0963893      19.232466      30.824061    
    147000   1.0484428      18.810386      30.835292    
    148000   1.014726       19.165215      30.660295    
    149000   1.0484349      18.161048      30.54114     
    150000   0.99123689     17.902009      30.389307    
    151000   0.9887759      18.699645      30.182591    
    152000   1.0422723      18.994109      29.742051    
    153000   1.0221188      18.926557      29.054586    
    154000   1.032857       19.097509      28.797011    
    155000   1.086482       18.815637      28.464234    
    156000   0.95079763     18.288978      28.296046    
    157000   1.0924696      18.600315      28.100758    
    158000   0.9264777      17.866398      27.957574    
    159000   1.0473992      18.521761      27.242697    
    160000   1.0255755      18.984252      27.102123    
    161000   1.0733221      18.85918       26.996956    
    162000   0.96818279     18.94087       26.631226    
    163000   0.96945984     18.431704      26.34491     
    164000   0.95565766     18.289908      26.244099    
    165000   1.0309011      18.848165      25.997046    
    166000   0.98193577     19.046495      25.528484    
    167000   1.0575339      18.993569      25.180785    
    168000   0.98686531     18.953452      25.164174    
    169000   1.0156215      19.515845      25.122151    
    170000   0.98176423     18.308158      24.848976    
    171000   1.0160209      18.794418      24.71134     
    172000   0.97829069     18.687656      24.355462    
    173000   0.98616645     17.909461      24.005213    
    174000   0.96044134     18.873502      23.61125     
    175000   1.0351867      18.577998      23.426627    
    176000   0.9841115      18.23903       22.855294    
    177000   1.0863802      19.324814      22.925628    
    178000   0.97038282     18.407213      22.44576     
    179000   1.0405204      17.87606       22.300308    
    180000   0.93286869     18.340625      22.207223    
    181000   0.98684177     18.009933      22.176729    
    182000   0.973807       17.464676      22.274054    
    183000   1.0388247      18.611445      22.40751     
    184000   1.0138428      17.652845      22.162533    
    185000   0.93692212     17.89333       21.919582    
    186000   0.94417604     18.346375      21.690728    
    187000   1.00618        18.90172       21.22666     
    188000   1.0594391      18.697545      21.095219    
    189000   1.0215587      18.023797      20.700957    
    190000   1.0433938      17.952818      20.052272    
    191000   1.0170685      18.365342      19.535676    
    192000   0.99941376     17.029027      19.145205    
    193000   1.0187255      19.100582      19.212242    
    194000   1.0398034      18.792354      19.299663    
    195000   1.0282101      19.423754      19.097775    
    196000   1.0533264      17.977365      18.917627    
    197000   1.0050287      17.480943      18.387635    
    198000   0.96552827     18.768178      17.855469    
    199000   1.0545436      17.825623      17.919698    
    200000   1.0516193      18.142347      17.549206    
    201000   0.98922832     18.118837      17.246321    
    202000   1.0471524      18.256119      17.096003    
    203000   1.0450485      18.485043      17.174973    
    204000   0.97423152     18.362063      17.045304    
    205000   1.0290826      17.944568      16.809538    
    206000   0.94412512     17.836921      16.649756    
    207000   0.95774803     18.725108      16.594595    
    208000   1.0228542      17.718311      16.511465    
    209000   0.98183853     19.170158      16.536145    
    210000   1.0581722      19.02491       16.114727    
    211000   0.93454083     17.972264      15.728177    
    212000   1.0325645      18.168017      15.491581    
    213000   0.99194269     19.082576      15.392539    
    214000   0.99927749     18.379726      15.115153    
    215000   1.0459234      18.40845       15.014141    
    216000   1.0385063      17.866893      14.653289    
    217000   1.0014966      17.398309      14.550512    
    218000   0.9581226      17.500616      14.146215    
    219000   0.97224014     17.718467      14.178896    
    220000   1.0348523      18.899806      14.233846    
    221000   0.99006003     17.973372      14.321883    
    222000   1.0804936      18.978954      13.899944    
    223000   1.0058941      17.920917      13.387091    
    224000   1.0192748      17.924315      13.046407    
    225000   1.0004217      18.08903       12.701838    
    226000   1.0353094      17.917969      12.510925    
    227000   1.0087146      18.256523      12.183573    
    228000   1.0666682      18.435874      12.050788    
    229000   1.0757202      17.924965      11.755498    
    230000   1.0107244      17.618807      11.564073    
    231000   0.9871507      17.995375      11.193845    
    232000   1.1210599      17.732213      10.943799    
    233000   1.0050606      17.892812      10.488051    
    234000   1.0044609      17.980195      10.358162    
    235000   0.98210571     18.361927      10.317119    
    236000   0.98968208     18.116033      10.318545    
    237000   0.98001477     18.452212      10.048095    
    238000   0.94108511     17.2567        9.9019004    
    239000   1.0616226      17.85846       9.8209552    
    240000   0.99957836     18.738918      9.3624737    
    241000   0.96785106     18.65422       8.9648919    
    242000   1.0001439      17.821695      8.7817799    
    243000   0.98505649     18.33524       8.7485857    
    244000   1.0240282      18.001714      8.6738733    
    245000   1.0234571      17.640667      8.3723746    
    246000   1.0377235      17.788542      8.2627278    
    247000   0.95599931     17.580117      7.9258565    
    248000   1.0013046      17.996173      7.4549596    
    249000   0.95683231     18.690926      7.2220418    
    250000   1.0217702      17.214466      7.0986599    
Fix halt condition for fix-id 3 met on step 251000 with value 6.485722109881591 (src/fix_halt.cpp:237)
    251000   0.89615243     17.794127      6.4857221    
Loop time of 358.541 on 2 procs for 151000 steps with 400 atoms

Performance: 363875.182 tau/day, 421.152 timesteps/s
105.2% CPU use with 1 MPI tasks x 2 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.102     | 10.102     | 10.102     |   0.0 |  2.82
Bond    | 2.1924     | 2.1924     | 2.1924     |   0.0 |  0.61
Neigh   | 341.61     | 341.61     | 341.61     |   0.0 | 95.28
Comm    | 0.058078   | 0.058078   | 0.058078   |   0.0 |  0.02
Output  | 0.31188    | 0.31188    | 0.31188    |   0.0 |  0.09
Modify  | 3.8563     | 3.8563     | 3.8563     |   0.0 |  1.08
Other   |            | 0.4101     |            |       |  0.11

Nlocal:            400 ave         400 max         400 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:          35087 ave       35087 max       35087 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 35087
Ave neighs/atom = 87.7175
Ave special neighs/atom = 1.995
Neighbor list builds = 1312
Dangerous builds = 0

# This simulation is done
# Move onto the next one
clear
  using 2 OpenMP thread(s) per MPI task
package omp 0
using multi-threaded neighbor list subroutines
next f
jump SELF

###
# Reference paper:
# K. Kremer and G. S. Grest
# Dynamics of entangled linear polymer melts: A molecular-dynamics simulation
# J Chem Phys 92, 5057 (1990)

##################################
# MIHIR: for branched polymers
# LJ minimum first to expand and explore, then collapse
###

###
# Looping through the various tshaped polymers to simulate,
# define variables to switch through
variable f index bb66nuc1bl33bn3d30tot100 bb133nuc1bl66bn3d30tot200 bb200nuc1bl100bn3d30tot300 bb266nuc1bl133bn3d30tot400 bb333nuc1bl166bn3d30tot500 bb400nuc1bl200bn3d30tot600 bb466nuc1bl233bn3d30tot700 bb533nuc1bl266bn3d30tot800 bb600nuc1bl300bn3d30tot900 bb666nuc1bl333bn3d30tot1000 bb733nuc1bl366bn3d30tot1100 bb800nuc1bl400bn3d30tot1200
###


###
# Box and units  (use LJ units and periodic boundaries)
###

units lj
log tshaped/logs3/$f.log
log tshaped/logs3/bb333nuc1bl166bn3d30tot500.log
